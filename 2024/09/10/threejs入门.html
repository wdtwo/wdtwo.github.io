<!DOCTYPE html>
<html lang="zh-cn">
<head>
    	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<meta name="author" content="GaryWang">
	<meta name='renderer' content='webkit'>
	<meta http-equiv='X-UA-Compatible' content='IE=Edge,chrome=1' >
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="format-detection" content="telephone=no">
	<meta name="format-detection" content="email=no">
    <title>WDTWO Blog</title>
	<link href="/assets/css/style.css" rel="stylesheet" type="text/css">
	<link href="/assets/css/animate.css" rel="stylesheet" type="text/css">
	<link href="/assets/fontawesome-free-5.15.4-web/css/all.min.css" rel="stylesheet" type="text/css">
    
<meta name="generator" content="Hexo 7.3.0"></head>
<body class="light">

    <div class="loading flex">
        <div></div>
    </div>

    <!-- 调试信息 -->
    <!-- 
        <div style="background: #f0f0f0; padding: 10px; margin: 10px;">
            页面类型: post<br>
            页面路径: 2024/09/10/threejs入门.html<br>
            是否为文章页: true<br>
            是否为首页: false
        </div>
     -->
    <header class="flex flex-jus-between">
    <h1 class="header-title">
        <a href="/" class="header-title">
            WDTWO Blog
        </a>
    </h1>
    <div class="flex">
        <div class="menu-list animated">
            
                <a class="menu-item" href="/archives">目录</a>
            
                <a class="menu-item" href="/category">分类</a>
            
                <a class="menu-item" href="/tag">标签</a>
            
                <a class="menu-item" href="/static/mark/index.html">书签</a>
            
            <i class="fa fa-times mobile-close-menu"></i>
        </div>
        <i class="fa fa-search"></i>
        <i class="fa fa-bars mobile-menu"></i>
        <i class="fa fa-sun"></i>
        <i class="fa fa-moon"></i>
    </div>
</header>

<script>
    window.addEventListener('DOMContentLoaded',function(){
        // 搜索按钮点击事件
        document.querySelector('.fa-search').addEventListener('click',function(){
            showSearchPage()
        })
        document.querySelector('.search-page-bg').addEventListener('click',function(){
            hideSearchPage()
        })  
        // 显示菜单
        document.querySelector('.mobile-menu').addEventListener('click',function(){
            showMobileMenu()
        })
        document.querySelector('.mobile-close-menu').addEventListener('click',function(){
            hideMobileMenu()
        })
    })
</script>
    <div class="main">
        <!-- 添加 highlight.js 的样式 -->
<link rel="stylesheet" href="/assets/css/atom-one-dark-reasonable.css">
<link rel="stylesheet" href="/assets/css/markdown.css">
<div class="post-box flex flex-item-start">
    <article class="post">
    
        <h1 class="post-title t-c">threejs入门</h1>
        <div class="post-meta t-c flex">
            <!-- 作者 -->
            <div>
                <i class="fa fa-user c-purple"></i>
                Gary Wang
             </div>
            <div>
                <i class="fa fa-calendar c-orange"></i>
                2024-09-10
            </div>
            
                <div>
                    <i class="fa fa-folder c-yellow"></i>
                    <a class="archive-item-category-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a>
                </div>
            
            
                <div>
                    <i class="fa fa-tags c-green"></i>
                    <a class="archive-item-tag-none-link" href="/tag/threejs/" rel="tag">threejs</a>
                </div>
            
        </div>
        <hr class="line">
        <div class="post-content">
            <h2 id="cdn引入"><a href="#cdn引入" class="headerlink" title="cdn引入"></a>cdn引入</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;importmap&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">        &#123;</span><br><span class="language-javascript">            <span class="hljs-string">&quot;imports&quot;</span>:&#123;</span><br><span class="language-javascript">                <span class="hljs-string">&quot;three&quot;</span>:<span class="hljs-string">&quot;./src/three.module.js&quot;</span></span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;module&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"> <span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span></span><br><span class="language-javascript"> <span class="hljs-keyword">import</span> &#123;<span class="hljs-title class_">OrbitControls</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./src/OrbitControls.js&#x27;</span></span><br><span class="language-javascript"> </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//相机轨道控制器 创建控制器          相机  绑定的事件元素</span><br><span class="hljs-keyword">const</span> controls = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera,render.<span class="hljs-property">domElement</span>)<br>controls.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;change&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-comment">//每次改变值重新触发输出 类似逐帧</span><br>    render.<span class="hljs-title function_">render</span>(scene,camera)  <span class="hljs-comment">//3d场景  相机</span><br>&#125;)<br></code></pre></td></tr></table></figure>


<h2 id="创建vue3项目"><a href="#创建vue3项目" class="headerlink" title="创建vue3项目"></a>创建vue3项目</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vite create object<br>npm init vite@latest<br></code></pre></td></tr></table></figure>
<h2 id="安装threejs"><a href="#安装threejs" class="headerlink" title="安装threejs"></a>安装threejs</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i three -S<br></code></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">Three</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span><br></code></pre></td></tr></table></figure>

<h2 id="场景创建基本步骤"><a href="#场景创建基本步骤" class="headerlink" title="场景创建基本步骤"></a>场景创建基本步骤</h2><ol>
<li>创建场景</li>
<li>创建相机</li>
<li>创建渲染器</li>
<li>添加到DOM中</li>
<li>添加物体</li>
<li>添加光源</li>
</ol>
<h2 id="创建场景"><a href="#创建场景" class="headerlink" title="创建场景"></a>创建场景</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123;ref,onMounted&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">Three</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> canvas = ref&lt;any&gt;()</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">()=&gt;</span>&#123;</span><br><span class="language-javascript">    <span class="hljs-comment">// 设置容器宽高</span></span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> pos = &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">width</span>:<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">height</span>:<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span></span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">    <span class="hljs-comment">// 全屏渲染 改变窗口大小时重新设置相机</span></span><br><span class="language-javascript">    <span class="hljs-variable language_">window</span>.<span class="hljs-property">onresize</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">        pos.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span></span><br><span class="language-javascript">        pos.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span></span><br><span class="language-javascript">        camera.<span class="hljs-property">aspect</span> = pos.<span class="hljs-property">width</span> / pos.<span class="hljs-property">height</span> <span class="hljs-comment">// 设置相机纵横比</span></span><br><span class="language-javascript">        camera.<span class="hljs-title function_">updateProjectionMatrix</span>() <span class="hljs-comment">// 更新相机矩阵</span></span><br><span class="language-javascript">        renderer.<span class="hljs-title function_">setSize</span>(pos.<span class="hljs-property">width</span>, pos.<span class="hljs-property">height</span>) <span class="hljs-comment">// 设置渲染器尺寸</span></span><br><span class="language-javascript">        renderer.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>) <span class="hljs-comment">// 设置像素比</span></span><br><span class="language-javascript">        renderer.<span class="hljs-property">outputEncoding</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">sRGBEncoding</span>; <span class="hljs-comment">//定义渲染器的输出编码 默认为THREE.LinearEncoding</span></span><br><span class="language-javascript">        renderer.<span class="hljs-property">shadowMap</span>.<span class="hljs-property">enabled</span> = <span class="hljs-literal">true</span>;<span class="hljs-comment">//阴影贴图</span></span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">// 创建一个场景  参数可选可不选</span></span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Scene</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">antialias</span>:<span class="hljs-literal">true</span>, <span class="hljs-comment">// 抗锯齿</span></span><br><span class="language-javascript">        <span class="hljs-attr">powerPreference</span>:<span class="hljs-string">&#x27;high-performance&#x27;</span>, <span class="hljs-comment">// 性能优先</span></span><br><span class="language-javascript">        <span class="hljs-attr">alpha</span>:<span class="hljs-literal">true</span>, <span class="hljs-comment">// 不透明</span></span><br><span class="language-javascript">        <span class="hljs-attr">stencil</span>:<span class="hljs-literal">true</span>, <span class="hljs-comment">// 深度测试</span></span><br><span class="language-javascript">        <span class="hljs-attr">preserveDrawingBuffer</span>:<span class="hljs-literal">true</span>, <span class="hljs-comment">// 保留缓冲区</span></span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript">   </span><br><span class="language-javascript">    <span class="hljs-comment">// 创建一个立方体</span></span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>)</span><br><span class="language-javascript">    <span class="hljs-comment">// 创建一个材质 opacity透明度 transparent是否透明 wireframe: true 是否显示线框</span></span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123;<span class="hljs-attr">color</span>: <span class="hljs-number">0x00ff00</span>,<span class="hljs-attr">opacity</span>:<span class="hljs-number">0.5</span>,<span class="hljs-attr">transparent</span>:<span class="hljs-literal">true</span>&#125;)</span><br><span class="language-javascript">    <span class="hljs-comment">// 创建一个网格模型 把材质和几何体绑定到一起</span></span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> mesh = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Mesh</span>(geometry, material)</span><br><span class="language-javascript">    <span class="hljs-comment">// 设置模型的位置</span></span><br><span class="language-javascript">    mesh.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">1.5</span>,<span class="hljs-number">1.5</span>,<span class="hljs-number">1.5</span>)</span><br><span class="language-javascript">    <span class="hljs-comment">// 把模型添加到场景中</span></span><br><span class="language-javascript">    group.<span class="hljs-title function_">add</span>(mesh)</span><br><span class="language-javascript">    <span class="hljs-comment">// 创建一个透视相机</span></span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, pos.<span class="hljs-property">width</span> / pos.<span class="hljs-property">height</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>)</span><br><span class="language-javascript">    <span class="hljs-comment">// 设置相机位置</span></span><br><span class="language-javascript">    camera.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">20</span>)</span><br><span class="language-javascript">    <span class="hljs-comment">// 把相机添加到场景中</span></span><br><span class="language-javascript">    scene.<span class="hljs-title function_">add</span>(camera)</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">// 创建一个渲染器</span></span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">WebGLRenderer</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">canvas</span>:canvas.<span class="hljs-property">value</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">antialias</span>:<span class="hljs-literal">true</span>, <span class="hljs-comment">// 抗锯齿</span></span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript">    <span class="hljs-comment">// 渲染场景</span></span><br><span class="language-javascript">    renderer.<span class="hljs-title function_">render</span>(scene, camera)</span><br><span class="language-javascript">&#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;canvas&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="创建一个模型组"><a href="#创建一个模型组" class="headerlink" title="创建一个模型组"></a>创建一个模型组</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 创建一个组</span><br><span class="hljs-keyword">const</span> group = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Group</span>()<br>scene.<span class="hljs-title function_">add</span>(group)<br>group.<span class="hljs-title function_">add</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Mesh</span>(<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>),<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-number">0xff0000</span> &#125;)<br>))<br></code></pre></td></tr></table></figure>

<h2 id="设置模型位置的几种方式"><a href="#设置模型位置的几种方式" class="headerlink" title="设置模型位置的几种方式"></a>设置模型位置的几种方式</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js">mesh.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>) <span class="hljs-comment">// 直接设置x y z</span><br><br>mesh.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">1</span><br>mesh.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">2</span><br>mesh.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">3</span><br><br>mesh.<span class="hljs-property">position</span> = &#123;<span class="hljs-attr">x</span>:<span class="hljs-number">1</span>,<span class="hljs-attr">y</span>:<span class="hljs-number">2</span>,<span class="hljs-attr">z</span>:<span class="hljs-number">3</span>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="设置模型旋转"><a href="#设置模型旋转" class="headerlink" title="设置模型旋转"></a>设置模型旋转</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">mesh.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">4</span> <span class="hljs-comment">// x轴旋转45度</span><br>mesh.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">4</span> <span class="hljs-comment">// y轴旋转45度</span><br>mesh.<span class="hljs-property">rotation</span>.<span class="hljs-property">z</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">4</span> <span class="hljs-comment">// z轴旋转45度</span><br>mesh.<span class="hljs-property">rotation</span> = &#123;<span class="hljs-attr">x</span>:<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">4</span>,<span class="hljs-attr">y</span>:<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">4</span>,<span class="hljs-attr">z</span>:<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">4</span>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="设置模型移动"><a href="#设置模型移动" class="headerlink" title="设置模型移动"></a>设置模型移动</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js">mesh.<span class="hljs-title function_">translateX</span>(<span class="hljs-number">1</span>) <span class="hljs-comment">// x轴移动1个单位</span><br>mesh.<span class="hljs-title function_">translateY</span>(<span class="hljs-number">2</span>) <span class="hljs-comment">// y轴移动2个单位</span><br>mesh.<span class="hljs-title function_">translateZ</span>(<span class="hljs-number">3</span>) <span class="hljs-comment">// z轴移动3个单位</span><br>mesh.<span class="hljs-title function_">translateX</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>) <span class="hljs-comment">// x y z轴移动</span><br>mesh.<span class="hljs-title function_">translateX</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>) <span class="hljs-comment">// x y z轴移动</span><br>mesh.<span class="hljs-title function_">translateX</span>(&#123;<span class="hljs-attr">x</span>:<span class="hljs-number">1</span>,<span class="hljs-attr">y</span>:<span class="hljs-number">2</span>,<span class="hljs-attr">z</span>:<span class="hljs-number">3</span>&#125;) <span class="hljs-comment">// x y z轴移动</span><br></code></pre></td></tr></table></figure>
<h2 id="设置模型缩放"><a href="#设置模型缩放" class="headerlink" title="设置模型缩放"></a>设置模型缩放</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">mesh.<span class="hljs-property">scale</span>.<span class="hljs-property">x</span> = <span class="hljs-number">2</span> <span class="hljs-comment">// x轴缩放2倍</span><br>mesh.<span class="hljs-property">scale</span>.<span class="hljs-property">y</span> = <span class="hljs-number">2</span> <span class="hljs-comment">// y轴缩放2倍</span><br>mesh.<span class="hljs-property">scale</span>.<span class="hljs-property">z</span> = <span class="hljs-number">2</span> <span class="hljs-comment">// z轴缩放2倍</span><br>mesh.<span class="hljs-property">scale</span> = &#123;<span class="hljs-attr">x</span>:<span class="hljs-number">2</span>,<span class="hljs-attr">y</span>:<span class="hljs-number">2</span>,<span class="hljs-attr">z</span>:<span class="hljs-number">2</span>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="创建辅助坐标轴"><a href="#创建辅助坐标轴" class="headerlink" title="创建辅助坐标轴"></a>创建辅助坐标轴</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">5</span>)<br>scene.<span class="hljs-title function_">add</span>(axesHelper)<br></code></pre></td></tr></table></figure>
<h2 id="创建辅助网格"><a href="#创建辅助网格" class="headerlink" title="创建辅助网格"></a>创建辅助网格</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 平面辅助网格</span><br><span class="hljs-keyword">const</span> gridHelper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">GridHelper</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>,<span class="hljs-number">0xff0000</span>,<span class="hljs-number">0xefefef</span>) <span class="hljs-comment">// 总尺寸 格子个数 中线颜色(可选) 网格颜色(可选)</span><br>scene.<span class="hljs-title function_">add</span>(grid)<br></code></pre></td></tr></table></figure>
<h2 id="辅助边界"><a href="#辅助边界" class="headerlink" title="辅助边界"></a>辅助边界</h2><p>为创建的模型添加矩形边界</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> sphere = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">SphereGeometry</span>(<span class="hljs-number">1</span>,<span class="hljs-number">32</span>,<span class="hljs-number">32</span>);<br><span class="hljs-keyword">const</span> object = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Mesh</span>( sphere, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshBasicMaterial</span>() );<br><span class="hljs-keyword">const</span> box = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">BoxHelper</span>( object, <span class="hljs-number">0xffff00</span> );<br>scene.<span class="hljs-title function_">add</span>( object,box );<br></code></pre></td></tr></table></figure>
<h2 id="主动创建一个辅助边界"><a href="#主动创建一个辅助边界" class="headerlink" title="主动创建一个辅助边界"></a>主动创建一个辅助边界</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> box = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Box3</span>();<br><span class="hljs-comment">// 第一个参数是中心点 第二个参数是大小 x2 y1 z3</span><br>box.<span class="hljs-title function_">setFromCenterAndSize</span>( <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Vector3</span>( <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span> ), <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Vector3</span>( <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span> ) );<br><span class="hljs-keyword">const</span> helper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Box3Helper</span>( box, <span class="hljs-number">0xffff00</span> );<br>scene.<span class="hljs-title function_">add</span>( helper );<br></code></pre></td></tr></table></figure>
<h2 id="判断两个点之间的距离"><a href="#判断两个点之间的距离" class="headerlink" title="判断两个点之间的距离"></a>判断两个点之间的距离</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Vector3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0</span>).<span class="hljs-title function_">distanceTo</span>(mesh.<span class="hljs-property">position</span>))<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mesh.<span class="hljs-property">position</span>.<span class="hljs-title function_">distanceTo</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Vector3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0</span>)))<br></code></pre></td></tr></table></figure>
<h2 id="通过第三方插件设置动画"><a href="#通过第三方插件设置动画" class="headerlink" title="通过第三方插件设置动画"></a>通过第三方插件设置动画</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install gsap -S<br></code></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js">gsap.<span class="hljs-title function_">to</span>(group.<span class="hljs-property">position</span>, &#123;<br>    <span class="hljs-attr">duration</span>:<span class="hljs-number">1</span>, <br>    <span class="hljs-attr">x</span>:<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(time) * <span class="hljs-number">1.5</span>,<br>    <span class="hljs-attr">y</span>:<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(time) * <span class="hljs-number">1.5</span>,<br>    <span class="hljs-attr">z</span>:<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(time) * <span class="hljs-number">1.5</span><br>&#125;)<br></code></pre></td></tr></table></figure>
<h2 id="让模型动起来"><a href="#让模型动起来" class="headerlink" title="让模型动起来"></a>让模型动起来</h2><p>恒定帧率渲染</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> quan = <span class="hljs-number">0</span><br><span class="hljs-built_in">setInterval</span>(<span class="hljs-function">()=&gt;</span>&#123;<br>    group.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> += <span class="hljs-number">0.01</span><br>    group.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> += <span class="hljs-number">0.01</span><br>    <span class="hljs-keyword">if</span>(quan &lt; <span class="hljs-number">360</span>)&#123;<br>        quan += <span class="hljs-number">1</span><br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        quan = <span class="hljs-number">1</span><br>    &#125;<br>    camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(quan * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>) * <span class="hljs-number">10</span><br>    camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">10</span><br>    camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(quan * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>) * <span class="hljs-number">10</span><br>    <span class="hljs-comment">// console.log(quan,camera.position)</span><br>    camera.<span class="hljs-title function_">lookAt</span>(group.<span class="hljs-property">position</span>)<br>    renderer.<span class="hljs-title function_">render</span>(scene, camera)<br>&#125;,<span class="hljs-number">30</span>)<br></code></pre></td></tr></table></figure>
<p>通过window.requestAnimationFrame实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> lastTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">tick</span> = (<span class="hljs-params"></span>)=&gt;&#123;<br>    <span class="hljs-keyword">let</span> time = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()<br>    <span class="hljs-keyword">const</span> deltaTime = time - lastTime<br>    lastTime = time<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(deltaTime) <span class="hljs-comment">// 上一次结束和这次开始之间的时间间隔</span><br>    camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> += <span class="hljs-number">0.001</span> * deltaTime<br>    camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> += <span class="hljs-number">0.001</span> * deltaTime<br>    renderer.<span class="hljs-title function_">render</span>(scene, camera)<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(tick)<br>&#125;<br><span class="hljs-title function_">tick</span>()<br></code></pre></td></tr></table></figure>
<p>通过threejs clock实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> clock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Clock</span>()<br><span class="hljs-keyword">let</span> quan = <span class="hljs-number">0</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">tick</span> = (<span class="hljs-params"></span>)=&gt;&#123;<br>    <span class="hljs-keyword">let</span> time = clock.<span class="hljs-title function_">getElapsedTime</span>()<br>    <br>    quan = time % <span class="hljs-number">365</span> * <span class="hljs-number">30</span> <span class="hljs-comment">// 角度根据时间取余360度后放大30倍</span><br>    <span class="hljs-comment">// 角度换算弧度 弧度 = 角度 * (Math.PI / 180);</span><br>    camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(quan * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>) * <span class="hljs-number">10</span><br>    camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(quan * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>) * <span class="hljs-number">10</span><br>    camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">10</span><br>    <span class="hljs-comment">// 直接使用时间也可以</span><br>    <span class="hljs-comment">// camera.position.x = Math.sin(time) * 10</span><br>    <span class="hljs-comment">// camera.position.z = Math.cos(time) * 10</span><br>    camera.<span class="hljs-title function_">lookAt</span>(group.<span class="hljs-property">position</span>)<br>    renderer.<span class="hljs-title function_">render</span>(scene, camera)<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(tick)<br>&#125;<br><span class="hljs-title function_">tick</span>()<br></code></pre></td></tr></table></figure>

<h2 id="使用数据控制相机移动"><a href="#使用数据控制相机移动" class="headerlink" title="使用数据控制相机移动"></a>使用数据控制相机移动</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">canvas.<span class="hljs-property">value</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;mousemove&#x27;</span>,<span class="hljs-function">(<span class="hljs-params">event:any</span>)=&gt;</span>&#123;<br>    <span class="hljs-comment">// x,y 的范围在 -1 到 1</span><br>    <span class="hljs-keyword">let</span> x = event.<span class="hljs-property">offsetX</span> / (pos.<span class="hljs-property">width</span> / <span class="hljs-number">2</span>) - <span class="hljs-number">0.5</span><br>    <span class="hljs-keyword">let</span> y = event.<span class="hljs-property">offsetY</span> / (pos.<span class="hljs-property">height</span> / <span class="hljs-number">2</span>) - <span class="hljs-number">0.5</span><br>    <span class="hljs-comment">// 使用x,y移动的距离来进行圆周移动计算 放大十倍 然后进行相机的移动</span><br>    camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(x * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>) * <span class="hljs-number">10</span><br>    camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(x * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>) * <span class="hljs-number">10</span><br>    camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(y * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) * <span class="hljs-number">10</span><br>    camera.<span class="hljs-title function_">lookAt</span>(group.<span class="hljs-property">position</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>

<h2 id="内置事件"><a href="#内置事件" class="headerlink" title="内置事件"></a>内置事件</h2><p>1.鼠标拖动</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">OrbitControls</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/controls/OrbitControls&#x27;</span><br><span class="hljs-keyword">const</span> controls = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, canvas.<span class="hljs-property">value</span>)<br>controls.<span class="hljs-property">minDistance</span> = <span class="hljs-number">2</span> <span class="hljs-comment">// 最小距离</span><br>controls.<span class="hljs-property">maxDistance</span> = <span class="hljs-number">10</span> <span class="hljs-comment">// 最大距离</span><br>controls.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 开启惯性</span><br><span class="hljs-comment">// 限制相机旋转角度 </span><br><span class="hljs-comment">// x轴的旋转角度 上下视角限制</span><br>controls.<span class="hljs-property">minPolarAngle</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// 俯视视角</span><br>controls.<span class="hljs-property">maxPolarAngle</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>; <span class="hljs-comment">// 90度 正视视角</span><br><span class="hljs-comment">// y轴的旋转角度 左右视角限制</span><br>controls.<span class="hljs-property">minAzimuthAngle</span> = -<span class="hljs-title class_">Infinity</span>; <span class="hljs-comment">// 左视 参数和x轴的参数相反</span><br>controls.<span class="hljs-property">maxAzimuthAngle</span> = <span class="hljs-title class_">Infinity</span>; <span class="hljs-comment">// 右视</span><br><br><span class="hljs-comment">// 给controls添加事件监听</span><br>controls.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;change&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>&#125;)<br>controls.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;start&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>&#125;)<br>controls.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>&#125;)<br><br><span class="hljs-comment">// 需要在window.requestAnimationFrame()中添加代码</span><br>controls.<span class="hljs-title function_">update</span>()<br></code></pre></td></tr></table></figure>

<h2 id="使用BufferGeometry创建几何体"><a href="#使用BufferGeometry创建几何体" class="headerlink" title="使用BufferGeometry创建几何体"></a>使用BufferGeometry创建几何体</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 创建一个三元数组 用来设置线的属性</span><br><span class="hljs-keyword">const</span> positionAttr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>([<br>    <span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<br>    <span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<br>    <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<br>    <span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span><br>])<br><span class="hljs-comment">// 创建一个线</span><br><span class="hljs-keyword">const</span> lineGeometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">BufferGeometry</span>()<br><span class="hljs-comment">// 设置线的属性 3代表三元属性 每个点有三个参数构成</span><br>lineGeometry.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;position&#x27;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">BufferAttribute</span>(positionAttr,<span class="hljs-number">3</span>))<br><span class="hljs-comment">// 创建线模型 将线和材质绑定后添加到场景中 </span><br>scene.<span class="hljs-title function_">add</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Line</span>(lineGeometry,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">LineBasicMaterial</span>(&#123;<span class="hljs-attr">color</span>:<span class="hljs-number">0xff00ff</span>&#125;)))<br></code></pre></td></tr></table></figure>
<h3 id="创建线段"><a href="#创建线段" class="headerlink" title="创建线段"></a>创建线段</h3><p><a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html?q=line#api/zh/objects/Line">Line</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> lineMaterial = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">LineBasicMaterial</span>( &#123;<br>  <span class="hljs-attr">color</span>: <span class="hljs-number">0xffffff</span>,<br>  <span class="hljs-attr">linewidth</span>: <span class="hljs-number">1</span>,<br>  <span class="hljs-attr">linecap</span>: <span class="hljs-string">&#x27;round&#x27;</span>, <span class="hljs-comment">//ignored by WebGLRenderer</span><br>  <span class="hljs-attr">linejoin</span>:  <span class="hljs-string">&#x27;round&#x27;</span> <span class="hljs-comment">//ignored by WebGLRenderer</span><br>&#125; );<br><span class="hljs-keyword">const</span> points = [];<br>points.<span class="hljs-title function_">push</span>( <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Vector3</span>( - <span class="hljs-number">10</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span> ) );<br>points.<span class="hljs-title function_">push</span>( <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Vector3</span>( <span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0</span> ) );<br>points.<span class="hljs-title function_">push</span>( <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Vector3</span>( <span class="hljs-number">10</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span> ) );<br><br><span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">BufferGeometry</span>().<span class="hljs-title function_">setFromPoints</span>( points );<br><br><span class="hljs-keyword">const</span> line = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Line</span>( geometry, lineMaterial );<br>scene.<span class="hljs-title function_">add</span>( line );<br></code></pre></td></tr></table></figure>
<h3 id="创建闭合线段"><a href="#创建闭合线段" class="headerlink" title="创建闭合线段"></a>创建闭合线段</h3><p><a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html?q=line#api/zh/objects/LineLoop">LineLoop</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> line = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">LineLoop</span>( geometry, lineMaterial );<br></code></pre></td></tr></table></figure>

<h2 id="设置环境颜色"><a href="#设置环境颜色" class="headerlink" title="设置环境颜色"></a>设置环境颜色</h2><p>需要改变渲染器的颜色</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 创建一个渲染器</span><br><span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">WebGLRenderer</span>(&#123;<br>    <span class="hljs-attr">canvas</span>:canvas.<span class="hljs-property">value</span><br>&#125;)<br>renderer.<span class="hljs-title function_">setClearColor</span>(<span class="hljs-number">0xdfdfdf</span>, <span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure>
<h3 id="添加云雾效果"><a href="#添加云雾效果" class="headerlink" title="添加云雾效果"></a>添加云雾效果</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 添加雾效 当雾颜色和渲染器颜色相同时，远距离会导致物体隐藏</span><br><span class="hljs-keyword">const</span> fog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Fog</span>(<span class="hljs-number">0xdfdfdf</span>, <span class="hljs-number">1</span>,<span class="hljs-number">10</span>) <span class="hljs-comment">// 颜色 距离相机的近距离 距离相机的远距离(超过远距离则不显示)</span><br>scene.<span class="hljs-property">fog</span> = fog<br></code></pre></td></tr></table></figure>

<h2 id="相机"><a href="#相机" class="headerlink" title="相机"></a>相机</h2><h3 id="透视相机"><a href="#透视相机" class="headerlink" title="透视相机"></a>透视相机</h3><p>符合人眼的透视效果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, pos.<span class="hljs-property">width</span> / pos.<span class="hljs-property">height</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">100</span>)<br>camera.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">10</span>,<span class="hljs-number">20</span>,<span class="hljs-number">30</span>) <span class="hljs-comment">// x y z</span><br>camera.<span class="hljs-title function_">lookAt</span>(group.<span class="hljs-property">position</span>)<br><span class="hljs-comment">// 添加相机辅助控件 </span><br><span class="hljs-comment">// 会显示相机的位置和方向</span><br><span class="hljs-keyword">const</span> cameraHelper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">CameraHelper</span>(camera)<br>scene.<span class="hljs-title function_">add</span>(camera,cameraHelper)<br></code></pre></td></tr></table></figure>

<h2 id="光源"><a href="#光源" class="headerlink" title="光源"></a>光源</h2><h3 id="环境光"><a href="#环境光" class="headerlink" title="环境光"></a>环境光</h3><p><a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/lights/AmbientLight">AmbientLight</a><br>环境光不能单独存在,单独添加不会有效果<br>环境光会均匀的照亮场景中的所有物体。<br>环境光不能用来投射阴影，因为它没有方向。<br>某些材质（如基本材质<code> BasicMaterial</code>）可能不支持光照效果，或者对光照的响应不明显。尝试使用支持光照的材质，如 <code>MeshStandardMaterial</code> 或 <code>MeshPhongMaterial</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> ambientLight = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">AmbientLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">1</span>)<br><span class="hljs-comment">// 不能设置位置</span><br>scene.<span class="hljs-title function_">add</span>(ambientLight)<br></code></pre></td></tr></table></figure>
<h3 id="平行光"><a href="#平行光" class="headerlink" title="平行光"></a>平行光</h3><p><a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/lights/DirectionalLight">DirectionalLight</a><br>平行光是沿着特定方向发射的光。这种光的表现像是无限远，从它发出的光线都是平行的。常常用平行光来模拟太阳光的效果。 太阳足够远，因此我们可以认为太阳的位置是无限远，所以我们认为从太阳发出的光线也都是平行的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> directionalLight = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">1</span>)<br>directionalLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(-<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>) <span class="hljs-comment">// 设置平行光的位置</span><br>directionalLight.<span class="hljs-property">target</span>.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>,-<span class="hljs-number">3</span>,<span class="hljs-number">0</span>) <span class="hljs-comment">// 设置平行光照射的目标</span><br>directionalLight.<span class="hljs-property">target</span>.<span class="hljs-title function_">updateMatrixWorld</span>() <span class="hljs-comment">// 更新目标</span><br>scene.<span class="hljs-title function_">add</span>(directionalLight)<br><span class="hljs-comment">// 平行光辅助线</span><br><span class="hljs-keyword">const</span> helper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">DirectionalLightHelper</span>( light, <span class="hljs-number">5</span> ); <span class="hljs-comment">// 光源 尺寸 颜色</span><br>scene.<span class="hljs-title function_">add</span>( helper );<br></code></pre></td></tr></table></figure>
<h3 id="半球光"><a href="#半球光" class="headerlink" title="半球光"></a>半球光</h3><p><a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/lights/HemisphereLight">HemisphereLight</a><br>光源直接放置于场景之上，光照颜色从天空光线颜色渐变到地面光线颜色。<br>半球光不能投射阴影</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> light = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">HemisphereLight</span>( <span class="hljs-number">0xffffbb</span>, <span class="hljs-number">0x080820</span>, <span class="hljs-number">1</span> ); <span class="hljs-comment">// 顶部照射颜色 底部照射颜色</span><br><span class="hljs-keyword">const</span> helper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">HemisphereLightHelper</span>( light, <span class="hljs-number">5</span> );<br>scene.<span class="hljs-title function_">add</span>( light,helper );<br></code></pre></td></tr></table></figure>
<h3 id="点光源"><a href="#点光源" class="headerlink" title="点光源"></a>点光源</h3><p><a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/lights/PointLight">PointLight</a><br>从一个点向各个方向发射的光源。一个常见的例子是模拟一个灯泡发出的光。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> pointLight = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">PointLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">1</span>)<br>pointLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(-<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,-<span class="hljs-number">2</span>) <span class="hljs-comment">// 设置点光源的位置</span><br><span class="hljs-comment">// 添加点光源辅助</span><br><span class="hljs-keyword">const</span> pointLightHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PointLightHelper</span>( pointLight, <span class="hljs-number">1</span> );<br>scene.<span class="hljs-title function_">add</span>(pointLight,pointLightHelper)<br></code></pre></td></tr></table></figure>
<h3 id="平面光光源"><a href="#平面光光源" class="headerlink" title="平面光光源"></a>平面光光源</h3><p><a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/lights/RectAreaLight">RectAreaLight</a><br>平面光光源从一个矩形平面上均匀地发射光线。这种光源可以用来模拟像明亮的窗户或者条状灯光光源。<br>注意事项:</p>
<ul>
<li>不支持阴影。</li>
<li>只支持 MeshStandardMaterial 和 MeshPhysicalMaterial 两种材质。</li>
<li>你必须在你的场景中加入 RectAreaLightUniformsLib，并调用 init()。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> width = <span class="hljs-number">10</span>;<br><span class="hljs-keyword">const</span> height = <span class="hljs-number">10</span>;<br><span class="hljs-keyword">const</span> intensity = <span class="hljs-number">1</span>; <span class="hljs-comment">// 强度</span><br><span class="hljs-keyword">const</span> rectLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">RectAreaLight</span>( <span class="hljs-number">0xffffff</span>, intensity,  width, height );<br>rectLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>( <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0</span> );<br>rectLight.<span class="hljs-title function_">lookAt</span>( <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span> );<br>scene.<span class="hljs-title function_">add</span>( rectLight )<br><span class="hljs-comment">// 需要辅助引入插件</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">RectAreaLightHelper</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/helpers/RectAreaLightHelper.js&#x27;</span><br><span class="hljs-keyword">const</span> rectLightHelper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RectAreaLightHelper</span>( rectLight );<br>scene.<span class="hljs-title function_">add</span>( rectLightHelper );<br></code></pre></td></tr></table></figure>

<h3 id="聚光灯"><a href="#聚光灯" class="headerlink" title="聚光灯"></a>聚光灯</h3><p><a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/lights/SpotLight">SpotLight</a><br>光线从一个点沿一个方向射出，随着光线照射的变远，光线圆锥体的尺寸也逐渐增大。<br>该光源可以投射阴影。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> spotLight = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">SpotLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">1</span>)<br>spotLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(-<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,-<span class="hljs-number">2</span>) <span class="hljs-comment">// 设置聚光灯的位置</span><br>spotLight.<span class="hljs-property">map</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TextureLoader</span>().<span class="hljs-title function_">load</span>( url ); <span class="hljs-comment">// 聚光灯可以设置贴图(可选)</span><br><span class="hljs-keyword">const</span> spotLightHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">SpotLightHelper</span>( spotLight );<br>scene.<span class="hljs-title function_">add</span>(spotLight,spotLightHelper)<br></code></pre></td></tr></table></figure>

<h2 id="添加测试组件"><a href="#添加测试组件" class="headerlink" title="添加测试组件"></a>添加测试组件</h2><p><a target="_blank" rel="noopener" href="https://lil-gui.georgealways.com/">lil-gui官方文档</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install lil-gui --save<br></code></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-variable constant_">GUI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;lil-gui&#x27;</span><br><span class="hljs-keyword">const</span> gui = <span class="hljs-keyword">new</span> <span class="hljs-title function_">GUI</span>()<br><span class="hljs-comment">// 第一种设置方式</span><br><span class="hljs-comment">// 对象 属性 名称 最小值 最大值 步长</span><br>gui.<span class="hljs-title function_">add</span>(camera,<span class="hljs-string">&#x27;position&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,-<span class="hljs-number">10</span>,<span class="hljs-number">10</span>,<span class="hljs-number">0.1</span>)<br><span class="hljs-comment">// 第二种设置方式 更清晰</span><br>gui.<span class="hljs-title function_">add</span>(camera,<span class="hljs-string">&#x27;position&#x27;</span>,<span class="hljs-string">&#x27;y&#x27;</span>).<span class="hljs-title function_">min</span>(-<span class="hljs-number">10</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.1</span>).<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;y轴位置&#x27;</span>)<br></code></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js">gui.<span class="hljs-title function_">add</span>(mesh,<span class="hljs-string">&#x27;visible&#x27;</span>) <span class="hljs-comment">// 是否可见的复选框</span><br>gui.<span class="hljs-title function_">add</span>(mesh.<span class="hljs-property">material</span>,<span class="hljs-string">&#x27;wireframe&#x27;</span>).<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;材质&#x27;</span>) <span class="hljs-comment">// 材质的线框</span><br></code></pre></td></tr></table></figure>
<h3 id="添加一个颜色选择器"><a href="#添加一个颜色选择器" class="headerlink" title="添加一个颜色选择器"></a>添加一个颜色选择器</h3><p>直接修改会发现选择的颜色和材质的颜色不一致</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">gui.<span class="hljs-title function_">addColor</span>(mesh.<span class="hljs-property">material</span>,<span class="hljs-string">&#x27;color&#x27;</span>) <span class="hljs-comment">// 添加颜色选择器</span><br></code></pre></td></tr></table></figure>
<p>改良方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> debugObject = &#123;<br>    <span class="hljs-attr">color</span>:<span class="hljs-string">&#x27;#333333&#x27;</span><br>&#125;<br><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshStandardMaterial</span>(&#123;<span class="hljs-attr">color</span>: debugObject.<span class="hljs-property">color</span>,<span class="hljs-attr">opacity</span>:<span class="hljs-number">1</span>,<span class="hljs-attr">transparent</span>:<span class="hljs-literal">true</span>&#125;)<br>gui.<span class="hljs-title function_">addColor</span>(debugObject,<span class="hljs-string">&#x27;color&#x27;</span>).<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;颜色&#x27;</span>).<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">value</span>)=&gt;</span>&#123;<br>    mesh.<span class="hljs-property">material</span>.<span class="hljs-property">color</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Color</span>(value)<br>    <span class="hljs-comment">// 或者</span><br>    mesh.<span class="hljs-property">material</span>.<span class="hljs-property">color</span>.<span class="hljs-title function_">set</span>(value)<br>&#125;)<br></code></pre></td></tr></table></figure>
<h3 id="添加按钮并添加事件"><a href="#添加按钮并添加事件" class="headerlink" title="添加按钮并添加事件"></a>添加按钮并添加事件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">debugObject.<span class="hljs-property">move</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    mesh.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> += <span class="hljs-number">0.1</span><br>&#125;<br>gui.<span class="hljs-title function_">add</span>(debugObject,<span class="hljs-string">&#x27;move&#x27;</span>).<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;移动&#x27;</span>)<br></code></pre></td></tr></table></figure>
<h3 id="设置相机回到初始位置"><a href="#设置相机回到初始位置" class="headerlink" title="设置相机回到初始位置"></a>设置相机回到初始位置</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">debugObject.<span class="hljs-property">move</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    gsap.<span class="hljs-title function_">to</span>(camera.<span class="hljs-property">position</span>,&#123;<br>        duration : <span class="hljs-number">1</span>,<br>        x : <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-number">0.5</span>) * <span class="hljs-number">10</span>,<br>        y : <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-number">0.5</span>) * <span class="hljs-number">10</span>,<br>        z : <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-number">0.8</span>) * <span class="hljs-number">10</span><br>    &#125;)<br>&#125;<br>gui.<span class="hljs-title function_">add</span>(debugObject,<span class="hljs-string">&#x27;move&#x27;</span>).<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;移动&#x27;</span>)<br></code></pre></td></tr></table></figure>
<h3 id="修改网格数量"><a href="#修改网格数量" class="headerlink" title="修改网格数量"></a>修改网格数量</h3><p>修改网格数量相对麻烦 没有直接修改的方法 所以只能先删除原来的 再添加新的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js">debugObject.<span class="hljs-property">geometry</span> = &#123;<br>    <span class="hljs-attr">geometry</span>:<span class="hljs-number">1</span><br>&#125;<br>    gui.<span class="hljs-title function_">add</span>(debugObject.<span class="hljs-property">geometry</span>,<span class="hljs-string">&#x27;geometry&#x27;</span>).<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;网格数量&#x27;</span>).<span class="hljs-title function_">min</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">onFinishChange</span>(<span class="hljs-function">(<span class="hljs-params">e</span>)=&gt;</span>&#123;<br>    mesh.<span class="hljs-property">geometry</span>.<span class="hljs-title function_">dispose</span>() <span class="hljs-comment">// 销毁原来的几何体</span><br>    mesh.<span class="hljs-property">geometry</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, e, e, e) <span class="hljs-comment">// 重新设置几何体</span><br>&#125;)<br></code></pre></td></tr></table></figure>
<h3 id="创建一个编组"><a href="#创建一个编组" class="headerlink" title="创建一个编组"></a>创建一个编组</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 创建一个编组</span><br><span class="hljs-keyword">const</span> folder = gui.<span class="hljs-title function_">addFolder</span>(<span class="hljs-string">&#x27;编组1&#x27;</span>)<br>folder.<span class="hljs-title function_">add</span>(camera.<span class="hljs-property">position</span>,<span class="hljs-string">&#x27;x&#x27;</span>).<span class="hljs-title function_">min</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.01</span>)<br>folder.<span class="hljs-title function_">close</span>() <span class="hljs-comment">// 默认关闭分组</span><br></code></pre></td></tr></table></figure>
<h3 id="面板的基本参数设置"><a href="#面板的基本参数设置" class="headerlink" title="面板的基本参数设置"></a>面板的基本参数设置</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> gui = <span class="hljs-keyword">new</span> <span class="hljs-title function_">GUI</span>(&#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-number">300</span>, <span class="hljs-comment">// gui 面板宽度</span><br>  <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;控制面板&#x27;</span>, <span class="hljs-comment">// 标题</span><br>  <span class="hljs-attr">closeFolders</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 默认收起所有文件夹 true为收起</span><br>&#125;)<br>gui.<span class="hljs-title function_">close</span>() <span class="hljs-comment">//默认收起gui面板</span><br>gui.<span class="hljs-title function_">hide</span>() <span class="hljs-comment">// 隐藏gui面板</span><br>gui.<span class="hljs-title function_">show</span>() <span class="hljs-comment">// 显示gui面板</span><br><span class="hljs-comment">// 实现按键控制显示隐藏</span><br><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;keydown&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">&#x27;h&#x27;</span>) gui.<span class="hljs-title function_">show</span>(gui.<span class="hljs-property">_hidden</span>) <span class="hljs-comment">// 按下h键显示隐藏gui面板</span><br>&#125;)<br></code></pre></td></tr></table></figure>
<h2 id="帧数显示插件-stats-js"><a href="#帧数显示插件-stats-js" class="headerlink" title="帧数显示插件 stats.js"></a>帧数显示插件 stats.js</h2><p><a target="_blank" rel="noopener" href="https://github.com/mrdoob/stats.js/tree/master">github地址</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install stats.js --save<br></code></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Stats</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;stats.js&#x27;</span>;<br><span class="hljs-comment">// 此处也可能写成 import * as Stats from &#x27;stats.js&#x27; 可以看源码怎么写的再做处理</span><br><span class="hljs-keyword">const</span> clock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Clock</span>()<br><span class="hljs-keyword">var</span> stats = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stats</span>();<br>stats.<span class="hljs-title function_">showPanel</span>( <span class="hljs-number">0</span> ); <span class="hljs-comment">// 0: fps, 1: ms, 2: mb, 3+: custom</span><br><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>( stats.<span class="hljs-property">dom</span> );<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">let</span> time = clock.<span class="hljs-title function_">getElapsedTime</span>()<br>    stats.<span class="hljs-title function_">begin</span>();<br><br>    camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(time) * <span class="hljs-number">10</span><br>    camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(time) * <span class="hljs-number">10</span><br>    camera.<span class="hljs-title function_">lookAt</span>(group.<span class="hljs-property">position</span>)<br>    controls.<span class="hljs-title function_">update</span>()<br>    renderer.<span class="hljs-title function_">render</span>(scene, camera)<br><br>    stats.<span class="hljs-title function_">end</span>();<br>    <span class="hljs-title function_">requestAnimationFrame</span>( animate );<br>&#125;<br><span class="hljs-title function_">requestAnimationFrame</span>( animate );<br></code></pre></td></tr></table></figure>

<h2 id="材质"><a href="#材质" class="headerlink" title="材质"></a>材质</h2><h3 id="加载图片材质"><a href="#加载图片材质" class="headerlink" title="加载图片材质"></a>加载图片材质</h3><p>麻烦的方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 加载一张图片作为纹理贴图</span><br><span class="hljs-keyword">const</span> img = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>()<br>img.<span class="hljs-property">src</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/1.jpg&#x27;</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>; <span class="hljs-comment">// vite加载资源的url 直接写不能加载</span><br><span class="hljs-comment">// 先把图片绑定到材质上 然后等待图片加载完成 更新材质</span><br><span class="hljs-keyword">const</span> texture = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Texture</span>(img) <span class="hljs-comment">// 创建纹理贴图  </span><br>img.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;图片加载完成.&#x27;</span>)<br>    texture.<span class="hljs-property">needsUpdate</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 更新纹理贴图  </span><br>&#125;<br><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123;<span class="hljs-attr">map</span>:texture&#125;)<br></code></pre></td></tr></table></figure>
<p>使用threejs加载器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> material = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">const</span> loader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">TextureLoader</span>()<br>loader.<span class="hljs-title function_">load</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/1.jpg&#x27;</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>, <span class="hljs-function">(<span class="hljs-params">texture</span>) =&gt;</span> &#123;<br>    material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123;<span class="hljs-attr">map</span>:texture&#125;)<br>&#125;)<br></code></pre></td></tr></table></figure>
<h3 id="配置信息"><a href="#配置信息" class="headerlink" title="配置信息"></a>配置信息</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js">texture.<span class="hljs-property">repeat</span>.<span class="hljs-property">x</span> = <span class="hljs-number">2</span>  <span class="hljs-comment">// 重复纹理次数</span><br>texture.<span class="hljs-property">repeat</span>.<span class="hljs-property">y</span> = <span class="hljs-number">2</span>  <span class="hljs-comment">// 重复纹理次数</span><br>texture.<span class="hljs-property">wrapS</span> = <span class="hljs-title class_">Three</span>.<span class="hljs-property">RepeatWrapping</span> <span class="hljs-comment">// 水平重复方式</span><br>texture.<span class="hljs-property">wrapT</span> = <span class="hljs-title class_">Three</span>.<span class="hljs-property">RepeatWrapping</span> <span class="hljs-comment">// 垂直重复方式</span><br>texture.<span class="hljs-property">anisotropy</span> = <span class="hljs-number">16</span> <span class="hljs-comment">// 纹理放大倍数</span><br>texture.<span class="hljs-property">offset</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0.5</span>  <span class="hljs-comment">// 纹理偏移</span><br>texture.<span class="hljs-property">offset</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0.5</span>  <span class="hljs-comment">// 纹理偏移</span><br>texture.<span class="hljs-property">rotation</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">4</span> <span class="hljs-comment">// 纹理旋转</span><br>texture.<span class="hljs-property">center</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0.5</span>  <span class="hljs-comment">// 纹理中心点</span><br>texture.<span class="hljs-property">center</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0.5</span>  <span class="hljs-comment">// 纹理中心点</span><br>texture.<span class="hljs-property">generateMipmaps</span> = <span class="hljs-literal">false</span> <span class="hljs-comment">// 是否根据相机的远近进行纹理放大和缩小</span><br><span class="hljs-comment">// 大图片缩小用这个不模糊 会出摩尔纹</span><br>texture.<span class="hljs-property">minFilter</span> = <span class="hljs-title class_">Three</span>.<span class="hljs-property">NearestFilter</span> <span class="hljs-comment">// 纹理过滤方式</span><br><span class="hljs-comment">// 小图片放大用这个不会模糊边界  </span><br>texture.<span class="hljs-property">magFilter</span> = <span class="hljs-title class_">Three</span>.<span class="hljs-property">NearestFilter</span> <span class="hljs-comment">// 纹理过滤方式</span><br><span class="hljs-comment">// 如果显示的图片和实际图片颜色不一致，可以设置一下</span><br>texture.<span class="hljs-property">colorSpace</span> = <span class="hljs-title class_">Three</span>.<span class="hljs-property">SRGBColorSpace</span> <span class="hljs-comment">// 颜色空间</span><br></code></pre></td></tr></table></figure>

<h2 id="材料"><a href="#材料" class="headerlink" title="材料"></a>材料</h2><h3 id="基础材质"><a href="#基础材质" class="headerlink" title="基础材质"></a>基础材质</h3><p><a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/materials/LineBasicMaterial">一种用于绘制线框样式几何体的材质。</a><br>不受光照影响的材质</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123;<span class="hljs-attr">color</span>:<span class="hljs-number">0xff0000</span>&#125;) <span class="hljs-comment">// 红色</span><br><span class="hljs-comment">// 常用选项</span><br>material.<span class="hljs-property">map</span> = texture; <span class="hljs-comment">// 纹理贴图</span><br>material.<span class="hljs-property">color</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Color</span>(<span class="hljs-number">0xfffff</span>); <span class="hljs-comment">// 颜色</span><br>material.<span class="hljs-property">wireframe</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 显示线框</span><br>material.<span class="hljs-property">transparent</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 透明</span><br>material.<span class="hljs-property">opacity</span> = <span class="hljs-number">0.5</span>; <span class="hljs-comment">// 不透明度</span><br>material.<span class="hljs-property">side</span> = <span class="hljs-title class_">Three</span>.<span class="hljs-property">DoubleSide</span>; <span class="hljs-comment">// 两面显示 会消耗更过GPU</span><br>material.<span class="hljs-property">alphaMap</span> = texture; <span class="hljs-comment">// 透明贴图 白色显示 黑色隐藏 需要和transparent配合使用</span><br></code></pre></td></tr></table></figure>
<h3 id="点材质"><a href="#点材质" class="headerlink" title="点材质"></a>点材质</h3><p><a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html?q=points#api/zh/materials/PointsMaterial">PointsMaterial</a><br>可以将物体的分段线段绘制为点</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 加载贴图</span><br><span class="hljs-keyword">const</span> loader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">TextureLoader</span>()<br><span class="hljs-keyword">let</span> texture = loader.<span class="hljs-title function_">load</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/bg.jpg&#x27;</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>)<br><span class="hljs-keyword">const</span> sphere = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">SphereGeometry</span>(<span class="hljs-number">1</span>,<span class="hljs-number">32</span>,<span class="hljs-number">32</span>)<br><span class="hljs-keyword">const</span> masterial = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">PointsMaterial</span>(&#123;<br>    <span class="hljs-attr">size</span>:<span class="hljs-number">0.01</span>, <span class="hljs-comment">// 设置点大小</span><br>    <span class="hljs-attr">sizeAttenuation</span>:<span class="hljs-literal">true</span> <span class="hljs-comment">// 指定点的大小是否因相机深度而衰减。（仅限透视摄像头。）默认为true。</span><br>    <span class="hljs-attr">map</span>:texture, <span class="hljs-comment">// 纹理贴图(纹理会渲染到每个点上)</span><br>    <span class="hljs-attr">alphaMap</span>:texture, <span class="hljs-comment">// 透明度贴图 显示出透明部分后面的物体</span><br>    <span class="hljs-attr">alphaTest</span>:<span class="hljs-number">0.5</span>, <span class="hljs-comment">// 透明度测试</span><br>    <span class="hljs-attr">depthTest</span>:<span class="hljs-literal">true</span>, <span class="hljs-comment">// 深度测试 物体不会遮挡其他物体(会导致所有物体都显示出来)</span><br>    <span class="hljs-attr">depthWrite</span>:<span class="hljs-literal">false</span>, <span class="hljs-comment">// 深度写入 除非特殊情况,这种效果已经很好了</span><br>    <span class="hljs-attr">blending</span>:<span class="hljs-title class_">Three</span>.<span class="hljs-property">AdditiveBlending</span>, <span class="hljs-comment">// 设置混合模式 相近的颜色会叠加在一起</span><br>    <span class="hljs-attr">vertexColors</span>:<span class="hljs-literal">true</span>, <span class="hljs-comment">// 顶点颜色 Three.VertexColors 基础颜色color会影响设置的顶点颜色</span><br>    fog : <span class="hljs-title class_">Boolean</span>, <span class="hljs-comment">//材质是否受雾影响。默认为true。</span><br>&#125;)<br><span class="hljs-keyword">const</span> mesh = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Points</span>(sphere,masterial)<br>scene.<span class="hljs-title function_">add</span>(mesh)<br></code></pre></td></tr></table></figure>
<h3 id="创建固定个数的随机点"><a href="#创建固定个数的随机点" class="headerlink" title="创建固定个数的随机点"></a>创建固定个数的随机点</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 创建点材质</span><br><span class="hljs-keyword">const</span> masterial = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">PointsMaterial</span>(&#123;<br>    <span class="hljs-attr">color</span>:<span class="hljs-number">0xff0000</span>,<br>    <span class="hljs-attr">size</span>:<span class="hljs-number">0.02</span>,<br>    <span class="hljs-attr">sizeAttenuation</span>:<span class="hljs-literal">true</span><br>&#125;)<br><span class="hljs-comment">// 创建几何体</span><br><span class="hljs-keyword">const</span> bufferGeometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">BufferGeometry</span>() <br><span class="hljs-comment">// 创建点坐标数组</span><br><span class="hljs-keyword">const</span> pointArr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(<span class="hljs-number">5000</span> * <span class="hljs-number">3</span>)<br><span class="hljs-keyword">const</span> colorArr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(<span class="hljs-number">5000</span> * <span class="hljs-number">3</span>)<br><span class="hljs-comment">// 添加数据到数组中</span><br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>;i &lt; pointArr.<span class="hljs-property">length</span>;i++)&#123;<br>    pointArr[i] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">2</span> - <span class="hljs-number">1</span><br>    colorArr[i] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()  <span class="hljs-comment">// 0-1之间 不是0-255之间 </span><br>&#125;<br><span class="hljs-comment">// 添加数据到几何体中</span><br><span class="hljs-comment">// 位置</span><br>bufferGeometry.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;position&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">BufferAttribute</span>(pointArr,<span class="hljs-number">3</span>))<br><span class="hljs-comment">// 颜色</span><br>bufferGeometry.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;color&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">BufferAttribute</span>(colorArr,<span class="hljs-number">3</span>))<br><span class="hljs-comment">// 创建点</span><br><span class="hljs-keyword">const</span> m1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Points</span>(bufferGeometry,masterial)<br>scene.<span class="hljs-title function_">add</span>(m1)<br></code></pre></td></tr></table></figure>
<h3 id="让点动起来"><a href="#让点动起来" class="headerlink" title="让点动起来"></a>让点动起来</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> clock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Clock</span>()<br><span class="hljs-keyword">var</span> stats = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stats</span>();<br>stats.<span class="hljs-title function_">showPanel</span>( <span class="hljs-number">0</span> ); <span class="hljs-comment">// 0: fps, 1: ms, 2: mb, 3+: custom</span><br><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>( stats.<span class="hljs-property">dom</span> );<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">let</span> time = clock.<span class="hljs-title function_">getElapsedTime</span>()<br>    stats.<span class="hljs-title function_">begin</span>();<br><br>    <span class="hljs-comment">// 让每一个点分别动起来</span><br>    <span class="hljs-comment">// 以三个数组为一组操作数据 i = 1 则是 xyz 从y开始</span><br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>;i &lt; m1.<span class="hljs-property">geometry</span>.<span class="hljs-property">attributes</span>.<span class="hljs-property">position</span>.<span class="hljs-property">array</span>.<span class="hljs-property">length</span>;i+=<span class="hljs-number">3</span>)&#123;<br>        <span class="hljs-comment">// 获取到每个点的x值</span><br>        <span class="hljs-keyword">let</span> x = m1.<span class="hljs-property">geometry</span>.<span class="hljs-property">attributes</span>.<span class="hljs-property">position</span>.<span class="hljs-property">array</span>[i - <span class="hljs-number">1</span>]<br>        <span class="hljs-comment">// 设置每个点的y值为时间+x轴坐标的sin值 让他进行sin波动</span><br>        m1.<span class="hljs-property">geometry</span>.<span class="hljs-property">attributes</span>.<span class="hljs-property">position</span>.<span class="hljs-property">array</span>[i] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(time+x*<span class="hljs-number">5</span>) <span class="hljs-comment">// Math.sin(time + i/10) * 3</span><br>    &#125;<br>    <span class="hljs-comment">// 告诉渲染器数据在更新重新渲染</span><br>    m1.<span class="hljs-property">geometry</span>.<span class="hljs-property">attributes</span>.<span class="hljs-property">position</span>.<span class="hljs-property">needsUpdate</span> = <span class="hljs-literal">true</span><br><br>    controls.<span class="hljs-title function_">update</span>()<br>    renderer.<span class="hljs-title function_">render</span>(scene, camera)<br>    stats.<span class="hljs-title function_">end</span>();<br>    <span class="hljs-title function_">requestAnimationFrame</span>( animate );<br>&#125;<br><span class="hljs-title function_">requestAnimationFrame</span>( animate );<br></code></pre></td></tr></table></figure>

<h3 id="法线网格材质"><a href="#法线网格材质" class="headerlink" title="法线网格材质"></a>法线网格材质</h3><p><a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/materials/MeshNormalMaterial">一种把法向量映射到RGB颜色的材质。</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshNormalMaterial</span>()<br><br><span class="hljs-comment">// 多一个属性</span><br>material.<span class="hljs-property">flatShading</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 法线阴影 会产生平坦的阴影</span><br></code></pre></td></tr></table></figure>
<h3 id="材质捕捉"><a href="#材质捕捉" class="headerlink" title="材质捕捉"></a>材质捕捉</h3><p>会在材质表面反射出加载图像的内容 像是照镜子<br>不受光照影响的材质</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshMatcapMaterial</span>()<br>material.<span class="hljs-property">matcap</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">TextureLoader</span>().<span class="hljs-title function_">load</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/1.jpg&#x27;</span>,<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>)<br></code></pre></td></tr></table></figure>
<h3 id="深度网格材质"><a href="#深度网格材质" class="headerlink" title="深度网格材质"></a>深度网格材质</h3><p>根据距离摄像机的距离来显示材质 (距离越近显示越亮)<br>可以用来实现云雾等效果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshDepthMaterial</span>()<br></code></pre></td></tr></table></figure>
<h3 id="Lambert网格材质"><a href="#Lambert网格材质" class="headerlink" title="Lambert网格材质"></a>Lambert网格材质</h3><p><a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/materials/MeshLambertMaterial">MeshLambertMaterial</a><br>一种非光泽表面的材质，没有镜面高光。<br>该材质使用基于非物理的Lambertian模型来计算反射率。 这可以很好地模拟一些表面（例如未经处理的木材或石材），但不能模拟具有镜面高光的光泽表面（例如涂漆木材）。 MeshLambertMaterial uses per-fragment shading。<br>由于反射率和光照模型的简单性，MeshPhongMaterial，MeshStandardMaterial或者MeshPhysicalMaterial 上使用这种材质时会以一些图形精度为代价，得到更高的性能。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshLambertMaterial</span>()<br></code></pre></td></tr></table></figure>
<h3 id="Phong网格材质"><a href="#Phong网格材质" class="headerlink" title="Phong网格材质"></a>Phong网格材质</h3><p><a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/materials/MeshPhongMaterial">MeshPhongMaterial</a><br>一种用于具有镜面高光的光泽表面的材质。<br>该材质使用非物理的Blinn-Phong模型来计算反射率。 与MeshLambertMaterial中使用的Lambertian模型不同，该材质可以模拟具有镜面高光的光泽表面（例如涂漆木材）。MeshPhongMaterial uses per-fragment shading。<br>在MeshStandardMaterial或MeshPhysicalMaterial上使用此材质时，性能通常会更高 ，但会牺牲一些图形精度。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshPhongMaterial</span>()<br></code></pre></td></tr></table></figure>
<h3 id="标准网格材质"><a href="#标准网格材质" class="headerlink" title="标准网格材质"></a>标准网格材质</h3><p><a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/materials/MeshStandardMaterial">MeshStandardMaterial</a><br>一种基于物理的标准材质，使用Metallic-Roughness工作流程。<br>基于物理的渲染（PBR）最近已成为许多3D应用程序的标准，例如Unity， Unreal和 3D Studio Max。<br>这种方法与旧方法的不同之处在于，不使用近似值来表示光与表面的相互作用，而是使用物理上正确的模型。 我们的想法是，不是在特定照明下调整材质以使其看起来很好，而是可以创建一种材质，能够“正确”地应对所有光照场景。<br>在实践中，该材质提供了比MeshLambertMaterial 或MeshPhongMaterial 更精确和逼真的结果，代价是计算成本更高。MeshStandardMaterial uses per-fragment shading。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshStandardMaterial</span>(&#123;<br>    <span class="hljs-attr">roughness</span>: <span class="hljs-number">0.5</span>, <span class="hljs-comment">// 粗糙度</span><br>    <span class="hljs-attr">metalness</span>: <span class="hljs-number">0.2</span>, <span class="hljs-comment">// 金属度</span><br>&#125;)<br></code></pre></td></tr></table></figure>
<h3 id="物理网格材质"><a href="#物理网格材质" class="headerlink" title="物理网格材质"></a>物理网格材质</h3><p><a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/materials/MeshPhysicalMaterial">MeshPhysicalMaterial</a><br>MeshStandardMaterial的扩展，提供了更高级的基于物理的渲染属性：<br>Clearcoat: 有些类似于车漆，碳纤，被水打湿的表面的材质需要在面上再增加一个透明的，具有一定反光特性的面。而且这个面说不定有一定的起伏与粗糙度。Clearcoat可以在不需要重新创建一个透明的面的情况下做到类似的效果。<br>基于物理的透明度:.opacity属性有一些限制:在透明度比较高的时候，反射也随之减少。使用基于物理的透光性.transmission属性可以让一些很薄的透明表面，例如玻璃，变得更真实一些。<br>高级光线反射: 为非金属材质提供了更多更灵活的光线反射。<br>Sheen: Can be used for representing cloth and fabric materials.<br>物理网格材质使用了更复杂的着色器功能，所以在每个像素的渲染都要比three.js中的其他材质更费性能，大部分的特性是默认关闭的，需要手动开启，每开启一项功能在开启的时候才会更耗性能。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshPhysicalMaterial</span>()<br></code></pre></td></tr></table></figure>
<h3 id="卡通着色"><a href="#卡通着色" class="headerlink" title="卡通着色"></a>卡通着色</h3><p><a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/materials/MeshToonMaterial">MeshToonMaterial</a><br>一种实现卡通着色的材质。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshToonMaterial</span>()<br></code></pre></td></tr></table></figure>

<h2 id="加载glb模型"><a href="#加载glb模型" class="headerlink" title="加载glb模型"></a>加载glb模型</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">GLTFLoader</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/loaders/GLTFLoader.js&#x27;</span>;<br><span class="hljs-comment">// 加载.glb模型</span><br><span class="hljs-keyword">const</span> loader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GLTFLoader</span>();<br><br><span class="hljs-comment">// 使用 import.meta.url 来构建正确的文件路径  </span><br><span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/1.glb&#x27;</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>;  <br><span class="hljs-comment">// 注意：如果文件是 .glb（二进制格式），上面的路径应该是正确的，但请确保文件扩展名正确  </span><br><span class="hljs-comment">// 如果文件是 .gltf（文本格式），则无需更改  </span><br>loader.<span class="hljs-title function_">load</span>(  <br>    url,  <br>    <span class="hljs-function">(<span class="hljs-params">gltf</span>) =&gt;</span> &#123;  <br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(gltf);  <br>        gltf.<span class="hljs-property">scene</span>.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>);  <br>        scene.<span class="hljs-title function_">add</span>(gltf.<span class="hljs-property">scene</span>);  <br>    &#125;,  <br>    <span class="hljs-literal">undefined</span>,  <br>    <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;  <br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);  <br>    &#125;  <br>);<br></code></pre></td></tr></table></figure>

<h2 id="使用加载器管理加载状态-loadingManager"><a href="#使用加载器管理加载状态-loadingManager" class="headerlink" title="使用加载器管理加载状态 loadingManager"></a>使用加载器管理加载状态 loadingManager</h2><p>LoadingManager只能监控加载的资源 不能监控自定义的资源<br>例如glb模型可以监控加载完成不能在回调中添加模型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> loadingManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">LoadingManager</span>()<br>loadingManager.<span class="hljs-property">onLoad</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;加载完成&#x27;</span>)<br>&#125;<br>loadingManager.<span class="hljs-property">onProgress</span> = <span class="hljs-function">(<span class="hljs-params">url,loaded,total</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;url&#125;</span> 加载中 <span class="hljs-subst">$&#123;<span class="hljs-built_in">Math</span>.floor(loaded / total * <span class="hljs-number">100</span>)&#125;</span>%`</span>)<br>&#125;<br>loadingManager.<span class="hljs-property">onError</span> = <span class="hljs-function">(<span class="hljs-params">url</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;url&#125;</span> 加载失败`</span>)<br>&#125;<br><span class="hljs-keyword">const</span> url1 = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/1.jpg&#x27;</span>,<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>)<br><span class="hljs-keyword">const</span> texture = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">TextureLoader</span>(loadingManager).<span class="hljs-title function_">load</span>(url1)<br></code></pre></td></tr></table></figure>

<h3 id="使用google压缩模型文件-DRACOLoader"><a href="#使用google压缩模型文件-DRACOLoader" class="headerlink" title="使用google压缩模型文件(DRACOLoader)"></a>使用google压缩模型文件(DRACOLoader)</h3><p>(draco github)[<a target="_blank" rel="noopener" href="https://github.com/google/draco]">https://github.com/google/draco]</a><br>(draco 官网)[<a target="_blank" rel="noopener" href="https://google.github.io/draco/]">https://google.github.io/draco/]</a><br>需要将<code>node_modules\three\examples\jsm\libs\draco</code>文件夹放到public目录下</p>
<p>** 如果报错Uncaught SyntaxError: Unexpected token ‘&lt;’ (at 7fde97c8-de31-412f-9f30-4f2af27bf265:2:1)**<br>则说明解码器文件路径不对 需要设置正确的路径</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">GLTFLoader</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/loaders/GLTFLoader&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">DRACOLoader</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/loaders/DRACOLoader&#x27;</span>;<br><span class="hljs-comment">// 引用解码器库</span><br><span class="hljs-keyword">const</span> dracoLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DRACOLoader</span>()<br><span class="hljs-comment">// 设置解码器路径</span><br>dracoLoader.<span class="hljs-title function_">setDecoderPath</span>(<span class="hljs-string">&#x27;public/draco/gltf/&#x27;</span>);<br><span class="hljs-comment">// 设置解码器类型</span><br>dracoLoader.<span class="hljs-title function_">setDecoderConfig</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;js&#x27;</span> &#125;);<br><span class="hljs-comment">// 创建一个加载器</span><br><span class="hljs-keyword">const</span> loader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GLTFLoader</span>()<br><span class="hljs-comment">// 设置加载器</span><br>loader.<span class="hljs-title function_">setDRACOLoader</span>(dracoLoader)<br><br><span class="hljs-comment">// 引用加密模型</span><br>loader.<span class="hljs-title function_">load</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/glTF-Draco/Duck.gltf&#x27;</span>,<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>,<span class="hljs-function">(<span class="hljs-params">model</span>)=&gt;</span>&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(model)<br>    model.<span class="hljs-property">scene</span>.<span class="hljs-property">scale</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>    scene.<span class="hljs-title function_">add</span>(model.<span class="hljs-property">scene</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>
<h2 id="使用模型的动画"><a href="#使用模型的动画" class="headerlink" title="使用模型的动画"></a>使用模型的动画</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 创建一个变量保存动画播放器</span><br><span class="hljs-keyword">let</span> mixer = <span class="hljs-literal">null</span>;<br><br><span class="hljs-comment">// 加载模型</span><br>loader.<span class="hljs-title function_">load</span>(<span class="hljs-string">&#x27;/static/fox/Fox.gltf&#x27;</span>,<span class="hljs-function">(<span class="hljs-params">model</span>)=&gt;</span>&#123;<br>    <span class="hljs-comment">// 绑定一个动画播放器</span><br>    mixer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">AnimationMixer</span>(model.<span class="hljs-property">scene</span>)<br>    <span class="hljs-comment">// 提取出动画</span><br>    <span class="hljs-keyword">const</span> action = mixer.<span class="hljs-title function_">clipAction</span>(model.<span class="hljs-property">animations</span>[<span class="hljs-number">0</span>])<br>    <span class="hljs-comment">// 播放动画</span><br>    action.<span class="hljs-title function_">play</span>()<br><br>    scene.<span class="hljs-title function_">add</span>(model.<span class="hljs-property">scene</span>)<br>&#125;)<br><br><span class="hljs-comment">// 在渲染循环中更新动画</span><br><span class="hljs-keyword">const</span> clock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Clock</span>()<br><span class="hljs-keyword">let</span> endTime = <span class="hljs-number">0</span><br><span class="hljs-keyword">var</span> stats = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stats</span>();<br>stats.<span class="hljs-title function_">showPanel</span>( <span class="hljs-number">0</span> ); <span class="hljs-comment">// 0: fps, 1: ms, 2: mb, 3+: custom</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">let</span> time = clock.<span class="hljs-title function_">getElapsedTime</span>()<br>    stats.<span class="hljs-title function_">begin</span>();<br>    <span class="hljs-comment">// 更新动画</span><br>    <span class="hljs-keyword">if</span>(mixer)&#123;<br>        mixer.<span class="hljs-title function_">update</span>(time - endTime)<br>    &#125;<br>    renderer.<span class="hljs-title function_">render</span>(scene, camera)<br>    endTime = time<br>    stats.<span class="hljs-title function_">end</span>();<br>    <span class="hljs-title function_">requestAnimationFrame</span>( animate );<br>&#125;<br><span class="hljs-title function_">requestAnimationFrame</span>( animate );<br></code></pre></td></tr></table></figure>





<h2 id="设置阴影投影"><a href="#设置阴影投影" class="headerlink" title="设置阴影投影"></a>设置阴影投影</h2><ol>
<li>设置渲染器</li>
<li>设置灯光</li>
<li>设置可投影的模型</li>
<li>设置接收阴影的模型</li>
</ol>
<p>渲染器开启投影</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">renderer.<span class="hljs-property">shadowMap</span>.<span class="hljs-property">enabled</span> = <span class="hljs-literal">true</span>;<br><span class="hljs-comment">// 阴影类型</span><br>renderer.<span class="hljs-property">shadowMap</span>.<span class="hljs-property">type</span> = <span class="hljs-title class_">Three</span>.<span class="hljs-property">PCFSoftShadowMap</span>; <br></code></pre></td></tr></table></figure>
<p>光源开启投影</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> directionalLight = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">1</span>) <span class="hljs-comment">// 白光</span><br>directionalLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">10</span>,<span class="hljs-number">13</span>,<span class="hljs-number">20</span>)<br>directionalLight.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 开启阴影</span><br><span class="hljs-comment">// 设置参数</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">left</span> = -<span class="hljs-number">10</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">right</span> = <span class="hljs-number">10</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">top</span> = <span class="hljs-number">10</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">bottom</span> = -<span class="hljs-number">10</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">near</span> = <span class="hljs-number">0</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">far</span> = <span class="hljs-number">100</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">mapSize</span>.<span class="hljs-property">width</span> = <span class="hljs-number">2048</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">mapSize</span>.<span class="hljs-property">height</span> = <span class="hljs-number">2048</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">radius</span> = <span class="hljs-number">20</span><br><span class="hljs-comment">// 通过设置bias和normalBias来调整阴影的偏移 消除模型上的摩尔纹</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">bias</span> = -<span class="hljs-number">0.001</span> <span class="hljs-comment">// 阴影偏移</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">normalBias</span> = <span class="hljs-number">0</span> <span class="hljs-comment">// 法线偏移</span><br><br></code></pre></td></tr></table></figure>
<p>需要投影的网格开启投影</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> boxGeometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshStandardMaterial</span>(&#123;<span class="hljs-attr">color</span>:<span class="hljs-number">0xff0000</span>&#125;)<br><span class="hljs-keyword">const</span> mesh = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Mesh</span>(boxGeometry, material)<br>mesh.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 开启阴影</span><br></code></pre></td></tr></table></figure>
<p>接收投影的网格开启接收</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> plane2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>)<br><span class="hljs-keyword">const</span> mesh2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Mesh</span>(plane2, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshStandardMaterial</span>(&#123;<span class="hljs-attr">color</span>:<span class="hljs-number">0xffffff</span>&#125;))<br>mesh2.<span class="hljs-property">receiveShadow</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 接收阴影</span><br></code></pre></td></tr></table></figure>
<h3 id="静止的物体可以使用贴图来模拟投影"><a href="#静止的物体可以使用贴图来模拟投影" class="headerlink" title="静止的物体可以使用贴图来模拟投影"></a>静止的物体可以使用贴图来模拟投影</h3><p>效果会更真实一些</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> loader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">TextureLoader</span>()<br><span class="hljs-keyword">let</span> texture = loader.<span class="hljs-title function_">load</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/1.jpg&#x27;</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>)<br><span class="hljs-keyword">const</span> plane2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>)<br><span class="hljs-keyword">const</span> mesh = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Mesh</span>(plane2, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshStandardMaterial</span>(&#123;<span class="hljs-attr">map</span>:texture&#125;))<br>    mesh.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = - <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span><br>    mesh.<span class="hljs-property">receiveShadow</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 接收阴影</span><br>scene.<span class="hljs-title function_">add</span>(mesh)<br></code></pre></td></tr></table></figure>
<h3 id="使用alphaMap来模拟投影"><a href="#使用alphaMap来模拟投影" class="headerlink" title="使用alphaMap来模拟投影"></a>使用alphaMap来模拟投影</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> mesh = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Mesh</span>(plane2, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshStandardMaterial</span>(&#123;<br>    <span class="hljs-comment">// map:texture,</span><br>    <span class="hljs-attr">color</span>:<span class="hljs-number">0xffff00</span>,<br>    <span class="hljs-attr">transparent</span>:<span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">opacity</span>:<span class="hljs-number">0.5</span>,<br>    <span class="hljs-attr">alphaMap</span>:texture,<br>&#125;))<br>mesh.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = - <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span><br>mesh.<span class="hljs-property">receiveShadow</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 接收阴影</span><br>scene.<span class="hljs-title function_">add</span>(mesh)<br></code></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> clock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Clock</span>()<br><span class="hljs-keyword">var</span> stats = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stats</span>();<br>stats.<span class="hljs-title function_">showPanel</span>( <span class="hljs-number">0</span> ); <span class="hljs-comment">// 0: fps, 1: ms, 2: mb, 3+: custom</span><br><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>( stats.<span class="hljs-property">dom</span> );<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">let</span> time = clock.<span class="hljs-title function_">getElapsedTime</span>()<br>    stats.<span class="hljs-title function_">begin</span>();<br><br>    box.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(<span class="hljs-number">1.5</span>*<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(time))+<span class="hljs-number">0.5</span><br>    mesh.<span class="hljs-property">scale</span>.<span class="hljs-title function_">set</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(-<span class="hljs-number">0.5</span>*<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(time)),<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(-<span class="hljs-number">0.5</span>*<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(time)),<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(-<span class="hljs-number">0.5</span>*<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(time)))<br>    mesh.<span class="hljs-property">material</span>.<span class="hljs-property">opacity</span> = <span class="hljs-number">1</span>-<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(time))+<span class="hljs-number">0.3</span><br>    <br>    controls.<span class="hljs-title function_">update</span>()<br>    renderer.<span class="hljs-title function_">render</span>(scene, camera)<br><br>    stats.<span class="hljs-title function_">end</span>();<br>    <span class="hljs-title function_">requestAnimationFrame</span>( animate );<br>&#125;<br><span class="hljs-title function_">requestAnimationFrame</span>( animate );<br><br></code></pre></td></tr></table></figure>




<h2 id="光线投射"><a href="#光线投射" class="headerlink" title="光线投射"></a>光线投射</h2><p><a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html?q=raycaster#api/zh/core/Raycaster">Raycaster</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> raycaster = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Raycaster</span>()<br><span class="hljs-keyword">const</span> rayOrigin = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Vector3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 创建一个相交物体的组</span><br><span class="hljs-keyword">const</span> sphereGroup = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Group</span>()<br><span class="hljs-comment">// 添加球体</span><br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++)&#123;<br>    <span class="hljs-keyword">const</span> sphere = <span class="hljs-title function_">createSphere</span>(<span class="hljs-number">1</span>, <span class="hljs-number">20</span>, <span class="hljs-number">20</span>,i * <span class="hljs-number">3</span>, <span class="hljs-number">0</span> , <span class="hljs-number">0</span>, <span class="hljs-number">0xff00ff</span>)<br>    sphereGroup.<span class="hljs-title function_">add</span>(sphere)<br>&#125;<br>scene.<span class="hljs-title function_">add</span>(sphereGroup)<br><span class="hljs-comment">// 创建一个光线投影</span><br><span class="hljs-keyword">const</span> raycaster = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Raycaster</span>()<br><span class="hljs-comment">// 创建一个位置作为初始位置</span><br><span class="hljs-keyword">const</span> rayOrigin = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Vector3</span>(-<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br><span class="hljs-comment">// 创建一个方向向量</span><br><span class="hljs-keyword">const</span> rayDirection = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Vector3</span>(<span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0</span>)<br>rayDirection.<span class="hljs-title function_">normalize</span>() <span class="hljs-comment">// 只管方向不管大小 .multiplyScalar(50); 向量长度</span><br>raycaster.<span class="hljs-title function_">set</span>(rayOrigin,rayDirection)<br><span class="hljs-comment">// 获取相交的物体</span><br><span class="hljs-keyword">const</span> intersects = raycaster.<span class="hljs-title function_">intersectObjects</span>(sphereGroup.<span class="hljs-property">children</span>, <span class="hljs-literal">true</span>)<br><span class="hljs-comment">// 画一条射线辅助线</span><br><span class="hljs-keyword">const</span> lineMaterial = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">LineBasicMaterial</span>( &#123;<br>    <span class="hljs-attr">color</span>: <span class="hljs-number">0xffffff</span>,<br>    <span class="hljs-attr">linewidth</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-attr">linecap</span>: <span class="hljs-string">&#x27;round&#x27;</span>,<br>    <span class="hljs-attr">linejoin</span>:  <span class="hljs-string">&#x27;round&#x27;</span><br>&#125;);<br><span class="hljs-keyword">const</span> points = [];<br>points.<span class="hljs-title function_">push</span>( rayOrigin );<br>points.<span class="hljs-title function_">push</span>( rayDirection );<br><span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">BufferGeometry</span>().<span class="hljs-title function_">setFromPoints</span>( points );<br><span class="hljs-keyword">const</span> line = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Line</span>( geometry, lineMaterial );<br>scene.<span class="hljs-title function_">add</span>( line );<br></code></pre></td></tr></table></figure>
<h3 id="计时器中更新射线"><a href="#计时器中更新射线" class="headerlink" title="计时器中更新射线"></a>计时器中更新射线</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> clock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Clock</span>()<br><span class="hljs-keyword">var</span> stats = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stats</span>();<br>stats.<span class="hljs-title function_">showPanel</span>( <span class="hljs-number">0</span> ); <span class="hljs-comment">// 0: fps, 1: ms, 2: mb, 3+: custom</span><br><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>( stats.<span class="hljs-property">dom</span> );<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">let</span> time = clock.<span class="hljs-title function_">getElapsedTime</span>()<br>    stats.<span class="hljs-title function_">begin</span>();<br><br>    <span class="hljs-comment">// 恢复默认颜色</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> geometry <span class="hljs-keyword">of</span> sphereGroup.<span class="hljs-property">children</span>)&#123;<br>      geometry.<span class="hljs-property">material</span>.<span class="hljs-property">color</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Color</span>(<span class="hljs-number">0xff00ff</span>)<br>    &#125;<br>    <span class="hljs-comment">// 返回相交的物体</span><br>    <span class="hljs-keyword">const</span> intersects = raycaster.<span class="hljs-title function_">intersectObjects</span>(sphereGroup.<span class="hljs-property">children</span>, <span class="hljs-literal">true</span>)<br>    <span class="hljs-comment">// 设置接触颜色</span><br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">const</span> interfsect <span class="hljs-keyword">of</span> intersects)&#123;<br>      interfsect.<span class="hljs-property">object</span>.<span class="hljs-property">material</span>.<span class="hljs-property">color</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Color</span>(<span class="hljs-number">0x0000ff</span>)<br>    &#125;<br><br>    controls.<span class="hljs-title function_">update</span>()<br>    renderer.<span class="hljs-title function_">render</span>(scene, camera)<br>    stats.<span class="hljs-title function_">end</span>();<br>    <span class="hljs-title function_">requestAnimationFrame</span>( animate );<br>  &#125;<br>  <span class="hljs-title function_">requestAnimationFrame</span>( animate );<br></code></pre></td></tr></table></figure>

<h3 id="点击屏幕根据相机和鼠标位置获取相交的物体"><a href="#点击屏幕根据相机和鼠标位置获取相交的物体" class="headerlink" title="点击屏幕根据相机和鼠标位置获取相交的物体"></a>点击屏幕根据相机和鼠标位置获取相交的物体</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 创建一个光线投影</span><br><span class="hljs-keyword">const</span> raycaster = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Raycaster</span>()<br><span class="hljs-comment">// 创建一个鼠标二维坐标系</span><br><span class="hljs-keyword">let</span> mouse = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Vector2</span>();<br>canvas.<span class="hljs-property">value</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) &#123;<br>    <span class="hljs-comment">// 将鼠标位置转换为归一化设备坐标</span><br>    mouse.<span class="hljs-property">x</span> = (event.<span class="hljs-property">offsetX</span> / canvas.<span class="hljs-property">value</span>.<span class="hljs-property">width</span>) * <span class="hljs-number">2</span> - <span class="hljs-number">1</span>;<br>    mouse.<span class="hljs-property">y</span> = -(event.<span class="hljs-property">offsetY</span> / canvas.<span class="hljs-property">value</span>.<span class="hljs-property">height</span>) * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>;<br>    <span class="hljs-comment">// 使用鼠标位置和相机设置射线投射器</span><br>    raycaster.<span class="hljs-title function_">setFromCamera</span>(mouse, camera);<br>    <span class="hljs-comment">// 返回相交的物体</span><br>    <span class="hljs-keyword">const</span> intersect = raycaster.<span class="hljs-title function_">intersectObjects</span>(sphereGroup.<span class="hljs-property">children</span>)<br>    <span class="hljs-comment">// 恢复默认颜色</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> geometry <span class="hljs-keyword">of</span> sphereGroup.<span class="hljs-property">children</span>)&#123;<br>      geometry.<span class="hljs-property">material</span>.<span class="hljs-property">color</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Color</span>(<span class="hljs-number">0xff00ff</span>)<br>    &#125;<br>    <span class="hljs-comment">// 设置接触颜色</span><br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">const</span> interfsect <span class="hljs-keyword">of</span> intersect)&#123;<br>      interfsect.<span class="hljs-property">object</span>.<span class="hljs-property">material</span>.<span class="hljs-property">color</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Color</span>(<span class="hljs-number">0x0000ff</span>)<br>    &#125;<br><br>    <span class="hljs-comment">// 创建一个投射辅助线</span><br>    <span class="hljs-comment">// 射线的起点（相机位置）</span><br>    <span class="hljs-keyword">const</span> start = camera.<span class="hljs-property">position</span>.<span class="hljs-title function_">clone</span>();<br>    <span class="hljs-comment">// 射线的终点（这里我们假设射线长度为50个单位）</span><br>    <span class="hljs-keyword">const</span> end = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Vector3</span>().<span class="hljs-title function_">addVectors</span>(camera.<span class="hljs-property">position</span>, raycaster.<span class="hljs-property">ray</span>.<span class="hljs-property">direction</span>.<span class="hljs-title function_">multiplyScalar</span>(<span class="hljs-number">50</span>));<br>    <span class="hljs-comment">// 创建线段的几何体</span><br>    <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">BufferGeometry</span>().<span class="hljs-title function_">setFromPoints</span>([start, end]);<br>    <span class="hljs-comment">// 创建线段的材料</span><br>    <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">LineBasicMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-number">0x00ff00</span> &#125;); <span class="hljs-comment">// 假设我们使用绿色来表示射线</span><br>    <span class="hljs-comment">// 创建线段并添加到场景中</span><br>    <span class="hljs-keyword">const</span> rayLine = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Line</span>(geometry, material);<br>    scene.<span class="hljs-title function_">add</span>(rayLine);<br>&#125;);<br></code></pre></td></tr></table></figure>



<h2 id="添加文字模型"><a href="#添加文字模型" class="headerlink" title="添加文字模型"></a>添加文字模型</h2><p><a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#examples/zh/geometries/TextGeometry">TextGeometry</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 引用字体</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">FontLoader</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/loaders/FontLoader.js&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">TextGeometry</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/geometries/TextGeometry.js&#x27;</span><br><span class="hljs-comment">// 字体路径</span><br><span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/helvetiker_regular.typeface.json&#x27;</span>,<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>)<br><span class="hljs-comment">// 加载器加载字体</span><br><span class="hljs-keyword">const</span> loaderText = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FontLoader</span>()<br>loaderText.<span class="hljs-title function_">load</span>(url.<span class="hljs-property">href</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">font</span>) &#123;<br>    <span class="hljs-comment">// 创建文本几何体</span><br>    <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextGeometry</span>(<span class="hljs-string">&#x27;Hello three.js!&#x27;</span>, &#123;<br>        <span class="hljs-attr">font</span>: font, <span class="hljs-comment">// 字体</span><br>        <span class="hljs-attr">size</span>: <span class="hljs-number">1</span>,    <span class="hljs-comment">// 字体大小 默认值为100</span><br>        <span class="hljs-attr">depth</span>:<span class="hljs-number">.1</span>,   <span class="hljs-comment">// 字体厚度。默认值为50。</span><br>        <br>        <span class="hljs-attr">curveSegments</span>: <span class="hljs-number">12</span>,    <span class="hljs-comment">// （表示文本的）曲线上点的数量。默认值为12</span><br>        <span class="hljs-attr">bevelEnabled</span>: <span class="hljs-literal">true</span>,   <span class="hljs-comment">// 是否开启斜角，默认为false</span><br>        <span class="hljs-attr">bevelThickness</span>: <span class="hljs-number">0.03</span>, <span class="hljs-comment">// 文本上斜角的深度，默认值为20</span><br>        <span class="hljs-attr">bevelSize</span>: <span class="hljs-number">0.03</span>,      <span class="hljs-comment">// 斜角与原始文本轮廓之间的延伸距离。默认值为8</span><br>        <span class="hljs-attr">bevelSegments</span>: <span class="hljs-number">1</span>,     <span class="hljs-comment">//  斜角的分段数。默认值为3</span><br>    &#125;)<br>    <span class="hljs-comment">// 获取几何体边界框</span><br>    geometry.<span class="hljs-title function_">computeBoundingBox</span>()<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(geometry.<span class="hljs-property">boundingBox</span>)<br>    <span class="hljs-comment">// 设置几何体的中心</span><br>    geometry.<span class="hljs-title function_">center</span>()<br>    <span class="hljs-keyword">const</span> mesh = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Mesh</span>(geometry, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshNormalMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-number">0xff0000</span> &#125;))<br>    mesh.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 阴影</span><br>    scene.<span class="hljs-title function_">add</span>(mesh)<br>&#125;)<br></code></pre></td></tr></table></figure>
<h2 id="根据鼠标移动和滚轮来移动物体"><a href="#根据鼠标移动和滚轮来移动物体" class="headerlink" title="根据鼠标移动和滚轮来移动物体"></a>根据鼠标移动和滚轮来移动物体</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 创建相机组用来使用滚轮控制相机位置</span><br><span class="hljs-keyword">const</span> cameraGroup = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Group</span>()<br><span class="hljs-comment">// 创建一个透视相机</span><br><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">35</span>, pos.<span class="hljs-property">width</span> / pos.<span class="hljs-property">height</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>)<br>cameraGroup.<span class="hljs-title function_">add</span>( camera );<br>scene.<span class="hljs-title function_">add</span>(cameraGroup)<br><span class="hljs-comment">// 设置相机位置</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">10</span><br><span class="hljs-comment">// 不要设置lookAt方法，因为它会导致相机的方向发生变化</span><br><br><span class="hljs-keyword">const</span> mouse = &#123;<br>    <span class="hljs-attr">x</span>:<span class="hljs-number">0</span>,<br>    <span class="hljs-attr">y</span>:<span class="hljs-number">0</span><br>&#125;<br><span class="hljs-comment">// 鼠标移动事件监听</span><br><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;mousemove&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>)&#123;<br>    mouse.<span class="hljs-property">x</span> = (event.<span class="hljs-property">clientX</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>) - <span class="hljs-number">0.5</span><br>    mouse.<span class="hljs-property">y</span> = -(event.<span class="hljs-property">clientY</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>) - <span class="hljs-number">0.5</span><br>&#125;)<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">let</span> time = clock.<span class="hljs-title function_">getElapsedTime</span>()<br>    stats.<span class="hljs-title function_">begin</span>();<br>    <span class="hljs-comment">// 滚轮控制相机组移动</span><br>    cameraGroup.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = - (<span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span> -<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>/<span class="hljs-number">2</span>)/ <span class="hljs-number">300</span><br>    <span class="hljs-comment">// 鼠标滑动控制相机移动</span><br>    camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = mouse.<span class="hljs-property">x</span> <br>    camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = mouse.<span class="hljs-property">y</span> <br><br>    renderer.<span class="hljs-title function_">render</span>(scene, camera)<br><br>    stats.<span class="hljs-title function_">end</span>();<br>    <span class="hljs-title function_">requestAnimationFrame</span>( animate );<br>  &#125;<br>  <span class="hljs-title function_">requestAnimationFrame</span>( animate );<br></code></pre></td></tr></table></figure>
<h3 id="添加缓动效果"><a href="#添加缓动效果" class="headerlink" title="添加缓动效果"></a>添加缓动效果</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><br><span class="hljs-keyword">var</span> timeEnd = <span class="hljs-number">0</span>;<br>stats.<span class="hljs-title function_">showPanel</span>( <span class="hljs-number">0</span> ); <span class="hljs-comment">// 0: fps, 1: ms, 2: mb, 3+: custom</span><br><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>( stats.<span class="hljs-property">dom</span> );<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">let</span> time = clock.<span class="hljs-title function_">getElapsedTime</span>()<br>    stats.<span class="hljs-title function_">begin</span>();<br>    cameraGroup.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = - (<span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span> - <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>  /<span class="hljs-number">2</span>) / <span class="hljs-number">300</span><br>    <span class="hljs-comment">// 目标位置 - 当前位置    *   时间差    *   速度</span><br>    camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> += (mouse.<span class="hljs-property">x</span> - camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>) * (time-timeEnd) * <span class="hljs-number">5</span><br>    camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> += (mouse.<span class="hljs-property">y</span> - camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>) * (time-timeEnd) * <span class="hljs-number">5</span><br><br>    renderer.<span class="hljs-title function_">render</span>(scene, camera)<br>    stats.<span class="hljs-title function_">end</span>();<br>    timeEnd = time;<br>    <span class="hljs-title function_">requestAnimationFrame</span>( animate );<br>&#125;<br><span class="hljs-title function_">requestAnimationFrame</span>( animate );<br></code></pre></td></tr></table></figure>

<h2 id="物理引擎-重力"><a href="#物理引擎-重力" class="headerlink" title="物理引擎(重力)"></a>物理引擎(重力)</h2><h3 id="3D库"><a href="#3D库" class="headerlink" title="3D库"></a>3D库</h3><ul>
<li>Ammo.js</li>
<li>Cannon.js</li>
<li>Oimo.js</li>
</ul>
<h3 id="2D库"><a href="#2D库" class="headerlink" title="2D库"></a>2D库</h3><ul>
<li>Matter.js</li>
<li>P2.js</li>
<li>Planck.js</li>
<li>Box2D.js</li>
</ul>
<h3 id="cannon-js"><a href="#cannon-js" class="headerlink" title="cannon.js"></a>cannon.js</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install cannon<br></code></pre></td></tr></table></figure>
<h4 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-variable constant_">CANNON</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;cannon&#x27;</span><br></code></pre></td></tr></table></figure>
<h3 id="创建刚体世界"><a href="#创建刚体世界" class="headerlink" title="创建刚体世界"></a>创建刚体世界</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 创建一个刚体世界</span><br><span class="hljs-keyword">const</span> world = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">World</span>()<br><span class="hljs-comment">// 设置重力</span><br>world.<span class="hljs-property">gravity</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, -<span class="hljs-number">9.82</span>, <span class="hljs-number">0</span>)<br>world.<span class="hljs-property">broadphase</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">SAPBroadphase</span>(world) <span class="hljs-comment">// 空间分割算法 速度快 稳定性好 速度过快可能会检测不到碰撞</span><br>world.<span class="hljs-property">solver</span>.<span class="hljs-property">iterations</span> = <span class="hljs-number">10</span> <span class="hljs-comment">// 迭代次数 每一帧进行碰撞检测的次数 越多越精确 但是会增加计算量</span><br>world.<span class="hljs-property">allowSleep</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 允许睡眠 减少计算量 停止的物体会进入睡眠状态</span><br><br><span class="hljs-comment">// 创建一个球星刚体</span><br><span class="hljs-keyword">const</span> sphereBody = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">Body</span>(&#123; <span class="hljs-attr">mass</span>: <span class="hljs-number">1</span> &#125;) <span class="hljs-comment">// 质量为1的刚体</span><br><span class="hljs-keyword">const</span> sphereShape = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">Sphere</span>(<span class="hljs-number">0.5</span>) <span class="hljs-comment">// 半径为0.5的球体</span><br>sphereBody.<span class="hljs-title function_">addShape</span>(sphereShape) <span class="hljs-comment">// 给刚体添加形状</span><br>sphereBody.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>) <span class="hljs-comment">// 设置刚体位置</span><br>world.<span class="hljs-title function_">addBody</span>(sphereBody) <span class="hljs-comment">// 加入世界</span><br><span class="hljs-comment">// 创建一个地面刚体</span><br><span class="hljs-keyword">const</span> groundBody = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">Body</span>(&#123; <span class="hljs-attr">mass</span>: <span class="hljs-number">0</span> &#125;) <span class="hljs-comment">// 质量为0的刚体为不可移动的物体</span><br><span class="hljs-keyword">const</span> groundShape = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">Plane</span>() <span class="hljs-comment">// 平面形状</span><br>groundBody.<span class="hljs-title function_">addShape</span>(groundShape) <span class="hljs-comment">// 给刚体添加形状</span><br>groundBody.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) <span class="hljs-comment">// 设置刚体位置</span><br><span class="hljs-comment">// cannon.js旋转只支持四元数，这里设置地面刚体的四元数为绕x轴旋转-90度</span><br>groundBody.<span class="hljs-property">quaternion</span>.<span class="hljs-title function_">setFromAxisAngle</span>(<span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">Vec3</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), -<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>) <span class="hljs-comment">// 默认方向和threejs的平面是一样的 所以需要旋转一下</span><br>world.<span class="hljs-title function_">addBody</span>(groundBody) <span class="hljs-comment">// 加入世界</span><br><br><span class="hljs-comment">// 更新到定时器中</span><br><span class="hljs-keyword">const</span> clock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Clock</span>()<br><span class="hljs-keyword">var</span> stats = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stats</span>();<br>stats.<span class="hljs-title function_">showPanel</span>( <span class="hljs-number">0</span> ); <span class="hljs-comment">// 0: fps, 1: ms, 2: mb, 3+: custom</span><br><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>( stats.<span class="hljs-property">dom</span> );<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">let</span> time = clock.<span class="hljs-title function_">getElapsedTime</span>()<br>    stats.<span class="hljs-title function_">begin</span>();<br>    <span class="hljs-comment">// 物理引擎更新</span><br>    world.<span class="hljs-title function_">step</span>(<span class="hljs-number">1</span>/<span class="hljs-number">60</span>,time - endTime,<span class="hljs-number">3</span>) <span class="hljs-comment">// 步长 两次调用的时间间隔(可选) 迭代次数(可选最大10)</span><br>    <span class="hljs-comment">// 刚体本身只负责物理属性 不会显示在场景中 所以需要手动绑定threejs的物体</span><br>    sphereMesh.<span class="hljs-property">position</span>.<span class="hljs-title function_">copy</span>(sphereBody.<span class="hljs-property">position</span>) <span class="hljs-comment">// 更新球体位置</span><br>    sphereMesh.<span class="hljs-property">quaternion</span>.<span class="hljs-title function_">copy</span>(sphereBody.<span class="hljs-property">quaternion</span>) <span class="hljs-comment">// 更新球体姿态</span><br><br>    renderer.<span class="hljs-title function_">render</span>(scene, camera)<br>    stats.<span class="hljs-title function_">end</span>();<br>    <span class="hljs-title function_">requestAnimationFrame</span>( animate );<br>&#125;<br><span class="hljs-title function_">requestAnimationFrame</span>( animate );<br><br></code></pre></td></tr></table></figure>

<h3 id="创建两种材质-并设置两种材质的物理属性"><a href="#创建两种材质-并设置两种材质的物理属性" class="headerlink" title="创建两种材质 并设置两种材质的物理属性"></a>创建两种材质 并设置两种材质的物理属性</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 创建两种材质</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">AMaterial</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">Material</span>(<span class="hljs-string">&#x27;AMaterial&#x27;</span>)<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">BMaterial</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">Material</span>(<span class="hljs-string">&#x27;BMaterial&#x27;</span>)<br><span class="hljs-comment">// 两种材质碰撞后的物理属性</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">AContactMaterial</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">ContactMaterial</span>(<span class="hljs-title class_">AMaterial</span>, <span class="hljs-title class_">BMaterial</span>, &#123;<br>    <span class="hljs-attr">friction</span>: <span class="hljs-number">0.3</span>, <span class="hljs-comment">// 摩擦系数</span><br>    <span class="hljs-attr">restitution</span>: <span class="hljs-number">0.5</span>, <span class="hljs-comment">// 弹性系数</span><br>&#125;)<br><span class="hljs-comment">// 物理属性添加到世界</span><br>world.<span class="hljs-title function_">addContactMaterial</span>(<span class="hljs-title class_">AContactMaterial</span>)<br><br><span class="hljs-comment">// 把两种材质绑定到刚体上</span><br>sphereBody.<span class="hljs-property">material</span> = <span class="hljs-title class_">BMaterial</span><br>groundBody.<span class="hljs-property">material</span> = <span class="hljs-title class_">AMaterial</span><br><br></code></pre></td></tr></table></figure>
<h3 id="默认材质"><a href="#默认材质" class="headerlink" title="默认材质"></a>默认材质</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 创建默认材质</span><br><span class="hljs-keyword">const</span> defaultMaterial = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">Material</span>(<span class="hljs-string">&#x27;default&#x27;</span>)<br><span class="hljs-comment">// 默认材质碰撞后的物理属性</span><br><span class="hljs-keyword">const</span> defaultContactMaterial = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">ContactMaterial</span>(defaultMaterial, defaultMaterial, &#123;<br>    <span class="hljs-attr">friction</span>: <span class="hljs-number">0.3</span>, <span class="hljs-comment">// 摩擦系数</span><br>    <span class="hljs-attr">restitution</span>: <span class="hljs-number">0.5</span>, <span class="hljs-comment">// 弹性系数</span><br>&#125;)<br><span class="hljs-comment">// 物理属性添加到世界</span><br>world.<span class="hljs-title function_">addContactMaterial</span>(defaultContactMaterial)<br><span class="hljs-comment">// 设置所有刚体的材质为默认材质</span><br>world.<span class="hljs-property">defaultContactMaterial</span> = defaultContactMaterial<br><span class="hljs-comment">// 不需要在刚体上绑定材质 全都具备默认材质的物理属性</span><br></code></pre></td></tr></table></figure>

<h3 id="添加力"><a href="#添加力" class="headerlink" title="添加力"></a>添加力</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 给刚体施加力的四种方式</span><br><span class="hljs-comment">// 施加一个力</span><br>sphereBody.<span class="hljs-title function_">applyForce</span>(<span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">Vec3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0</span>), sphereBody.<span class="hljs-property">position</span>)<br><span class="hljs-comment">// 脉冲力 绕过添加力 而直接影响速度 参数与applyForce相同</span><br>sphereBody.<span class="hljs-title function_">applyImpulse</span>(<span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">Vec3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>), sphereBody.<span class="hljs-property">position</span>)<br><span class="hljs-comment">// 施加一个角力</span><br>sphereBody.<span class="hljs-title function_">applyLocalImpulse</span>(<span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">Vec3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>), sphereBody.<span class="hljs-property">position</span>)<br><span class="hljs-comment">// 施加一个旋转力</span><br>sphereBody.<span class="hljs-title function_">applyLocalTorque</span>(<span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">Vec3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>), sphereBody.<span class="hljs-property">position</span>)<br></code></pre></td></tr></table></figure>
<h4 id="例子-施加一个力"><a href="#例子-施加一个力" class="headerlink" title="例子:施加一个力"></a>例子:施加一个力</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 给一个刚体施加一个力 </span><br>sphereBody.<span class="hljs-title function_">applyLocalForce</span>(<span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">Vec3</span>(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), sphereBody.<span class="hljs-property">position</span>) <span class="hljs-comment">// 力的方向和力的大小 力的作用点</span><br></code></pre></td></tr></table></figure>
<h4 id="例子-施加一个持续的阻力-类似于风"><a href="#例子-施加一个持续的阻力-类似于风" class="headerlink" title="例子:施加一个持续的阻力 类似于风"></a>例子:施加一个持续的阻力 类似于风</h4><p>写在animate函数中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">sphereBody.<span class="hljs-title function_">applyForce</span>(<span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">Vec3</span>(-<span class="hljs-number">0.5</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), sphereBody.<span class="hljs-property">position</span>)<br></code></pre></td></tr></table></figure>

<h3 id="批量创建模型-刚体"><a href="#批量创建模型-刚体" class="headerlink" title="批量创建模型+刚体"></a>批量创建模型+刚体</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 创建调试按钮</span><br><span class="hljs-keyword">const</span> defaultObj = &#123;<br>    <span class="hljs-attr">createShpere</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;createShpere&#x27;</span>)<br>      <span class="hljs-title function_">createShpere</span>(<span class="hljs-number">0.5</span>,<span class="hljs-number">1</span>,&#123;<span class="hljs-attr">x</span>:<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()*<span class="hljs-number">2</span>,<span class="hljs-attr">y</span>:<span class="hljs-number">5</span>,<span class="hljs-attr">z</span>:<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()*<span class="hljs-number">2</span>&#125;,<span class="hljs-number">0x00fff0</span>)<br>    &#125;,<br>    <span class="hljs-attr">createBox</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;createBox&#x27;</span>)<br>      <span class="hljs-title function_">createBox</span>(&#123;<span class="hljs-attr">x</span>:<span class="hljs-number">0</span>,<span class="hljs-attr">y</span>:<span class="hljs-number">5</span>,<span class="hljs-attr">z</span>:<span class="hljs-number">0</span>&#125;)<br>    &#125;,<br>&#125;<br>gui.<span class="hljs-title function_">add</span>(defaultObj,<span class="hljs-string">&#x27;createShpere&#x27;</span>).<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;创建球体&#x27;</span>)<br>gui.<span class="hljs-title function_">add</span>(defaultObj,<span class="hljs-string">&#x27;createBox&#x27;</span>).<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;创建盒子&#x27;</span>)<br><br><br><br><span class="hljs-comment">// 创建物体的数组</span><br><span class="hljs-keyword">const</span> objArray = []<br><span class="hljs-comment">// 创建球体</span><br><span class="hljs-keyword">const</span> createShpere = <span class="hljs-keyword">function</span>(<span class="hljs-params">radius, mass, position, color</span>)&#123;<br>    <span class="hljs-keyword">const</span> sphereGeometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">SphereGeometry</span>(radius, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>)<br>    <span class="hljs-keyword">const</span> sphereMaterial = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshStandardMaterial</span>(&#123;<br>      <span class="hljs-attr">color</span>:color,<br>    &#125;)<br>    <span class="hljs-keyword">const</span> sphereMesh = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Mesh</span>(sphereGeometry, sphereMaterial)<br>    sphereMesh.<span class="hljs-property">position</span>.<span class="hljs-title function_">copy</span>(position)<br>    sphereMesh.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span>;<br>    scene.<span class="hljs-title function_">add</span>(sphereMesh)<br><br>    <span class="hljs-keyword">const</span> sphereBody = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">Body</span>(&#123; <br>      <span class="hljs-attr">mass</span>: mass,<br>      <span class="hljs-comment">// material: defaultMaterial 此处不需要设置 因为已经设置全局</span><br>    &#125;)<br>    <span class="hljs-keyword">const</span> sphere = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">Sphere</span>(radius)<br>    sphereBody.<span class="hljs-title function_">addShape</span>(sphere)<br>    sphereBody.<span class="hljs-property">position</span>.<span class="hljs-title function_">copy</span>(position)<br>    world.<span class="hljs-title function_">addBody</span>(sphereBody)<br>    <br>    objArray.<span class="hljs-title function_">push</span>(&#123;<br>      <span class="hljs-attr">mesh</span>:sphereMesh,<br>      <span class="hljs-attr">body</span>:sphereBody<br>    &#125;)<br>&#125;<br><span class="hljs-title function_">createShpere</span>(<span class="hljs-number">0.5</span>,<span class="hljs-number">1</span>,&#123;<span class="hljs-attr">x</span>:<span class="hljs-number">0</span>,<span class="hljs-attr">y</span>:<span class="hljs-number">5</span>,<span class="hljs-attr">z</span>:<span class="hljs-number">0</span>&#125;,<span class="hljs-number">0x00fff0</span>)<br><br><span class="hljs-comment">// 创建盒子</span><br><span class="hljs-keyword">const</span> createBox = <span class="hljs-keyword">function</span>(<span class="hljs-params">position</span>)&#123;<br>    <span class="hljs-keyword">let</span> size = &#123;<br>      <span class="hljs-attr">x</span>:<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()*<span class="hljs-number">2</span>,<br>      <span class="hljs-attr">y</span>:<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()*<span class="hljs-number">2</span>,<br>      <span class="hljs-attr">z</span>:<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()*<span class="hljs-number">2</span><br>    &#125;<br>    <span class="hljs-keyword">const</span> sphereGeometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">BoxGeometry</span>(size.<span class="hljs-property">x</span>, size.<span class="hljs-property">y</span>, size.<span class="hljs-property">z</span>)<br>    <span class="hljs-keyword">const</span> sphereMaterial = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshStandardMaterial</span>(&#123;<br>      <span class="hljs-attr">color</span>:<span class="hljs-number">0x00fff0</span>,<br>    &#125;)<br>    <span class="hljs-keyword">const</span> boxMesh = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Mesh</span>(sphereGeometry, sphereMaterial)<br>    boxMesh.<span class="hljs-property">position</span>.<span class="hljs-title function_">copy</span>(position)<br>    boxMesh.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span>;<br>    scene.<span class="hljs-title function_">add</span>(boxMesh)<br><br>    <span class="hljs-keyword">const</span> sphereBody = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">Body</span>(&#123; <br>      <span class="hljs-attr">mass</span>: <span class="hljs-number">1</span>,<br>      <span class="hljs-comment">// material: defaultMaterial 此处不需要设置 因为已经设置全局</span><br>    &#125;)<br>    <span class="hljs-comment">// 此处需要注意 盒子的尺寸是 半径尺寸</span><br>    <span class="hljs-keyword">const</span> sphere = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">Box</span>(<span class="hljs-keyword">new</span> <span class="hljs-variable constant_">CANNON</span>.<span class="hljs-title class_">Vec3</span>(size.<span class="hljs-property">x</span>/<span class="hljs-number">2</span>,size.<span class="hljs-property">y</span>/<span class="hljs-number">2</span>,size.<span class="hljs-property">z</span>/<span class="hljs-number">2</span>))<br>    sphereBody.<span class="hljs-title function_">addShape</span>(sphere)<br>    sphereBody.<span class="hljs-property">position</span>.<span class="hljs-title function_">copy</span>(position)<br>    world.<span class="hljs-title function_">addBody</span>(sphereBody)<br>    <br>    objArray.<span class="hljs-title function_">push</span>(&#123;<br>      <span class="hljs-attr">mesh</span>:boxMesh,<br>      <span class="hljs-attr">body</span>:sphereBody<br>    &#125;)<br>&#125;<br><span class="hljs-title function_">createBox</span>(&#123;<span class="hljs-attr">x</span>:<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()*<span class="hljs-number">5</span>,<span class="hljs-attr">y</span>:<span class="hljs-number">8</span>,<span class="hljs-attr">z</span>:<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()*<span class="hljs-number">5</span>&#125;)<br><br><span class="hljs-comment">// ... animate函数</span><br><span class="hljs-comment">// 循环更新添加的模型状态</span><br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> item <span class="hljs-keyword">of</span> objArray)&#123;<br>    item.<span class="hljs-property">mesh</span>.<span class="hljs-property">position</span>.<span class="hljs-title function_">copy</span>(item.<span class="hljs-property">body</span>.<span class="hljs-property">position</span>)<br>    <span class="hljs-comment">// 长方体需要添加选装渲染</span><br>    item.<span class="hljs-property">mesh</span>.<span class="hljs-property">quaternion</span>.<span class="hljs-title function_">copy</span>(item.<span class="hljs-property">body</span>.<span class="hljs-property">quaternion</span>)<br>&#125;<br><span class="hljs-comment">//</span><br></code></pre></td></tr></table></figure>
<h3 id="监听刚体的碰撞事件"><a href="#监听刚体的碰撞事件" class="headerlink" title="监听刚体的碰撞事件"></a>监听刚体的碰撞事件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 引入一个音频</span><br><span class="hljs-keyword">const</span> audio = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Audio</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/h.mp3&#x27;</span>,<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>)<br><span class="hljs-comment">// 添加事件监听</span><br>sphereBody.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;collide&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;collide&#x27;</span>)<br>    <span class="hljs-comment">// 碰撞时播放音频</span><br>    <span class="hljs-keyword">const</span> impactVelocity = e.<span class="hljs-property">contact</span>.<span class="hljs-title function_">getImpactVelocityAlongNormal</span>() <span class="hljs-comment">// 获取碰撞后的速度</span><br>    <span class="hljs-keyword">if</span>(impactVelocity &gt; <span class="hljs-number">1.5</span>)&#123;<br>        audio.<span class="hljs-property">volume</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() <span class="hljs-comment">// 音量随机</span><br>        audio.<span class="hljs-property">currentTime</span> = <span class="hljs-number">0</span> <span class="hljs-comment">// 音频从头开始播放</span><br>        audio.<span class="hljs-title function_">play</span>() <span class="hljs-comment">// 播放音频</span><br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>

<h2 id="环境贴图"><a href="#环境贴图" class="headerlink" title="环境贴图"></a>环境贴图</h2><h3 id="加载图片环境贴图"><a href="#加载图片环境贴图" class="headerlink" title="加载图片环境贴图"></a>加载图片环境贴图</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> imgLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">CubeTextureLoader</span>();<br><span class="hljs-keyword">const</span> bg = imgLoader.<span class="hljs-title function_">load</span>([<br>    <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/grass/color.jpg&#x27;</span>,<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>, <br>    <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/grass/normal.jpg&#x27;</span>,<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>, <br>    <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/grass/roughness.jpg&#x27;</span>,<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>, <br>    <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/grass/ambientOcclusion.jpg&#x27;</span>,<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>, <br>    <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/bricks/color.jpg&#x27;</span>,<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>, <br>    <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/bricks/ambientOcclusion.jpg&#x27;</span>,<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>, <br>])<br>scene.<span class="hljs-property">environment</span> = bg <span class="hljs-comment">// 环境</span><br>scene.<span class="hljs-property">background</span> = bg <span class="hljs-comment">// 背景</span><br>scene.<span class="hljs-property">backgroundBlurriness</span> = <span class="hljs-number">0.1</span> <span class="hljs-comment">// 背景模糊 (0 - 1) 0是不模糊</span><br>scene.<span class="hljs-property">backgroundIntensity</span> = <span class="hljs-number">2</span> <span class="hljs-comment">// 环境光强度</span><br></code></pre></td></tr></table></figure>
<h2 id="设置所有模型材质的强度"><a href="#设置所有模型材质的强度" class="headerlink" title="设置所有模型材质的强度"></a>设置所有模型材质的强度</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">updateAllMaterials</span> = (<span class="hljs-params"></span>) =&gt;<br>&#123;<br>    <span class="hljs-comment">// 循环所有模型</span><br>    scene.<span class="hljs-title function_">traverse</span>(<span class="hljs-function">(<span class="hljs-params">child</span>) =&gt;</span><br>    &#123;<br>        <span class="hljs-comment">// 判断是否是mesh 且材质是否是MeshStandardMaterial</span><br>        <span class="hljs-keyword">if</span>(child.<span class="hljs-property">isMesh</span> &amp;&amp; child.<span class="hljs-property">material</span>.<span class="hljs-property">isMeshStandardMaterial</span>)<br>        &#123;<br>            <span class="hljs-comment">// 设置材质的环境光强度</span><br>            child.<span class="hljs-property">material</span>.<span class="hljs-property">envMapIntensity</span> = <span class="hljs-variable language_">global</span>.<span class="hljs-property">envMapIntensity</span><br>        &#125;<br>    &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="使用HDR文件添加贴图背景"><a href="#使用HDR文件添加贴图背景" class="headerlink" title="使用HDR文件添加贴图背景"></a>使用HDR文件添加贴图背景</h3><p>更佳精细的效果 但是hdr文件会更大</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">RGBELoader</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/loaders/RGBELoader.js&#x27;</span>;<br><span class="hljs-keyword">const</span> rgbeLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RGBELoader</span>();<br>rgbeLoader.<span class="hljs-title function_">load</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/empty_play_room_4k.hdr&#x27;</span>,<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">texture</span>) &#123;<br>    texture.<span class="hljs-property">mapping</span> = <span class="hljs-title class_">Three</span>.<span class="hljs-property">EquirectangularReflectionMapping</span>; <span class="hljs-comment">// 映射</span><br>    scene.<span class="hljs-property">background</span> = texture; <span class="hljs-comment">// 背景</span><br>    scene.<span class="hljs-property">environment</span> = texture; <span class="hljs-comment">// 环境</span><br>    scene.<span class="hljs-property">backgroundBlurriness</span> = <span class="hljs-number">0</span> <span class="hljs-comment">// 背景模糊</span><br>    scene.<span class="hljs-property">backgroundIntensity</span> = <span class="hljs-number">1</span> <span class="hljs-comment">// 环境光强度</span><br>&#125;);<br></code></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">EXRLoader</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/loaders/EXRLoader.js&#x27;</span>;<br><span class="hljs-keyword">const</span> exrLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EXRLoader</span>();<br>exrLoader.<span class="hljs-title function_">load</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/empty_play_room_4k.exr&#x27;</span>,<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">texture</span>) &#123;<br>    texture.<span class="hljs-property">mapping</span> = <span class="hljs-title class_">Three</span>.<span class="hljs-property">EquirectangularReflectionMapping</span>; <span class="hljs-comment">// 映射</span><br>    scene.<span class="hljs-property">background</span> = texture; <span class="hljs-comment">// 背景</span><br>    scene.<span class="hljs-property">environment</span> = texture; <span class="hljs-comment">// 环境</span><br>    scene.<span class="hljs-property">backgroundBlurriness</span> = <span class="hljs-number">0</span> <span class="hljs-comment">// 背景模糊</span><br>    scene.<span class="hljs-property">backgroundIntensity</span> = <span class="hljs-number">1</span> <span class="hljs-comment">// 环境光强度</span><br>&#125;);<br></code></pre></td></tr></table></figure>
<h3 id="使用一张全景贴图来代替背景"><a href="#使用一张全景贴图来代替背景" class="headerlink" title="使用一张全景贴图来代替背景"></a>使用一张全景贴图来代替背景</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> textureLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">TextureLoader</span>()<br>textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/grass/color.jpg&#x27;</span>,<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>, <span class="hljs-function">(<span class="hljs-params">texture</span>) =&gt;</span> &#123;<br>    texture.<span class="hljs-property">mapping</span> = <span class="hljs-title class_">Three</span>.<span class="hljs-property">EquirectangularReflectionMapping</span> <span class="hljs-comment">// 映射</span><br>    texture.<span class="hljs-property">colorSpace</span> = <span class="hljs-title class_">Three</span>.<span class="hljs-property">SRGBColorSpace</span> <span class="hljs-comment">// 颜色空间</span><br>    scene.<span class="hljs-property">background</span> = texture <span class="hljs-comment">// 背景</span><br>    scene.<span class="hljs-property">environment</span> = texture <span class="hljs-comment">// 环境</span><br>&#125;)<br></code></pre></td></tr></table></figure>
<h3 id="添加天空盒"><a href="#添加天空盒" class="headerlink" title="添加天空盒"></a>添加天空盒</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 引入天空盒</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">GroundedSkybox</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/objects/GroundedSkybox.js&#x27;</span>;<br><br><span class="hljs-comment">// 纹理加载器</span><br><span class="hljs-keyword">const</span> textureLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">TextureLoader</span>()<br>textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/grass/color.jpg&#x27;</span>,<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>, <span class="hljs-function">(<span class="hljs-params">texture</span>) =&gt;</span> &#123;<br>    texture.<span class="hljs-property">mapping</span> = <span class="hljs-title class_">Three</span>.<span class="hljs-property">EquirectangularReflectionMapping</span><br>    texture.<span class="hljs-property">colorSpace</span> = <span class="hljs-title class_">Three</span>.<span class="hljs-property">SRGBColorSpace</span><br>    scene.<span class="hljs-property">environment</span> = texture <span class="hljs-comment">// 环境</span><br>    <span class="hljs-comment">// 添加天空盒   材质  0.01高度  10半径</span><br>    <span class="hljs-keyword">const</span> groundedSkybox = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GroundedSkybox</span>(texture,<span class="hljs-number">0.01</span>,<span class="hljs-number">10</span>)<br>    <span class="hljs-comment">// 设置大小</span><br>    groundedSkybox.<span class="hljs-property">scale</span>.<span class="hljs-title function_">setScalar</span>(<span class="hljs-number">2</span>)<br>    scene.<span class="hljs-title function_">add</span>(groundedSkybox)<br>&#125;)<br></code></pre></td></tr></table></figure>
<h2 id="天空模型"><a href="#天空模型" class="headerlink" title="天空模型"></a>天空模型</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//地面模型</span><br><span class="hljs-comment">// 几何体</span><br><span class="hljs-keyword">const</span> groundGeo = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneGeometry</span>( <span class="hljs-number">10000</span>, <span class="hljs-number">10000</span> );<br><span class="hljs-keyword">const</span> groundMat = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshLambertMaterial</span>( &#123; <span class="hljs-attr">color</span>: <span class="hljs-number">0xffffff</span> &#125; );<span class="hljs-comment">//材质</span><br>groundMat.<span class="hljs-property">color</span>.<span class="hljs-title function_">setHSL</span>( <span class="hljs-number">0.095</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0.75</span> );<br><span class="hljs-comment">//创建网格模型</span><br><span class="hljs-keyword">const</span> ground = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>( groundGeo, groundMat );<br>ground.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = - <span class="hljs-number">33</span>;<br>ground.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = - <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>;<br>ground.<span class="hljs-property">receiveShadow</span> = <span class="hljs-literal">true</span>;<span class="hljs-comment">//网格模型接收阴影</span><br>scene.<span class="hljs-title function_">add</span>( ground );<br></code></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 天空模型</span><br><span class="hljs-keyword">const</span> vertexShader = <span class="hljs-string">`</span><br><span class="hljs-string">varying vec3 vWorldPosition;</span><br><span class="hljs-string">void main() &#123;</span><br><span class="hljs-string">    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );</span><br><span class="hljs-string">    vWorldPosition = worldPosition.xyz;</span><br><span class="hljs-string">    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">`</span>;<br><span class="hljs-keyword">const</span> fragmentShader = <span class="hljs-string">`</span><br><span class="hljs-string">uniform vec3 topColor;</span><br><span class="hljs-string">uniform vec3 bottomColor;</span><br><span class="hljs-string">uniform float offset;</span><br><span class="hljs-string">uniform float exponent;</span><br><span class="hljs-string">varying vec3 vWorldPosition;</span><br><span class="hljs-string">void main() &#123;</span><br><span class="hljs-string">    float h = normalize( vWorldPosition + offset ).y;</span><br><span class="hljs-string">    gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">`</span>;<br><span class="hljs-keyword">const</span> uniforms = &#123;<br>    <span class="hljs-string">&#x27;topColor&#x27;</span>: &#123; <span class="hljs-attr">value</span>: <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Color</span>( <span class="hljs-number">0x0077ff</span> ) &#125;,<br>    <span class="hljs-string">&#x27;bottomColor&#x27;</span>: &#123; <span class="hljs-attr">value</span>: <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Color</span>( <span class="hljs-number">0xffffff</span> ) &#125;,<br>    <span class="hljs-string">&#x27;offset&#x27;</span>: &#123; <span class="hljs-attr">value</span>: <span class="hljs-number">33</span> &#125;,<br>    <span class="hljs-string">&#x27;exponent&#x27;</span>: &#123; <span class="hljs-attr">value</span>: <span class="hljs-number">0.5</span> &#125;<br>&#125;;<br>uniforms[ <span class="hljs-string">&#x27;topColor&#x27;</span> ].<span class="hljs-property">value</span>.<span class="hljs-title function_">copy</span>( hemiLight.<span class="hljs-property">color</span> );<br>scene.<span class="hljs-property">fog</span>.<span class="hljs-property">color</span>.<span class="hljs-title function_">copy</span>( uniforms[ <span class="hljs-string">&#x27;bottomColor&#x27;</span> ].<span class="hljs-property">value</span> );<br><span class="hljs-keyword">const</span> skyGeo = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">SphereGeometry</span>( <span class="hljs-number">4000</span>, <span class="hljs-number">32</span>, <span class="hljs-number">15</span> );<br><span class="hljs-keyword">const</span> skyMat = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">ShaderMaterial</span>( &#123;<br>    <span class="hljs-attr">uniforms</span>: uniforms,<br>    <span class="hljs-attr">vertexShader</span>: vertexShader,<br>    <span class="hljs-attr">fragmentShader</span>: fragmentShader,<br>    <span class="hljs-attr">side</span>: <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">BackSide</span><br>&#125; );<br><span class="hljs-keyword">const</span> sky = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>( skyGeo, skyMat );<br>scene.<span class="hljs-title function_">add</span>( sky );<br></code></pre></td></tr></table></figure>

<h2 id="物体反光和镜面效果"><a href="#物体反光和镜面效果" class="headerlink" title="物体反光和镜面效果"></a>物体反光和镜面效果</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 添加一个发光圆环</span><br><span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">TorusGeometry</span>( <span class="hljs-number">1.5</span>, <span class="hljs-number">0.1</span>); <br><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshBasicMaterial</span>( &#123; <span class="hljs-attr">color</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Color</span>(<span class="hljs-number">10</span>,<span class="hljs-number">10</span>,<span class="hljs-number">10</span>) &#125; ); <br><span class="hljs-keyword">const</span> torus = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Mesh</span>( geometry, material ); <br>torus.<span class="hljs-property">layers</span>.<span class="hljs-title function_">enable</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 添加到图层  使用enable在正常场景中也可以显示</span><br>scene.<span class="hljs-title function_">add</span>( torus ); <br><br><span class="hljs-comment">// 添加一个镜面的立方体</span><br><span class="hljs-keyword">const</span> box = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br><span class="hljs-keyword">const</span> boxMaterial = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">MeshStandardMaterial</span>(&#123;<br>    <span class="hljs-attr">color</span>: <span class="hljs-number">0xffffff</span>,<br>    <span class="hljs-attr">roughness</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 粗糙度</span><br>    <span class="hljs-attr">metalness</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 金属度</span><br>&#125;)<br><span class="hljs-keyword">const</span> boxMesh = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Mesh</span>(box, boxMaterial)<br>boxMesh.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0</span>)<br>scene.<span class="hljs-title function_">add</span>(boxMesh)<br><br><span class="hljs-comment">// 创建一个投影渲染器</span><br><span class="hljs-keyword">const</span> cubeRednerTarget = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">WebGLCubeRenderTarget</span>(<br>    <span class="hljs-number">256</span>, <span class="hljs-comment">// 像素大小 数字越大效果越好 性能消耗更大</span><br>    &#123;<br>        type : <span class="hljs-title class_">Three</span>.<span class="hljs-property">HalfFloatType</span> <span class="hljs-comment">// 半精度 float也可以 但是效果相同 性能消耗更大</span><br>    &#125;<br>)<br><span class="hljs-comment">// 把渲染器渲染的纹理作为环境贴图</span><br>scene.<span class="hljs-property">environment</span> = cubeRednerTarget.<span class="hljs-property">texture</span><br><span class="hljs-comment">// 创建一个立方体相机</span><br><span class="hljs-keyword">const</span> cubeCamera = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">CubeCamera</span>(<span class="hljs-number">0.1</span>, <span class="hljs-number">100</span>, cubeRednerTarget)<br>cubeCamera.<span class="hljs-property">layers</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">1</span>) <span class="hljs-comment">// 添加到图层</span><br><span class="hljs-comment">// 设置立方体相机位置与需要渲染的物体位置一致</span><br>cubeCamera.<span class="hljs-property">position</span>.<span class="hljs-title function_">copy</span>(boxMesh.<span class="hljs-property">position</span>)<br>scene.<span class="hljs-title function_">add</span>(cubeCamera)<br><br></code></pre></td></tr></table></figure>

<h3 id="渲染器设置曝光参数"><a href="#渲染器设置曝光参数" class="headerlink" title="渲染器设置曝光参数"></a>渲染器设置曝光参数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 设置曝光强度</span><br>renderer.<span class="hljs-property">toneMappingExposure</span> = <span class="hljs-number">0.5</span><br><span class="hljs-comment">// 设置色调映射 demo 曝光模式</span><br><span class="hljs-comment">// renderer.toneMapping = Three.ReinhardToneMapping </span><br>gui.<span class="hljs-title function_">add</span>(renderer, <span class="hljs-string">&#x27;toneMapping&#x27;</span>, &#123;<br>        <span class="hljs-title class_">NoToneMapping</span>: <span class="hljs-title class_">Three</span>.<span class="hljs-property">NoToneMapping</span>,<br>        <span class="hljs-title class_">LinearToneMapping</span>: <span class="hljs-title class_">Three</span>.<span class="hljs-property">LinearToneMapping</span>,<br>        <span class="hljs-title class_">ReinhardToneMapping</span>: <span class="hljs-title class_">Three</span>.<span class="hljs-property">ReinhardToneMapping</span>,<br>        <span class="hljs-title class_">CineonToneMapping</span>: <span class="hljs-title class_">Three</span>.<span class="hljs-property">CineonToneMapping</span>,<br>        <span class="hljs-title class_">ACESFilmicToneMapping</span>: <span class="hljs-title class_">Three</span>.<span class="hljs-property">ACESFilmicToneMapping</span><br>    &#125;<br>)<br></code></pre></td></tr></table></figure>

<h2 id="GLSL的解释"><a href="#GLSL的解释" class="headerlink" title="GLSL的解释"></a>GLSL的解释</h2><p>GLSL（OpenGL Shading Language）是一种高级编程语言，专门设计用于编写运行在图形处理单元（GPU）上的程序。它是OpenGL的一部分，OpenGL是一个跨语言、跨平台的编程接口，用于渲染2D和3D矢量图形。GLSL允许开发者编写所谓的“着色器”（Shaders），这些着色器在GPU上执行，负责处理图形渲染管线中的不同阶段，如顶点着色（Vertex Shading）、片段着色（Fragment Shading）等。</p>
<h3 id="GLSL的主要特点："><a href="#GLSL的主要特点：" class="headerlink" title="GLSL的主要特点："></a>GLSL的主要特点：</h3><ul>
<li>并行性：GLSL程序在GPU上并行执行，这意味着多个顶点或片段可以同时被处理，大大提高了图形渲染的效率。</li>
<li>硬件加速：由于GLSL程序运行在GPU上，它们可以利用GPU的并行处理能力，实现比CPU上运行的软件更快的图形处理。</li>
<li>与OpenGL紧密集成：GLSL是OpenGL的一部分，因此它可以直接访问OpenGL提供的各种资源和功能，如纹理、缓冲区对象等。</li>
<li>可编程性：通过GLSL，开发者可以自定义图形渲染管线中的各个阶段，实现自定义的渲染效果，如光照、阴影、纹理映射等。</li>
<li>跨平台：由于OpenGL是一个跨平台的API，GLSL程序也可以在支持OpenGL的多种硬件和操作系统上运行。</li>
</ul>
<h3 id="GLSL的基本结构："><a href="#GLSL的基本结构：" class="headerlink" title="GLSL的基本结构："></a>GLSL的基本结构：</h3><h4 id="GLSL程序通常包括几个部分，每个部分对应图形渲染管线中的一个阶段："><a href="#GLSL程序通常包括几个部分，每个部分对应图形渲染管线中的一个阶段：" class="headerlink" title="GLSL程序通常包括几个部分，每个部分对应图形渲染管线中的一个阶段："></a>GLSL程序通常包括几个部分，每个部分对应图形渲染管线中的一个阶段：</h4><ul>
<li>顶点着色器（Vertex Shader）：处理每个顶点的数据，如位置、颜色、纹理坐标等。它通常用于实现顶点变换、光照计算等。</li>
<li>片段着色器（Fragment Shader）：处理每个片段（像素的候选者）的颜色和其他属性。它通常用于实现纹理映射、光照效果、颜色混合等。</li>
<li>几何着色器（Geometry Shader，可选）：在顶点着色器之后运行，允许开发者创建或修改图元（如点、线、三角形）。</li>
<li>计算着色器（Compute Shader，较新的特性）：用于执行通用计算任务，不直接参与图形渲染，但可以利用GPU的并行处理能力进行高性能计算。</li>
<li>GLSL程序通常使用类似于C的语法，但包含了一些专门用于图形处理的数据类型和函数。开发者需要熟悉OpenGL的渲染管线以及GPU的工作原理，才能有效地使用GLSL来创建复杂的图形效果。</li>
</ul>
<h2 id="着色器"><a href="#着色器" class="headerlink" title="着色器"></a>着色器</h2><p>需要使用到<code>glsl</code>语言编写<br>在计算机图形学中，顶点着色器（Vertex Shader）和片段着色器（Fragment Shader）是GPU编程中的两个核心组件，它们在图形渲染管道中扮演着至关重要的角色。以下是关于这两个着色器的详细解释：</p>
<h3 id="顶点着色器（Vertex-Shader）"><a href="#顶点着色器（Vertex-Shader）" class="headerlink" title="顶点着色器（Vertex Shader）"></a>顶点着色器（Vertex Shader）</h3><p>顶点着色器是图形渲染管道的第一个可编程阶段。它的主要任务是对每个顶点进行处理，包括坐标变换、光照计算和其他顶点属性的计算。具体来说，顶点着色器执行以下操作：</p>
<ul>
<li>坐标变换：将顶点坐标从模型空间转换到世界空间、视图空间和裁剪空间。这一过程中常用的变换矩阵包括模型矩阵、视图矩阵和投影矩阵。</li>
<li>光照计算：计算每个顶点的光照属性，如环境光、漫反射光和镜面反射光。</li>
<li>属性传递：将顶点属性（如颜色、纹理坐标、法线）传递到片段着色器，供后续处理使用。<br>顶点着色器处理后的顶点数据将作为后续渲染阶段（如光栅化、片段着色）的输入。</li>
</ul>
<h3 id="片段着色器（Fragment-Shader）"><a href="#片段着色器（Fragment-Shader）" class="headerlink" title="片段着色器（Fragment Shader）"></a>片段着色器（Fragment Shader）</h3><p>片段着色器是图形渲染管道的最后一个可编程阶段。它的主要任务是计算每个片段（像素）的最终颜色值。具体来说，片段着色器执行以下操作：</p>
<ul>
<li>颜色计算：根据顶点着色器传递过来的颜色和纹理采样，计算每个片段的颜色。</li>
<li>纹理采样：从纹理中采样颜色，并将其应用到片段上。</li>
<li>光照计算：进一步进行光照计算，以获得更加真实的光照效果。</li>
<li>特效实现：实现各种特效，如阴影、反射、折射等，以增强图像的视觉效果。<br>片段着色器处理后的片段数据将被合成到最终渲染的图像中。</li>
</ul>
<h3 id="两者之间的关系"><a href="#两者之间的关系" class="headerlink" title="两者之间的关系"></a>两者之间的关系</h3><ul>
<li>数据传递：顶点着色器处理每个顶点的数据，并将结果（如变换后的顶点位置、颜色、纹理坐标等）传递给片段着色器。顶点着色器输出的插值变量会被片段着色器使用。</li>
<li>阶段顺序：顶点着色器在图形渲染管道的早期阶段运行，负责顶点的几何变换和属性计算；而片段着色器在后期阶段运行，负责计算顶点形成的图元（如三角形）内部每个片段的颜色。</li>
<li>并行执行：GPU通过并行执行大量顶点着色器和片段着色器来加速图形渲染。每个顶点和每个片段的处理都是独立的，这使得并行计算成为可能。</li>
</ul>
<h3 id="直接使用glsl"><a href="#直接使用glsl" class="headerlink" title="直接使用glsl"></a>直接使用glsl</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 顶点着色器代码</span><br><span class="hljs-keyword">const</span> vertexShader = <span class="hljs-string">`</span><br><span class="hljs-string">    varying vec2 vUv;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    void main() &#123;</span><br><span class="hljs-string">        vUv = uv;</span><br><span class="hljs-string">        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">`</span>;<br><span class="hljs-comment">// 片段着色器代码</span><br><span class="hljs-keyword">const</span> fragmentShader = <span class="hljs-string">`</span><br><span class="hljs-string">    uniform vec3 color;</span><br><span class="hljs-string">    varying vec2 vUv;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    void main() &#123;</span><br><span class="hljs-string">        // 使用简单的颜色渐变效果，基于uv坐标</span><br><span class="hljs-string">        float intensity = mix(0.0, 1.0, vUv.y);</span><br><span class="hljs-string">        gl_FragColor = vec4(color * intensity, 1.0);</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">`</span>;<br><span class="hljs-comment">// 创建着色器材料</span><br><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">ShaderMaterial</span>(&#123;<br>    <span class="hljs-attr">vertexShader</span>: vertexShader, <span class="hljs-comment">// 顶点着色器代码</span><br>    <span class="hljs-attr">fragmentShader</span>: fragmentShader, <span class="hljs-comment">// 片段着色器代码</span><br>    <span class="hljs-attr">uniforms</span>: &#123; <span class="hljs-comment">// uniform变量 传递给着色器</span><br>        <span class="hljs-attr">color</span>: &#123; <span class="hljs-attr">value</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Color</span>(<span class="hljs-number">0xff0000</span>) &#125; <span class="hljs-comment">// 红色</span><br>    &#125;<br>&#125;);<br><span class="hljs-comment">// 创建一个几何体并应用材质</span><br><span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">BoxGeometry</span>();<br><span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Mesh</span>(geometry, material);<br><span class="hljs-comment">// 添加到场景中</span><br>scene.<span class="hljs-title function_">add</span>(cube);<br><span class="hljs-comment">// 渲染场景（这部分代码通常位于动画循环中）</span><br>renderer.<span class="hljs-title function_">render</span>(scene, camera);<br></code></pre></td></tr></table></figure>
<h3 id="引用glsl文件"><a href="#引用glsl文件" class="headerlink" title="引用glsl文件"></a>引用glsl文件</h3><p>用于将 GLSL 文件转换为 JavaScript 代码。它允许您在 Vue、React 或其他支持 Vite 的框架中使用 GLSL 着色<br>二选一即可:</p>
<ul>
<li><code>vite-plugin-glslify</code> 很久没更新了</li>
<li><code>vite-plugin-glsl</code> 还在持续更新</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install vite-plugin-glslify -d<br>npm install vite-plugin-glsl -d<br></code></pre></td></tr></table></figure>
<p>安装好glsl后需要在vite.config.js中配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> glsl <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite-plugin-glsl&#x27;</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(&#123;<br>    <span class="hljs-attr">plugins</span>: [<br>        <span class="hljs-title function_">glsl</span>()<br>    ]<br>&#125;)<br></code></pre></td></tr></table></figure>
<h3 id="在vue文件中引用glsl"><a href="#在vue文件中引用glsl" class="headerlink" title="在vue文件中引用glsl"></a>在vue文件中引用glsl</h3><p><strong>着色器材料中失效的属性 map alphaMap color etc 需要在glsl中处理</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">import</span> vertexShader <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./vertexShader.glsl&#x27;</span></span><br><span class="language-javascript">    <span class="hljs-keyword">import</span> fragmentShader <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./fragmentShader.glsl&#x27;</span></span><br><span class="language-javascript">    <span class="hljs-comment">// 创建着色器材质</span></span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">ShaderMaterial</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">vertexShader</span>: vertexShader, <span class="hljs-comment">// 顶点着色器代码</span></span><br><span class="language-javascript">        <span class="hljs-attr">fragmentShader</span>: fragmentShader, <span class="hljs-comment">// 片段着色器代码</span></span><br><span class="language-javascript">        <span class="hljs-attr">uniforms</span>: &#123; <span class="hljs-comment">// uniform变量 传递给着色器</span></span><br><span class="language-javascript">            <span class="hljs-attr">color</span>: &#123; <span class="hljs-attr">value</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Color</span>(<span class="hljs-number">0xff0000</span>) &#125; <span class="hljs-comment">// 红色</span></span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h3 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h3><p><a target="_blank" rel="noopener" href="https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83">代码插件</a></p>
<h3 id="vertex-glsl"><a href="#vertex-glsl" class="headerlink" title="vertex.glsl"></a>vertex.glsl</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">gl_Position = projectionMatrix * modelViewMatrix * vec4( position, <span class="hljs-number">1.0</span>);<br></code></pre></td></tr></table></figure>
<ul>
<li>这个表达式首先通过modelViewMatrix将物体的位置从对象空间变换到视图空间。</li>
<li>然后，通过projectionMatrix将视图空间中的位置变换到裁剪空间。</li>
<li>最终得到的gl_Position是一个四维向量，在光栅化阶段，OpenGL会使用这个向量的x, y, z分量进行透视除法（使用w分量），从而得到归一化设备坐标（Normalized Device Coordinates, NDC），这是进行光栅化和片段着色之前的一个重要步骤。</li>
</ul>
<h4 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h4><p><code>常量可以不声明直接使用</code><br>&#96;&#96;</p>
<h5 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h5><p><code>Attributes 主要用于顶点着色器，并且通常包含与每个顶点相关的数据，例如顶点位置、法线、纹理坐标等。在Three.js中，常见的attributes包括：</code></p>
<ul>
<li>position：顶点的位置（通常在模型空间中）。</li>
<li>normal：顶点的法线向量（用于光照计算）。</li>
<li>uv：顶点的纹理坐标。</li>
<li>color：顶点的颜色。</li>
</ul>
<h5 id="Uniforms"><a href="#Uniforms" class="headerlink" title="Uniforms"></a>Uniforms</h5><p><code>Uniforms 是传递给着色器的常量值，它们在着色器程序执行期间不会改变，但对于每一帧或每一次绘制调用，它们的值可以从CPU端设置。在Three.js中，你可以使用许多内置的uniforms，也可以定义自己的uniforms。一些常见的内置uniforms包括：</code></p>
<ul>
<li>projectionMatrix：投影矩阵（用于将视图空间坐标转换为裁剪空间坐标）。</li>
<li>modelViewMatrix：模型视图矩阵（用于将模型空间坐标转换为视图空间坐标）。</li>
<li>normalMatrix：法线矩阵（用于变换法线向量）。</li>
<li>cameraPosition：相机在世界空间中的位置。</li>
<li>resolution：渲染目标的分辨率（宽度和高度）。</li>
<li>time：当前时间（通常用于动画效果）。</li>
</ul>
<h4 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h4><ul>
<li>uniform 接收js(uniforms)传递来的参数</li>
<li>attribute 接收着色器的attribute属性</li>
<li>varying 声明变量传递给片段着色器(用于从顶点着色器传递数据到片段着色器。它们在顶点着色器中被写入，并在片段着色器中被读取。Varyings在光栅化过程中会被插值，以便为每个片段生成一个值。)</li>
</ul>
<h4 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h4><ul>
<li>vec2 vec3 vec4 矢量类型</li>
<li>mat2 mat3 mat4 矩阵类型</li>
<li>float 浮点类型</li>
<li>void 空类型</li>
<li>bool 布尔类型</li>
<li>sampler2D 纹理类型</li>
<li>attribute 顶点属性</li>
</ul>
<p><strong>强类型语言 类似于C预言</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> loader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">TextureLoader</span>() <span class="hljs-comment">// 纹理加载器</span><br><span class="hljs-comment">// 创建着色器材料</span><br><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">ShaderMaterial</span>(&#123;<br>    <span class="hljs-attr">vertexShader</span>: vertexShader, <span class="hljs-comment">// 顶点着色器代码</span><br>    <span class="hljs-attr">fragmentShader</span>: fragmentShader, <span class="hljs-comment">// 片段着色器代码</span><br>    <span class="hljs-attr">uniforms</span>: &#123;<br>        <span class="hljs-attr">color</span>: &#123; <span class="hljs-attr">value</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Three</span>.<span class="hljs-title class_">Color</span>(<span class="hljs-number">0xff00ff</span>) &#125;,<br>        <span class="hljs-attr">uFren</span>: &#123; <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> &#125;, <span class="hljs-comment">// sin频率</span><br>        <span class="hljs-attr">uTime</span>: &#123; <span class="hljs-attr">value</span>: <span class="hljs-number">0</span> &#125;, <span class="hljs-comment">// 传递时间变量</span><br>        <span class="hljs-attr">uTexture</span>: &#123; <span class="hljs-attr">value</span>: loader.<span class="hljs-title function_">load</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;@/assets/us.jpg&#x27;</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>).<span class="hljs-property">href</span>) &#125; <span class="hljs-comment">// 加载纹理</span><br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>
<p><code>顶点着色器代码 vertex.glsl</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c">uniform vec3 color;<br>uniform <span class="hljs-type">float</span> uFren;<br>uniform <span class="hljs-type">float</span> uTime;<br>attribute <span class="hljs-type">float</span> aRandom;<br>varying vec2 vuv;<br>varying <span class="hljs-type">float</span> z;<br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    z = <span class="hljs-built_in">sin</span>(position.x * uFren + uTime) * <span class="hljs-number">0.3</span>;<br>    z += <span class="hljs-built_in">sin</span>(position.y * uFren + uTime) * <span class="hljs-number">0.3</span>;<br>    gl_Position = projectionMatrix * modelViewMatrix * vec4( position.x, position.y, z, <span class="hljs-number">1.0</span>);<br>    vuv = uv;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>片段着色器代码 fragment.glsl</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c">uniform vec3 color;<br>uniform sampler2D uTexture;<br>varying vec2 vuv;<br>varying <span class="hljs-type">float</span> z;<br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    gl_FragColor = vec4(color , <span class="hljs-number">1.0</span>); <span class="hljs-comment">// 使用颜色和透明度</span><br>    vec4 texColor = texture2D(uTexture, vuv); <span class="hljs-comment">// 使用纹理 加载纹理</span><br>    texColor.rgb *= z * <span class="hljs-number">1.0</span> + <span class="hljs-number">1.0</span>; <span class="hljs-comment">// 设置亮度   -0.3 &lt; z &lt; 0.3</span><br>    gl_FragColor = texColor; <br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="fragment-片段着色器-例子"><a href="#fragment-片段着色器-例子" class="headerlink" title="fragment 片段着色器 例子"></a>fragment 片段着色器 例子</h4><ul>
<li>mod(x, y) 返回 x &#x2F; y 的余数</li>
<li>step(a, b) 返回 a &lt; b ? 1.0 : 0.0</li>
<li>clamp(a, b, c) 返回 max(a, min(b, c))</li>
<li>max(a,b) 返回最大值</li>
<li>min(a,b) 返回最小值</li>
<li>abs(a) 返回绝对值</li>
<li>length(vuv) 返回向量长度</li>
<li>distance(vuv,vec2(0.0,0.0)) 返回两点距离</li>
<li>atan(vuv.x,vuv.y) 返回反正切值</li>
<li>mix(a,b,c) 混合两种颜色 a第一种 b第二种 c渲染的向量位置</li>
</ul>
<h5 id="公用部分"><a href="#公用部分" class="headerlink" title="公用部分"></a>公用部分</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 常量</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PI 3.1415926535897932384626433832795</span><br><br>varying vec2 vUv;<br><span class="hljs-comment">// 返回一个 0 ~ 1 之间的随机数(伪随机)</span><br><span class="hljs-type">float</span> <span class="hljs-title function_">random</span><span class="hljs-params">(vec2 st)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> fract(<span class="hljs-built_in">sin</span>(dot(st.xy, vec2(<span class="hljs-number">12.9898</span>,<span class="hljs-number">78.233</span>))) * <span class="hljs-number">43758.5453123</span>);<br>&#125;<br><span class="hljs-comment">// 旋转坐标系 (原来的坐标系,旋转角度π=180°,旋转中心vec2(0.5,0.5))</span><br>vec2 <span class="hljs-title function_">rotate</span><span class="hljs-params">(vec2 uv, <span class="hljs-type">float</span> rotation, vec2 mid)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> vec2(<br>      <span class="hljs-built_in">cos</span>(rotation) * (uv.x - mid.x) + <span class="hljs-built_in">sin</span>(rotation) * (uv.y - mid.y) + mid.x,<br>      <span class="hljs-built_in">cos</span>(rotation) * (uv.y - mid.y) - <span class="hljs-built_in">sin</span>(rotation) * (uv.x - mid.x) + mid.y<br>    );<br>&#125;<br><br>vec2 <span class="hljs-title function_">fade</span><span class="hljs-params">(vec2 t)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> t*t*t*(t*(t*<span class="hljs-number">6.0</span><span class="hljs-number">-15.0</span>)+<span class="hljs-number">10.0</span>);<br>&#125;<br><br><br>vec4 <span class="hljs-title function_">permute</span><span class="hljs-params">(vec4 x)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> mod(((x*<span class="hljs-number">34.0</span>)+<span class="hljs-number">1.0</span>)*x, <span class="hljs-number">289.0</span>);<br>&#125;<br><span class="hljs-type">float</span> <span class="hljs-title function_">cnoise</span><span class="hljs-params">(vec2 P)</span><br>&#123;<br>    vec4 Pi = <span class="hljs-built_in">floor</span>(P.xyxy) + vec4(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>);<br>    vec4 Pf = fract(P.xyxy) - vec4(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>);<br>    Pi = mod(Pi, <span class="hljs-number">289.0</span>); <span class="hljs-comment">// To avoid truncation effects in permutation</span><br>    vec4 ix = Pi.xzxz;<br>    vec4 iy = Pi.yyww;<br>    vec4 fx = Pf.xzxz;<br>    vec4 fy = Pf.yyww;<br>    vec4 i = permute(permute(ix) + iy);<br>    vec4 gx = <span class="hljs-number">2.0</span> * fract(i * <span class="hljs-number">0.0243902439</span>) - <span class="hljs-number">1.0</span>; <span class="hljs-comment">// 1/41 = 0.024...</span><br>    vec4 gy = <span class="hljs-built_in">abs</span>(gx) - <span class="hljs-number">0.5</span>;<br>    vec4 tx = <span class="hljs-built_in">floor</span>(gx + <span class="hljs-number">0.5</span>);<br>    gx = gx - tx;<br>    vec2 g00 = vec2(gx.x,gy.x);<br>    vec2 g10 = vec2(gx.y,gy.y);<br>    vec2 g01 = vec2(gx.z,gy.z);<br>    vec2 g11 = vec2(gx.w,gy.w);<br>    vec4 norm = <span class="hljs-number">1.79284291400159</span> - <span class="hljs-number">0.85373472095314</span> * vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11));<br>    g00 *= norm.x;<br>    g01 *= norm.y;<br>    g10 *= norm.z;<br>    g11 *= norm.w;<br>    <span class="hljs-type">float</span> n00 = dot(g00, vec2(fx.x, fy.x));<br>    <span class="hljs-type">float</span> n10 = dot(g10, vec2(fx.y, fy.y));<br>    <span class="hljs-type">float</span> n01 = dot(g01, vec2(fx.z, fy.z));<br>    <span class="hljs-type">float</span> n11 = dot(g11, vec2(fx.w, fy.w));<br>    vec2 fade_xy = fade(Pf.xy);<br>    vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);<br>    <span class="hljs-type">float</span> n_xy = mix(n_x.x, n_x.y, fade_xy.y);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">2.3</span> * n_xy;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="使用demo"><a href="#使用demo" class="headerlink" title="使用demo"></a>使用demo</h4><p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;1.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 1</span><br>gl_FragColor = vec4(vUv, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;2.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 2</span><br>gl_FragColor = vec4(vUv, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;3.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 3</span><br><span class="hljs-type">float</span> strength = vUv.x;<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;4.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 4</span><br><span class="hljs-type">float</span> strength = vUv.y;<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;5.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 5</span><br><span class="hljs-type">float</span> strength = <span class="hljs-number">1.0</span> - vUv.y;<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;6.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 6</span><br><span class="hljs-type">float</span> strength = vUv.y * <span class="hljs-number">10.0</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;7.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 7</span><br><span class="hljs-type">float</span> strength = mod(vUv.y * <span class="hljs-number">10.0</span>, <span class="hljs-number">1.0</span>);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;8.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 8</span><br><span class="hljs-type">float</span> strength = mod(vUv.y * <span class="hljs-number">10.0</span>, <span class="hljs-number">1.0</span>);<br>strength = step(<span class="hljs-number">0.5</span>, strength);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;9.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 9</span><br><span class="hljs-type">float</span> strength = mod(vUv.y * <span class="hljs-number">10.0</span>, <span class="hljs-number">1.0</span>);<br>strength = step(<span class="hljs-number">0.8</span>, strength);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;10.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 10</span><br><span class="hljs-type">float</span> strength = mod(vUv.x * <span class="hljs-number">10.0</span>, <span class="hljs-number">1.0</span>);<br>strength = step(<span class="hljs-number">0.8</span>, strength);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;11.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 11</span><br><span class="hljs-type">float</span> strength = step(<span class="hljs-number">0.8</span>, mod(vUv.x * <span class="hljs-number">10.0</span>, <span class="hljs-number">1.0</span>));<br>strength += step(<span class="hljs-number">0.8</span>, mod(vUv.y * <span class="hljs-number">10.0</span>, <span class="hljs-number">1.0</span>));<br>strength = clamp(strength, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;12.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 12</span><br><span class="hljs-type">float</span> strength = step(<span class="hljs-number">0.8</span>, mod(vUv.x * <span class="hljs-number">10.0</span>, <span class="hljs-number">1.0</span>));<br>strength *= step(<span class="hljs-number">0.8</span>, mod(vUv.y * <span class="hljs-number">10.0</span>, <span class="hljs-number">1.0</span>));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;13.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 13</span><br><span class="hljs-type">float</span> strength = step(<span class="hljs-number">0.4</span>, mod(vUv.x * <span class="hljs-number">10.0</span>, <span class="hljs-number">1.0</span>));<br>strength *= step(<span class="hljs-number">0.8</span>, mod(vUv.y * <span class="hljs-number">10.0</span>, <span class="hljs-number">1.0</span>));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;14.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 14</span><br><span class="hljs-type">float</span> barX = step(<span class="hljs-number">0.4</span>, mod(vUv.x * <span class="hljs-number">10.0</span>, <span class="hljs-number">1.0</span>)) * step(<span class="hljs-number">0.8</span>, mod(vUv.y * <span class="hljs-number">10.0</span>, <span class="hljs-number">1.0</span>));<br><span class="hljs-type">float</span> barY = step(<span class="hljs-number">0.8</span>, mod(vUv.x * <span class="hljs-number">10.0</span>, <span class="hljs-number">1.0</span>)) * step(<span class="hljs-number">0.4</span>, mod(vUv.y * <span class="hljs-number">10.0</span>, <span class="hljs-number">1.0</span>));<br><span class="hljs-type">float</span> strength = barX + barY;<br>strength = clamp(strength, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;15.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 15</span><br><span class="hljs-type">float</span> barX = step(<span class="hljs-number">0.4</span>, mod(vUv.x * <span class="hljs-number">10.0</span> - <span class="hljs-number">0.2</span>, <span class="hljs-number">1.0</span>)) * step(<span class="hljs-number">0.8</span>, mod(vUv.y * <span class="hljs-number">10.0</span>, <span class="hljs-number">1.0</span>));<br><span class="hljs-type">float</span> barY = step(<span class="hljs-number">0.8</span>, mod(vUv.x * <span class="hljs-number">10.0</span>, <span class="hljs-number">1.0</span>)) * step(<span class="hljs-number">0.4</span>, mod(vUv.y * <span class="hljs-number">10.0</span> - <span class="hljs-number">0.2</span>, <span class="hljs-number">1.0</span>));<br><span class="hljs-type">float</span> strength = barX + barY;<br>strength = clamp(strength, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;16.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 16</span><br><span class="hljs-type">float</span> strength = <span class="hljs-built_in">abs</span>(vUv.x - <span class="hljs-number">0.5</span>);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;17.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 17</span><br><span class="hljs-type">float</span> strength = min(<span class="hljs-built_in">abs</span>(vUv.x - <span class="hljs-number">0.5</span>), <span class="hljs-built_in">abs</span>(vUv.y - <span class="hljs-number">0.5</span>));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;18.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 18</span><br><span class="hljs-type">float</span> strength = max(<span class="hljs-built_in">abs</span>(vUv.x - <span class="hljs-number">0.5</span>), <span class="hljs-built_in">abs</span>(vUv.y - <span class="hljs-number">0.5</span>));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;19.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 19</span><br><span class="hljs-type">float</span> strength = step(<span class="hljs-number">0.2</span>, max(<span class="hljs-built_in">abs</span>(vUv.x - <span class="hljs-number">0.5</span>), <span class="hljs-built_in">abs</span>(vUv.y - <span class="hljs-number">0.5</span>)));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;20.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 20</span><br><span class="hljs-type">float</span> strength = step(<span class="hljs-number">0.2</span>, max(<span class="hljs-built_in">abs</span>(vUv.x - <span class="hljs-number">0.5</span>), <span class="hljs-built_in">abs</span>(vUv.y - <span class="hljs-number">0.5</span>)));<br>strength *= <span class="hljs-number">1.0</span> - step(<span class="hljs-number">0.25</span>, max(<span class="hljs-built_in">abs</span>(vUv.x - <span class="hljs-number">0.5</span>), <span class="hljs-built_in">abs</span>(vUv.y - <span class="hljs-number">0.5</span>)));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;21.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 21</span><br><span class="hljs-type">float</span> strength = <span class="hljs-built_in">floor</span>(vUv.x * <span class="hljs-number">10.0</span>) / <span class="hljs-number">10.0</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;22.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 22</span><br><span class="hljs-type">float</span> strength = <span class="hljs-built_in">floor</span>(vUv.x * <span class="hljs-number">10.0</span>) / <span class="hljs-number">10.0</span> * <span class="hljs-built_in">floor</span>(vUv.y * <span class="hljs-number">10.0</span>) / <span class="hljs-number">10.0</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;23.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 23</span><br><span class="hljs-type">float</span> strength = random(vUv);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;24.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 24</span><br>vec2 gridUv = vec2(<span class="hljs-built_in">floor</span>(vUv.x * <span class="hljs-number">10.0</span>) / <span class="hljs-number">10.0</span>, <span class="hljs-built_in">floor</span>(vUv.y * <span class="hljs-number">10.0</span>) / <span class="hljs-number">10.0</span>);<br><span class="hljs-type">float</span> strength = random(gridUv);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;25.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 25</span><br>vec2 gridUv = vec2(<span class="hljs-built_in">floor</span>(vUv.x * <span class="hljs-number">10.0</span>) / <span class="hljs-number">10.0</span>, <span class="hljs-built_in">floor</span>((vUv.y + vUv.x * <span class="hljs-number">0.5</span>) * <span class="hljs-number">10.0</span>) / <span class="hljs-number">10.0</span>);<br><span class="hljs-type">float</span> strength = random(gridUv);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;26.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 26</span><br><span class="hljs-type">float</span> strength = length(vUv);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;27.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 27</span><br><span class="hljs-type">float</span> strength = distance(vUv, vec2(<span class="hljs-number">0.5</span>));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;28.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 28</span><br><span class="hljs-type">float</span> strength = <span class="hljs-number">1.0</span> - distance(vUv, vec2(<span class="hljs-number">0.5</span>));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;29.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 29</span><br><span class="hljs-type">float</span> strength = <span class="hljs-number">0.015</span> / (distance(vUv, vec2(<span class="hljs-number">0.5</span>)));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;30.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 30</span><br><span class="hljs-type">float</span> strength = <span class="hljs-number">0.15</span> / (distance(vec2(vUv.x, (vUv.y - <span class="hljs-number">0.5</span>) * <span class="hljs-number">5.0</span> + <span class="hljs-number">0.5</span>), vec2(<span class="hljs-number">0.5</span>)));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;31.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 31</span><br><span class="hljs-type">float</span> strength = <span class="hljs-number">0.15</span> / (distance(vec2(vUv.x, (vUv.y - <span class="hljs-number">0.5</span>) * <span class="hljs-number">5.0</span> + <span class="hljs-number">0.5</span>), vec2(<span class="hljs-number">0.5</span>)));<br>strength *= <span class="hljs-number">0.15</span> / (distance(vec2(vUv.y, (vUv.x - <span class="hljs-number">0.5</span>) * <span class="hljs-number">5.0</span> + <span class="hljs-number">0.5</span>), vec2(<span class="hljs-number">0.5</span>)));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;32.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 32</span><br>vec2 rotatedUv = rotate(vUv, PI * <span class="hljs-number">0.25</span>, vec2(<span class="hljs-number">0.5</span>));<br><span class="hljs-type">float</span> strength = <span class="hljs-number">0.15</span> / (distance(vec2(rotatedUv.x, (rotatedUv.y - <span class="hljs-number">0.5</span>) * <span class="hljs-number">5.0</span> + <span class="hljs-number">0.5</span>), vec2(<span class="hljs-number">0.5</span>)));<br>strength *= <span class="hljs-number">0.15</span> / (distance(vec2(rotatedUv.y, (rotatedUv.x - <span class="hljs-number">0.5</span>) * <span class="hljs-number">5.0</span> + <span class="hljs-number">0.5</span>), vec2(<span class="hljs-number">0.5</span>)));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;33.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 33</span><br><span class="hljs-type">float</span> strength = step(<span class="hljs-number">0.5</span>, distance(vUv, vec2(<span class="hljs-number">0.5</span>)) + <span class="hljs-number">0.25</span>);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;34.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 34</span><br><span class="hljs-type">float</span> strength = <span class="hljs-built_in">abs</span>(distance(vUv, vec2(<span class="hljs-number">0.5</span>)) - <span class="hljs-number">0.25</span>);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;35.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 35</span><br><span class="hljs-type">float</span> strength = step(<span class="hljs-number">0.01</span>, <span class="hljs-built_in">abs</span>(distance(vUv, vec2(<span class="hljs-number">0.5</span>)) - <span class="hljs-number">0.25</span>));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;36.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 36</span><br><span class="hljs-type">float</span> strength = <span class="hljs-number">1.0</span> - step(<span class="hljs-number">0.01</span>, <span class="hljs-built_in">abs</span>(distance(vUv, vec2(<span class="hljs-number">0.5</span>)) - <span class="hljs-number">0.25</span>));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;37.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 37</span><br>vec2 wavedUv = vec2(<br>    vUv.x,<br>    vUv.y + <span class="hljs-built_in">sin</span>(vUv.x * <span class="hljs-number">30.0</span>) * <span class="hljs-number">0.1</span><br>);<br><span class="hljs-type">float</span> strength = <span class="hljs-number">1.0</span> - step(<span class="hljs-number">0.01</span>, <span class="hljs-built_in">abs</span>(distance(wavedUv, vec2(<span class="hljs-number">0.5</span>)) - <span class="hljs-number">0.25</span>));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;38.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 38</span><br>vec2 wavedUv = vec2(<br>    vUv.x + <span class="hljs-built_in">sin</span>(vUv.y * <span class="hljs-number">30.0</span>) * <span class="hljs-number">0.1</span>,<br>    vUv.y + <span class="hljs-built_in">sin</span>(vUv.x * <span class="hljs-number">30.0</span>) * <span class="hljs-number">0.1</span><br>);<br><span class="hljs-type">float</span> strength = <span class="hljs-number">1.0</span> - step(<span class="hljs-number">0.01</span>, <span class="hljs-built_in">abs</span>(distance(wavedUv, vec2(<span class="hljs-number">0.5</span>)) - <span class="hljs-number">0.25</span>));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;39.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 39</span><br>vec2 wavedUv = vec2(<br>    vUv.x + <span class="hljs-built_in">sin</span>(vUv.y * <span class="hljs-number">100.0</span>) * <span class="hljs-number">0.1</span>,<br>    vUv.y + <span class="hljs-built_in">sin</span>(vUv.x * <span class="hljs-number">100.0</span>) * <span class="hljs-number">0.1</span><br>);<br><span class="hljs-type">float</span> strength = <span class="hljs-number">1.0</span> - step(<span class="hljs-number">0.01</span>, <span class="hljs-built_in">abs</span>(distance(wavedUv, vec2(<span class="hljs-number">0.5</span>)) - <span class="hljs-number">0.25</span>));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;40.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 40</span><br><span class="hljs-type">float</span> angle = <span class="hljs-built_in">atan</span>(vUv.x, vUv.y);<br><span class="hljs-type">float</span> strength = angle;<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;41.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 41</span><br><span class="hljs-type">float</span> angle = <span class="hljs-built_in">atan</span>(vUv.x - <span class="hljs-number">0.5</span>, vUv.y - <span class="hljs-number">0.5</span>);<br><span class="hljs-type">float</span> strength = angle;<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;42.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 42</span><br><span class="hljs-type">float</span> angle = <span class="hljs-built_in">atan</span>(vUv.x - <span class="hljs-number">0.5</span>, vUv.y - <span class="hljs-number">0.5</span>) / (PI * <span class="hljs-number">2.0</span>) + <span class="hljs-number">0.5</span>;<br><span class="hljs-type">float</span> strength = angle;<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;43.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 43</span><br><span class="hljs-type">float</span> angle = <span class="hljs-built_in">atan</span>(vUv.x - <span class="hljs-number">0.5</span>, vUv.y - <span class="hljs-number">0.5</span>) / (PI * <span class="hljs-number">2.0</span>) + <span class="hljs-number">0.5</span>;<br><span class="hljs-type">float</span> strength = mod(angle * <span class="hljs-number">20.0</span>, <span class="hljs-number">1.0</span>);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;44.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 44</span><br><span class="hljs-type">float</span> angle = <span class="hljs-built_in">atan</span>(vUv.x - <span class="hljs-number">0.5</span>, vUv.y - <span class="hljs-number">0.5</span>) / (PI * <span class="hljs-number">2.0</span>) + <span class="hljs-number">0.5</span>;<br><span class="hljs-type">float</span> strength = <span class="hljs-built_in">sin</span>(angle * <span class="hljs-number">100.0</span>);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;45.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 45</span><br><span class="hljs-type">float</span> angle = <span class="hljs-built_in">atan</span>(vUv.x - <span class="hljs-number">0.5</span>, vUv.y - <span class="hljs-number">0.5</span>) / (PI * <span class="hljs-number">2.0</span>) + <span class="hljs-number">0.5</span>;<br><span class="hljs-type">float</span> radius = <span class="hljs-number">0.25</span> + <span class="hljs-built_in">sin</span>(angle * <span class="hljs-number">100.0</span>) * <span class="hljs-number">0.02</span>;<br><span class="hljs-type">float</span> strength = <span class="hljs-number">1.0</span> - step(<span class="hljs-number">0.01</span>, <span class="hljs-built_in">abs</span>(distance(vUv, vec2(<span class="hljs-number">0.5</span>)) - radius));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;46.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 46</span><br><span class="hljs-type">float</span> strength = cnoise(vUv * <span class="hljs-number">10.0</span>);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;47.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 47</span><br><span class="hljs-type">float</span> strength = step(<span class="hljs-number">0.0</span>, cnoise(vUv * <span class="hljs-number">10.0</span>));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;48.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 48</span><br><span class="hljs-type">float</span> strength = <span class="hljs-number">1.0</span> - <span class="hljs-built_in">abs</span>(cnoise(vUv * <span class="hljs-number">10.0</span>));<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;49.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 49</span><br><span class="hljs-type">float</span> strength = <span class="hljs-built_in">sin</span>(cnoise(vUv * <span class="hljs-number">10.0</span>) * <span class="hljs-number">20.0</span>);<br></code></pre></td></tr></table></figure>
<p><img src="/demo" alt="https:&#x2F;&#x2F;cdn.wdtwo.com&#x2F;glsl&#x2F;images&#x2F;50.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Pattern 50</span><br><span class="hljs-type">float</span> strength = step(<span class="hljs-number">0.9</span>, <span class="hljs-built_in">sin</span>(cnoise(vUv * <span class="hljs-number">10.0</span>) * <span class="hljs-number">20.0</span>));<br></code></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">gl_FragColor = vec4(vec3(strength), <span class="hljs-number">1.0</span>);<br></code></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Final color</span><br>vec3 blackColor = vec3(<span class="hljs-number">0.0</span>);<br>vec3 uvColor = vec3(vUv, <span class="hljs-number">1.0</span>);<br>vec3 mixedColor = mix(blackColor, uvColor, strength);<br>gl_FragColor = vec4(mixedColor, <span class="hljs-number">1.0</span>);<br></code></pre></td></tr></table></figure>


<h2 id="11添加2d标签"><a href="#11添加2d标签" class="headerlink" title="11添加2d标签"></a>11添加2d标签</h2><p><code>&lt;div :ref=&#39;index&#39; :id=&#39;index&#39;&gt;标注&lt;/div&gt;</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//tag.vue</span><br><span class="hljs-keyword">import</span> &#123;<span class="hljs-title class_">CSS2DObject</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/renderers/CSS2DObject.js&#x27;</span><br><span class="hljs-keyword">import</span> &#123;scene&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./three/index.js&#x27;</span><br><br><span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">var</span> div = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>]<br>    <span class="hljs-keyword">var</span> label = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CSS2DObject</span>(div)<br>    div.<span class="hljs-property">style</span>.<span class="hljs-property">pointerEvents</span> = <span class="hljs-string">&#x27;none&#x27;</span><span class="hljs-comment">//防止html标签遮挡三维场景</span><br>    label.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">y</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">z</span>)<br>    scene.<span class="hljs-title function_">add</span>(label)<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//CSS2DRenderer.js</span><br><span class="hljs-keyword">import</span> &#123;<span class="hljs-title class_">CSS2DRenderder</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/renderers/CSS2DRenderder&#x27;</span><br><br><span class="hljs-keyword">var</span> <span class="hljs-title class_">CSS2LabelRenderder</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CSS2DRenderder</span>()<br><span class="hljs-title class_">CSS2LabelRenderder</span>.<span class="hljs-title function_">setSize</span>(<span class="hljs-number">500</span>,<span class="hljs-number">500</span>)<br><span class="hljs-title class_">CSS2LabelRenderder</span>.<span class="hljs-property">domElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">position</span> = <span class="hljs-string">&#x27;absolute&#x27;</span><br><span class="hljs-title class_">CSS2LabelRenderder</span>.<span class="hljs-property">domElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">left</span> = <span class="hljs-string">&#x27;0px&#x27;</span><br><span class="hljs-title class_">CSS2LabelRenderder</span>.<span class="hljs-property">domElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">&#x27;0px&#x27;</span><br><span class="hljs-title class_">CSS2LabelRenderder</span>.<span class="hljs-property">domElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">pointerEvents</span> = <span class="hljs-string">&#x27;none&#x27;</span><br><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-title class_">CSS2LabelRenderder</span>.<span class="hljs-property">domElement</span>)<br><span class="hljs-keyword">export</span> &#123;<span class="hljs-title class_">CSS2LabelRenderer</span>&#125;<br><span class="hljs-comment">//index.js</span><br><span class="hljs-keyword">import</span> &#123;<span class="hljs-title class_">CSS2LabelRenderer</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;CSS2DRenderer.js&#x27;</span><br>render.<span class="hljs-title function_">render</span>(scene,camera)<br><span class="hljs-title class_">CSS2LabelRenderer</span>.<span class="hljs-title function_">render</span>(scene,camera)<br></code></pre></td></tr></table></figure>
        </div>
    </article>
    <div class="w300 m-l-15 fixed-item-right">
        <div class="hot-list">
    <div class="f14 hot-list-title">推荐阅读</div>
    <ul>
        
            <li>
                <a href="/2023/05/31/js-%E8%BD%A6%E7%89%8C%E9%94%AE%E7%9B%98.html">js车牌键盘</a>
                <p>2023-05-31</p>
            </li>
        
            <li>
                <a href="/2023/06/01/64%E8%A7%A3%E5%8D%A6.html">64解卦</a>
                <p>2023-06-01</p>
            </li>
        
            <li>
                <a href="/2023/05/15/linux-%E4%BF%AE%E6%94%B9ssh%E7%AB%AF%E5%8F%A3%E5%8F%B7.html">linux修改ssh端口号</a>
                <p>2023-05-15</p>
            </li>
        
            <li>
                <a href="/2023/03/24/node%E6%89%A7%E8%A1%8Ccmd%E5%91%BD%E4%BB%A4%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98.html">node执行cmd命令乱码问题</a>
                <p>2023-03-24</p>
            </li>
        
            <li>
                <a href="/2023/02/14/js-%E6%89%8B%E6%9C%BA%E6%91%87%E4%B8%80%E6%91%87.html">手机摇一摇</a>
                <p>2023-02-14</p>
            </li>
        
    </ul>
    <!-- <ul>
        
            <li>
                <a href="/2023/05/31/js-%E8%BD%A6%E7%89%8C%E9%94%AE%E7%9B%98.html">js车牌键盘</a>
                <p>2023-05-31</p>
            </li>
        
            <li>
                <a href="/2023/06/01/64%E8%A7%A3%E5%8D%A6.html">64解卦</a>
                <p>2023-06-01</p>
            </li>
        
            <li>
                <a href="/2023/05/15/linux-%E4%BF%AE%E6%94%B9ssh%E7%AB%AF%E5%8F%A3%E5%8F%B7.html">linux修改ssh端口号</a>
                <p>2023-05-15</p>
            </li>
        
            <li>
                <a href="/2023/03/24/node%E6%89%A7%E8%A1%8Ccmd%E5%91%BD%E4%BB%A4%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98.html">node执行cmd命令乱码问题</a>
                <p>2023-03-24</p>
            </li>
        
            <li>
                <a href="/2023/02/14/js-%E6%89%8B%E6%9C%BA%E6%91%87%E4%B8%80%E6%91%87.html">手机摇一摇</a>
                <p>2023-02-14</p>
            </li>
        
    </ul> -->
</div>
        <div class="m-t-15"></div>
        <div class="tag-list">
    <div class="f14 tag-list-title">标签列表</div>
    <div class="flex flex-wrap flex-jus-start flex-item-start tag-list-content">
        
            <a href="/tag/%E7%BD%91%E8%B5%9A/">网赚(7)</a>
        
            <a href="/tag/ai/">AI(7)</a>
        
            <a href="/tag/%E7%8E%84%E5%AD%A6/">玄学(2)</a>
        
            <a href="/tag/chatgpt/">chatgpt(2)</a>
        
            <a href="/tag/js/">js(184)</a>
        
            <a href="/tag/ffmpeg/">ffmpeg(11)</a>
        
            <a href="/tag/hexo/">Hexo(5)</a>
        
            <a href="/tag/canvas/">canvas(5)</a>
        
            <a href="/tag/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库(12)</a>
        
            <a href="/tag/paddledetection/">PaddleDetection(4)</a>
        
            <a href="/tag/stablediffusion/">StableDiffusion(6)</a>
        
            <a href="/tag/linux/">linux(24)</a>
        
            <a href="/tag/ajax/">ajax(1)</a>
        
            <a href="/tag/astro/">astro(3)</a>
        
            <a href="/tag/axios/">axios(2)</a>
        
            <a href="/tag/bat/">bat(9)</a>
        
            <a href="/tag/%E6%BF%80%E6%B4%BB%E7%A0%81/">激活码(2)</a>
        
            <a href="/tag/node/">node(59)</a>
        
            <a href="/tag/css/">css(19)</a>
        
            <a href="/tag/dns/">dns(7)</a>
        
            <a href="/tag/go/">go(59)</a>
        
            <a href="/tag/docker/">docker(1)</a>
        
            <a href="/tag/echarts/">echarts(2)</a>
        
            <a href="/tag/charts/">charts(1)</a>
        
            <a href="/tag/electron/">electron(1)</a>
        
            <a href="/tag/git/">git(2)</a>
        
            <a href="/tag/vps/">vps(9)</a>
        
            <a href="/tag/html/">html(7)</a>
        
            <a href="/tag/%E7%A7%BB%E5%8A%A8%E7%AB%AF/">移动端(11)</a>
        
            <a href="/tag/vue/">vue(40)</a>
        
            <a href="/tag/jquery/">jquery(7)</a>
        
            <a href="/tag/video/">video(2)</a>
        
            <a href="/tag/typescript/">typescript(4)</a>
        
            <a href="/tag/websocket/">websocket(5)</a>
        
            <a href="/tag/%E5%BE%AE%E4%BF%A1/">微信(5)</a>
        
            <a href="/tag/php/">php(14)</a>
        
            <a href="/tag/ios/">ios(2)</a>
        
            <a href="/tag/koa2/">koa2(14)</a>
        
            <a href="/tag/%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86/">视频处理(4)</a>
        
            <a href="/tag/%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83/">测试环境(1)</a>
        
            <a href="/tag/%E7%BC%96%E8%BE%91%E5%99%A8/">编辑器(1)</a>
        
            <a href="/tag/markdown/">markdown(1)</a>
        
            <a href="/tag/sql/">sql(1)</a>
        
            <a href="/tag/nginx/">nginx(2)</a>
        
            <a href="/tag/vue3/">vue3(1)</a>
        
            <a href="/tag/express/">express(2)</a>
        
            <a href="/tag/mysql/">mysql(2)</a>
        
            <a href="/tag/npm/">npm(2)</a>
        
            <a href="/tag/ocr/">ocr(1)</a>
        
            <a href="/tag/%E5%9B%BD%E5%AD%A6/">国学(9)</a>
        
            <a href="/tag/%E7%88%AC%E8%99%AB/">爬虫(20)</a>
        
            <a href="/tag/cmd/">cmd(1)</a>
        
            <a href="/tag/nuxt/">nuxt(3)</a>
        
            <a href="/tag/ai/">ai(1)</a>
        
            <a href="/tag/ps/">PS(2)</a>
        
            <a href="/tag/pm2/">pm2(1)</a>
        
            <a href="/tag/python/">python(17)</a>
        
            <a href="/tag/react/">react(4)</a>
        
            <a href="/tag/svg/">svg(2)</a>
        
            <a href="/tag/threejs/">threejs(2)</a>
        
            <a href="/tag/tvbox/">tvbox(1)</a>
        
            <a href="/tag/unity/">unity(1)</a>
        
            <a href="/tag/demo/">Demo(1)</a>
        
            <a href="/tag/%E5%AE%B9%E5%99%A8/">容器(2)</a>
        
            <a href="/tag/vscode/">vscode(1)</a>
        
            <a href="/tag/pinia/">pinia(1)</a>
        
            <a href="/tag/vue-router/">vue-router(1)</a>
        
            <a href="/tag/vuex/">vuex(1)</a>
        
            <a href="/tag/webpack/">webpack(2)</a>
        
            <a href="/tag/%E4%B8%AD%E5%8C%BB/">中医(15)</a>
        
            <a href="/tag/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1/">企业微信(1)</a>
        
            <a href="/tag/%E5%85%B6%E4%BB%96/">其他(7)</a>
        
            <a href="/tag/emoji/">emoji(4)</a>
        
            <a href="/tag/%E7%BE%8E%E9%A3%9F/">美食(6)</a>
        
            <a href="/tag/%E5%89%8D%E7%AB%AF/">前端(2)</a>
        
            <a href="/tag/%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86/">加密解密(2)</a>
        
            <a href="/tag/%E5%85%B5%E6%B3%95/">兵法(3)</a>
        
            <a href="/tag/%E6%B1%89%E5%AD%97/">汉字(3)</a>
        
            <a href="/tag/%E6%91%A9%E6%89%98%E8%BD%A6/">摩托车(1)</a>
        
            <a href="/tag/%E5%B0%8F%E7%9A%AE/">小皮(1)</a>
        
            <a href="/tag/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/">微信小程序(1)</a>
        
            <a href="/tag/date/">Date(1)</a>
        
            <a href="/tag/cookie/">cookie(1)</a>
        
            <a href="/tag/localstorage/">localStorage(1)</a>
        
            <a href="/tag/indexdb/">indexDB(1)</a>
        
            <a href="/tag/%E6%A8%A1%E6%9D%BF/">模板(1)</a>
        
            <a href="/tag/json/">json(1)</a>
        
            <a href="/tag/%E8%AF%BB%E4%B9%A6%E4%BC%9A/">读书会(1)</a>
        
            <a href="/tag/%E5%B0%8F%E5%90%83/">小吃(1)</a>
        
            <a href="/tag/%E5%87%8F%E8%82%A5/">减肥(1)</a>
        
    </div>
</div>


    </div>
</div>
<script>
    function addCopyButtons() {
        // 获取所有代码块
        const codeBlocks = document.querySelectorAll('pre code');
        
        codeBlocks.forEach((codeBlock) => {
            // 创建复制按钮
            const copyButton = document.createElement('i');
            copyButton.className = 'copy-button fa fa-copy';
            
            // 查找最近的 .highlight 父元素
            const highlightBlock = codeBlock.closest('.highlight');
            if (highlightBlock) {
                highlightBlock.insertBefore(copyButton, highlightBlock.firstChild);
            }
            
            // 添加点击事件
            copyButton.addEventListener('click', () => {
                // 获取格式化的代码内容
                const code = codeBlock.innerText || codeBlock.textContent;
                
                // 使用 textarea 来保持文本格式
                const textarea = document.createElement('textarea');
                textarea.value = code;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    // 尝试使用新的 API
                    navigator.clipboard.writeText(code).then(() => {
                        copyButton.className = 'copy-button fa fa-check';
                        setTimeout(() => {
                            copyButton.className = 'copy-button fa fa-copy';
                        }, 2000);
                    });
                } catch (err) {
                    // 降级方案：使用 document.execCommand
                    document.execCommand('copy');
                    copyButton.className = 'copy-button fa fa-check';
                    setTimeout(() => {
                        copyButton.className = 'copy-button fa fa-copy';
                    }, 2000);
                }
                
                // 清理临时元素
                document.body.removeChild(textarea);
            });
        });
    }
    // 页面加载完成后添加复制按钮
document.addEventListener('DOMContentLoaded', addCopyButtons);

</script>
    </div>
    <footer>
    <div>
        copyright © 2024 Gary Wang 
    </div>
</footer>
    <div class="search-page animated">
    <div class="search-page-content">
        <i class="fa fa-times search-close"></i>
        <h1>内容搜索</h1>
        <form onsubmit="formSubmit(event)" class="search-page-form re">
            <input type="text" placeholder="查找" name="keyword" id="search-input" autocomplete="off">
            <button>
                <i class="fa fa-search"></i>
            </button>
        </form>
        <div class="search-page-result" id="search-result">
        </div>
    </div>
    <div class="search-page-bg"></div>
</div>
<script>
    //所有搜索数据
    let searchData = [];
    
    // 加载搜索数据
    fetch('/search.xml')
        .then(response => response.text())
        .then(str => new window.DOMParser().parseFromString(str, "text/xml"))
        .then(data => {
            searchData = Array.from(data.getElementsByTagName('entry')).map(entry => ({
                title: entry.getElementsByTagName('title')[0].textContent,
                content: entry.getElementsByTagName('content')[0].textContent,
                url: entry.getElementsByTagName('url')[0].textContent
            }));
        });

    // 搜索功能实现
    function formSubmit(event) {
        event.preventDefault();
        // 搜索关键词
        const keyword = document.getElementById('search-input').value.toLowerCase();
        // 搜索结果
        const results = searchData.filter(item => 
            item.title.toLowerCase().includes(keyword) || item.content.toLowerCase().includes(keyword)
        );
        const resultDiv = document.getElementById('search-result');
        if(results.length === 0 || keyword === ''){
            resultDiv.innerHTML = '<div class="search-page-result-item t-c f13">没有找到相关内容</div>';
        }else{
            resultDiv.innerHTML = results.map(item => `
                <div class="search-page-result-item">
                    <a href="${item.url}">
                        <h5>${item.title}</h5>
                    </a>
                </div>
            `).join('');
        }
    }
    document.querySelector('.search-close').addEventListener('click',function(){
        hideSearchPage()
    })
</script>
    <!-- <div class="gotopage" id="gotopage">
        <i class="far fa-arrow-alt-circle-up"></i>
    </div> -->
    <script src="/assets/js/common.js"></script>
    <script src="/assets/js/func.js"></script>
    <script src="/assets/live2dw/lib/L2Dwidget.js"></script>
    <script>
        // 加载动画
        window.addEventListener('DOMContentLoaded',function(){
            setTimeout(function() {
                document.querySelector('.loading').style.display = 'none';
            },800)
        },false)
        
        /* 看板娘 */
        L2Dwidget.init({
            "pluginRootPath"  : "/assets/live2dw/",
            "pluginJsPath"	  : "/assets/live2dw/lib/",
            "pluginModelPath" : "/assets/live2dw/assets/",
            "tagMode"		  : false,
            "debug"			  : false,
            "model"			  : {
                "jsonPath" : "/assets/live2dw/assets/kesshouban.model.json"
            },
            "display" : {
                "position" : "right",
                "width"	   : 250,
                "height"   : 250,
                "hOffset"  : -70,
                "vOffset"  : 60
            },
            "dialog"	: {
                "enable" : true
            },
            "mobile"	: {
                "show" : true
            },
            "react"		: {
                "opacity" : 1
            },
            "log" : false
        });
        const addEvent = function(){
            const live2dWidget = document.getElementById('live2d-widget')
            setTimeout(function(){
                if(live2dWidget){
                    live2dWidget.addEventListener('click',function(e){
                        document.querySelector('.main').scrollTo({
                            top: 0,
                            behavior: 'smooth'
                        });
                    })
                }else{
                    addEvent()
                }
            },1000)
        }
        addEvent()
    </script>
    <!-- Cloudflare Web Analytics -->
    <!-- <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "5bd3afcce7474fcdbf639fab1999e804"}'></script> -->
    <!-- End Cloudflare Web Analytics -->
    <!-- <script src='//unpkg.com/@waline/client/dist/waline.js'></script>
    <link href='//unpkg.com/@waline/client/dist/waline.css' rel='stylesheet'/> -->
</body>
</html>