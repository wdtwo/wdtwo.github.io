<!DOCTYPE html>
<html lang="zh-cn">
<head>
    	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<meta name="author" content="GaryWang">
	<meta name='renderer' content='webkit'>
	<meta http-equiv='X-UA-Compatible' content='IE=Edge,chrome=1' >
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="format-detection" content="telephone=no">
	<meta name="format-detection" content="email=no">
    <title>WDTWO Blog</title>
	<link href="/assets/css/style.css" rel="stylesheet" type="text/css">
	<link href="/assets/css/animate.css" rel="stylesheet" type="text/css">
	<link href="/assets/fontawesome-free-5.15.4-web/css/all.min.css" rel="stylesheet" type="text/css">
    
<meta name="generator" content="Hexo 7.3.0"></head>
<body class="light">

    <div class="loading flex">
        <div></div>
    </div>

    <!-- 调试信息 -->
    <!-- 
        <div style="background: #f0f0f0; padding: 10px; margin: 10px;">
            页面类型: post<br>
            页面路径: 2023/04/13/golang-gin框架使用.html<br>
            是否为文章页: true<br>
            是否为首页: false
        </div>
     -->
    <header class="flex flex-jus-between">
    <h1 class="header-title">
        <a href="/" class="header-title">
            WDTWO Blog
        </a>
    </h1>
    <div class="flex">
        <div class="menu-list animated">
            
                <a class="menu-item" href="/archives">目录</a>
            
                <a class="menu-item" href="/category">分类</a>
            
                <a class="menu-item" href="/tag">标签</a>
            
                <a class="menu-item" href="/static/mark/index.html">书签</a>
            
            <i class="fa fa-times mobile-close-menu"></i>
        </div>
        <i class="fa fa-search"></i>
        <i class="fa fa-bars mobile-menu"></i>
        <i class="fa fa-sun"></i>
        <i class="fa fa-moon"></i>
    </div>
</header>

<script>
    window.addEventListener('DOMContentLoaded',function(){
        // 搜索按钮点击事件
        document.querySelector('.fa-search').addEventListener('click',function(){
            showSearchPage()
        })
        document.querySelector('.search-page-bg').addEventListener('click',function(){
            hideSearchPage()
        })  
        // 显示菜单
        document.querySelector('.mobile-menu').addEventListener('click',function(){
            showMobileMenu()
        })
        document.querySelector('.mobile-close-menu').addEventListener('click',function(){
            hideMobileMenu()
        })
    })
</script>
    <div class="main">
        <!-- 添加 highlight.js 的样式 -->
<link rel="stylesheet" href="/assets/css/atom-one-dark-reasonable.css">
<link rel="stylesheet" href="/assets/css/markdown.css">
<div class="post-box flex flex-item-start">
    <article class="post">
    
        <h1 class="post-title t-c">gin框架使用</h1>
        <div class="post-meta t-c flex">
            <!-- 作者 -->
            <div>
                <i class="fa fa-user c-purple"></i>
                Gary Wang
             </div>
            <div>
                <i class="fa fa-calendar c-orange"></i>
                2023-04-13
            </div>
            
                <div>
                    <i class="fa fa-folder c-yellow"></i>
                    <a class="archive-item-category-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a>
                </div>
            
            
                <div>
                    <i class="fa fa-tags c-green"></i>
                    <a class="archive-item-tag-none-link" href="/tag/go/" rel="tag">go</a>
                </div>
            
        </div>
        <hr class="line">
        <div class="post-content">
            <ul>
<li>安装</li>
<li>路由配置</li>
<li>路由参数</li>
<li>表单参数</li>
<li>文件上传</li>
<li>routes group分组管理</li>
<li>404页面配置</li>
<li>数据格式响应</li>
<li>模板渲染</li>
<li>静态资源引入</li>
<li>重定向</li>
<li>同步异步</li>
<li>中间件</li>
<li>会话控制(cookie session)</li>
<li>其他</li>
</ul>
<span id="more"></span>

<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h4 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">go get -u github.com/gin-gonic/gin<br></code></pre></td></tr></table></figure>
<h4 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">import <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br></code></pre></td></tr></table></figure>
<h4 id="可选-如果需要http-StatusOK之类的常量"><a href="#可选-如果需要http-StatusOK之类的常量" class="headerlink" title="可选 如果需要http.StatusOK之类的常量"></a>可选 如果需要http.StatusOK之类的常量</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">import <span class="hljs-string">&quot;net/http&quot;</span><br></code></pre></td></tr></table></figure>

<h4 id="基本路由"><a href="#基本路由" class="headerlink" title="基本路由"></a>基本路由</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    router := gin.Default()<br>    router.GET(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.String(http.StatusOK, <span class="hljs-string">&quot;hello world&quot;</span>)<br>    &#125;)<br>    router.POST(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.String(http.StatusOK, <span class="hljs-string">&quot;post datas&quot;</span>)<br>    &#125;)<br>    router.PUT(<span class="hljs-string">&quot;/put&quot;</span>)<br>    router.Run(<span class="hljs-string">&quot;:8080&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">go run main.go<br></code></pre></td></tr></table></figure>

<h4 id="API参数路由"><a href="#API参数路由" class="headerlink" title="API参数路由"></a>API参数路由</h4><ul>
<li>可以通过Context的Param方法来获取API参数</li>
<li>localhost:8000&#x2F;xxx&#x2F;zhangsan</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;strings&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    router := gin.Default()<br>    router.GET(<span class="hljs-string">&quot;user/:name/*action&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        name := ctx.Param(<span class="hljs-string">&quot;name&quot;</span>)<br>        action := ctx.Param(<span class="hljs-string">&quot;action&quot;</span>)<br>        action = strings.Trim(action, <span class="hljs-string">&quot;/&quot;</span>)<br>        ctx.String(http.StatusOK, name+<span class="hljs-string">&quot;is&quot;</span>+action)<br>    &#125;)<br>    router.Run()<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="url参数路由"><a href="#url参数路由" class="headerlink" title="url参数路由"></a>url参数路由</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    router := gin.Default()<br>    router.GET(<span class="hljs-string">&quot;/user&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        name := ctx.DefaultQuery(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;默认值&quot;</span>)<br>        ctx.String(http.StatusOK, fmt.Sprintf(<span class="hljs-string">&quot;hello %s&quot;</span>, name))<br>    &#125;)<br>    router.Run()<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://localhost:8080/user<br>默认值<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://localhost:8080/user?name=abc<br>abc<br></code></pre></td></tr></table></figure>
<h4 id="表单参数"><a href="#表单参数" class="headerlink" title="表单参数"></a>表单参数</h4><ol>
<li>表单传输为post请求，http常见的传输格式为四种：</li>
</ol>
<ul>
<li>application&#x2F;json</li>
<li>application&#x2F;x-www-form-urlencoded</li>
<li>application&#x2F;xml</li>
<li>multipart&#x2F;form-data</li>
</ul>
<ol start="2">
<li>表单参数可以通过<code>PostForm()</code>方法获取，该方法默认解析的是<code>x-www-form-urlencoded</code>或<code>from-data</code>格式的参数</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    router := gin.Default()<br>    router.LoadHTMLFiles(<span class="hljs-string">&quot;template/formview.html&quot;</span>)<br>    router.GET(<span class="hljs-string">&quot;/index&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.HTML(http.StatusOK, <span class="hljs-string">&quot;formview.html&quot;</span>, gin.H&#123;<br>            <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;index pages&quot;</span>,<br>        &#125;)<br>    &#125;)<br>    router.POST(<span class="hljs-string">&quot;/form&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        types := ctx.DefaultPostForm(<span class="hljs-string">&quot;type&quot;</span>, <span class="hljs-string">&quot;post&quot;</span>)<br>        username := ctx.PostForm(<span class="hljs-string">&quot;username&quot;</span>)<br>        password := ctx.PostForm(<span class="hljs-string">&quot;password&quot;</span>)<br>        ctx.String(http.StatusOK, fmt.Sprintf(<span class="hljs-string">&quot;username:%s,password:%s,type:%s&quot;</span>, username, password, types))<br>    &#125;)<br>    router.Run()<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/form&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> &gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;用户名&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;密码&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;提交&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>方法2 接收数据并判断</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-comment">//定义接收数据的结构体</span><br><span class="hljs-keyword">type</span> Login <span class="hljs-keyword">struct</span> &#123;<br>    <span class="hljs-comment">//binding修饰的字段 若接收的空值则会报错</span><br>    User     <span class="hljs-type">string</span> <span class="hljs-string">`form:&quot;username&quot; json:&quot;username&quot; uri:&quot;username&quot; xml:&quot;username&quot; binding:&quot;required&quot;`</span><br>    Password <span class="hljs-type">string</span> <span class="hljs-string">`form:&quot;password&quot; json:&quot;password&quot; uri:&quot;password&quot; xml:&quot;password&quot; binding:&quot;required&quot;`</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    r := gin.Default()<br>    r.LoadHTMLFiles(<span class="hljs-string">&quot;template/formview.html&quot;</span>)<br>    r.GET(<span class="hljs-string">&quot;/form&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.HTML(http.StatusOK, <span class="hljs-string">&quot;formview.html&quot;</span>, gin.H&#123;<br>            <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;formview page&quot;</span>,<br>        &#125;)<br>    &#125;)<br>    r.POST(<span class="hljs-string">&quot;/formdata&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        <span class="hljs-comment">//接收变量</span><br>        <span class="hljs-keyword">var</span> form Login<br>        <span class="hljs-comment">//Bind()默认解析并绑定form格式</span><br>        <span class="hljs-comment">//根据请求头中content-type自动推断</span><br>        <span class="hljs-keyword">if</span> err := ctx.Bind(&amp;form); err != <span class="hljs-literal">nil</span> &#123;<br>            ctx.JSON(http.StatusBadRequest, gin.H&#123;<span class="hljs-string">&quot;error&quot;</span>: err.Error()&#125;)<br>            <span class="hljs-keyword">return</span><br>        &#125;<br>        <span class="hljs-keyword">if</span> form.User != <span class="hljs-string">&quot;admin&quot;</span> || form.Password != <span class="hljs-string">&quot;123456&quot;</span> &#123;<br>            ctx.JSON(http.StatusBadRequest, gin.H&#123;<span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;用户名或密码错误&quot;</span>&#125;)<br>            <span class="hljs-keyword">return</span><br>        &#125;<br>        ctx.String(http.StatusOK, fmt.Sprintf(<span class="hljs-string">&quot;%v -- %v&quot;</span>, ctx.PostForm(<span class="hljs-string">&quot;username&quot;</span>), ctx.PostForm(<span class="hljs-string">&quot;password&quot;</span>)))<br>    &#125;)<br>    r.Run()<br>&#125;<br></code></pre></td></tr></table></figure>








<h4 id="单文件上传"><a href="#单文件上传" class="headerlink" title="单文件上传"></a>单文件上传</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    router := gin.Default()<br>    <span class="hljs-comment">//上传文件静态页面路由</span><br>    router.LoadHTMLFiles(<span class="hljs-string">&quot;template/formview.html&quot;</span>)<br>    router.GET(<span class="hljs-string">&quot;/form&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.HTML(http.StatusOK, <span class="hljs-string">&quot;formview.html&quot;</span>, gin.H&#123;&#125;)<br>    &#125;)<br>    <span class="hljs-comment">//限制上传最大尺寸</span><br>    <span class="hljs-comment">//限制表单大小为8M 默认为32M</span><br>    router.MaxMultipartMemory = <span class="hljs-number">8</span> &lt;&lt; <span class="hljs-number">20</span><br>    router.POST(<span class="hljs-string">&quot;/upload&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        file, err := ctx.FormFile(<span class="hljs-string">&quot;file&quot;</span>)<br>        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>            ctx.String(<span class="hljs-number">500</span>, <span class="hljs-string">&quot;上传图片出错&quot;</span>)<br>        &#125;<br>        <span class="hljs-comment">// 	ctx.JSON(200, gin.H&#123;&quot;message&quot;: file.Filename&#125;)</span><br>        ctx.SaveUploadedFile(file, <span class="hljs-string">&quot;uploads/&quot;</span>+file.Filename)<br>        ctx.String(http.StatusOK, <span class="hljs-string">&quot;uploads/&quot;</span>+file.Filename)<br>    &#125;)<br>    router.Run()<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="上传指定类型文件"><a href="#上传指定类型文件" class="headerlink" title="上传指定类型文件"></a>上传指定类型文件</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    router := gin.Default()<br>    router.LoadHTMLFiles(<span class="hljs-string">&quot;template/formview.html&quot;</span>)<br>    router.GET(<span class="hljs-string">&quot;/form&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.HTML(http.StatusOK, <span class="hljs-string">&quot;formview.html&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br>    &#125;)<br>    router.POST(<span class="hljs-string">&quot;/upload&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        _, headers, err := ctx.Request.FormFile(<span class="hljs-string">&quot;file&quot;</span>)<br>        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>            log.Printf(<span class="hljs-string">&quot;error:%v&quot;</span>, err)<br>        &#125;<br>        <span class="hljs-comment">//判断文件大小</span><br>        <span class="hljs-keyword">if</span> headers.Size &gt; <span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">2</span> &#123;<br>            ctx.String(<span class="hljs-number">500</span>, <span class="hljs-string">&quot;文件太大了&quot;</span>)<br>            <span class="hljs-keyword">return</span><br>        &#125;<br>        <span class="hljs-comment">//获取上传文件类型</span><br>        <span class="hljs-keyword">if</span> headers.Header.Get(<span class="hljs-string">&quot;content-Type&quot;</span>) != <span class="hljs-string">&quot;image/png&quot;</span> &#123;<br>            ctx.String(<span class="hljs-number">500</span>, <span class="hljs-string">&quot;文件类型不正确&quot;</span>)<br>            <span class="hljs-keyword">return</span><br>        &#125;<br>        ctx.SaveUploadedFile(headers, <span class="hljs-string">&quot;uploads/&quot;</span>+headers.Filename)<br>        ctx.String(http.StatusOK, headers.Filename)<br>    &#125;)<br>    router.Run()<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="上传多个文件"><a href="#上传多个文件" class="headerlink" title="上传多个文件"></a>上传多个文件</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    router := gin.Default()<br>    <span class="hljs-comment">//限制表单大小为8M 默认为32M</span><br>    router.MaxMultipartMemory = <span class="hljs-number">8</span> &lt;&lt; <span class="hljs-number">20</span><br>    router.LoadHTMLFiles(<span class="hljs-string">&quot;template/formview.html&quot;</span>)<br>    router.GET(<span class="hljs-string">&quot;/form&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.HTML(http.StatusOK, <span class="hljs-string">&quot;formview.html&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br>    &#125;)<br>    router.POST(<span class="hljs-string">&quot;/upload&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        form, err := ctx.MultipartForm()<br>        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>            ctx.String(http.StatusBadRequest, fmt.Sprintf(<span class="hljs-string">&quot;error:%s&quot;</span>, err.Error()))<br>        &#125;<br>        <span class="hljs-comment">//获取所有图片</span><br>        files := form.File[<span class="hljs-string">&quot;files&quot;</span>]<br>        <span class="hljs-comment">//遍历所有图片</span><br>        <span class="hljs-keyword">for</span> _, file := <span class="hljs-keyword">range</span> files &#123;<br>            <span class="hljs-comment">//逐个保存</span><br>            <span class="hljs-keyword">if</span> err := ctx.SaveUploadedFile(file, <span class="hljs-string">&quot;uploads/&quot;</span>+file.Filename); err != <span class="hljs-literal">nil</span> &#123;<br>                ctx.String(http.StatusBadRequest, fmt.Sprintf(<span class="hljs-string">&quot;upload error:%s&quot;</span>, err.Error()))<br>                <span class="hljs-keyword">return</span><br>            &#125;<br>        &#125;<br>        ctx.String(<span class="hljs-number">200</span>, fmt.Sprintf(<span class="hljs-string">&quot;uploads ok %d&quot;</span>, <span class="hljs-built_in">len</span>(files)))<br>    &#125;)<br>    router.Run()<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="routes-group-管理相同的url"><a href="#routes-group-管理相同的url" class="headerlink" title="routes group 管理相同的url"></a>routes group 管理相同的url</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    router := gin.Default()<br>    <span class="hljs-comment">//路由1 处理get请求</span><br>    v1 := router.Group(<span class="hljs-string">&quot;/v1&quot;</span>)<br>    <span class="hljs-comment">//&#123;&#125;书写规则</span><br>    &#123;<br>        v1.GET(<span class="hljs-string">&quot;/login&quot;</span>, login)<br>        v1.GET(<span class="hljs-string">&quot;/submit&quot;</span>, submit)<br>    &#125;<br>    v2 := router.Group(<span class="hljs-string">&quot;/v2&quot;</span>)<br>    &#123;<br>        v2.POST(<span class="hljs-string">&quot;/login&quot;</span>, login)<br>        v2.POST(<span class="hljs-string">&quot;/submit&quot;</span>, submit)<br>    &#125;<br>    router.Run()<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">login</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>    name := ctx.DefaultQuery(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;张三&quot;</span>)<br>    ctx.String(<span class="hljs-number">200</span>, fmt.Sprintf(<span class="hljs-string">&quot;hello %s\n&quot;</span>, name))<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">submit</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>    name := ctx.DefaultQuery(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;李四&quot;</span>)<br>    ctx.String(<span class="hljs-number">200</span>, fmt.Sprintf(<span class="hljs-string">&quot;hello %s\n&quot;</span>, name))<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="404页面"><a href="#404页面" class="headerlink" title="404页面"></a>404页面</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    router := gin.Default()<br>    router.GET(<span class="hljs-string">&quot;/user&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        name := ctx.DefaultQuery(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;garywang&quot;</span>)<br>        ctx.String(http.StatusOK, fmt.Sprintf(<span class="hljs-string">&quot;%v&quot;</span>, name))<br>    &#125;)<br>    router.NoRoute(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.String(http.StatusNotFound, <span class="hljs-string">&quot;404 not found!!!&quot;</span>)<br>    &#125;)<br>    router.Run()<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="json数据解析和绑定"><a href="#json数据解析和绑定" class="headerlink" title="json数据解析和绑定"></a>json数据解析和绑定</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-comment">// 定义接收数据的结构体</span><br><span class="hljs-keyword">type</span> Login <span class="hljs-keyword">struct</span> &#123;<br>    <span class="hljs-comment">//binding:&quot;required&quot;修饰字段 若接收为空值,则报错,是必须字段</span><br>    User    <span class="hljs-type">string</span> <span class="hljs-string">`form:&quot;username&quot; json:&quot;username&quot; uri:&quot;username&quot; xml:&quot;username&quot; binding:&quot;required&quot;`</span><br>    Pssword <span class="hljs-type">string</span> <span class="hljs-string">`form:&quot;password&quot; json:&quot;password&quot; uri:&quot;password&quot; xml:&quot;password&quot; binding:&quot;required&quot;`</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    r := gin.Default()<br>    r.POST(<span class="hljs-string">&quot;/post&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>        <span class="hljs-keyword">var</span> json Login<br>        fmt.Println(json)<br>        err := c.ShouldBindJSON(&amp;json)<br>        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>            c.JSON(http.StatusBadRequest, gin.H&#123;<span class="hljs-string">&quot;status&quot;</span>: err.Error()&#125;)<br>            <span class="hljs-keyword">return</span><br>        &#125;<br>        <span class="hljs-keyword">if</span> json.User != <span class="hljs-string">&quot;root&quot;</span> || json.Pssword != <span class="hljs-string">&quot;admin&quot;</span> &#123;<br>            c.JSON(http.StatusBadRequest, gin.H&#123;<span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;用户名或密码错误&quot;</span>&#125;)<br>            <span class="hljs-keyword">return</span><br>        &#125;<br>        c.JSON(http.StatusOK, gin.H&#123;<span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;200&quot;</span>&#125;)<br>    &#125;)<br>    r.Run()<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://localhost:8080/post<br>自定义格式<br>application/json<br>application/xml<br>text/plain<br>&#123;<br>    <span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;root&quot;</span>,<br>    <span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="各种数据格式的响应"><a href="#各种数据格式的响应" class="headerlink" title="各种数据格式的响应"></a>各种数据格式的响应</h4><p>json 结构体 XML YAML protobuf</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>    <span class="hljs-comment">//方法5需要使用</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin/testdata/protoexample&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    r := gin.Default()<br>    <span class="hljs-comment">//1.json</span><br>    r.GET(<span class="hljs-string">&quot;/json&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.JSON(http.StatusOK, gin.H&#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;200&quot;</span>&#125;)<br>    &#125;)<br>    <span class="hljs-comment">//2.结构体</span><br>    r.GET(<span class="hljs-string">&quot;/struct&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        <span class="hljs-keyword">var</span> msg <span class="hljs-keyword">struct</span> &#123;<br>            Name    <span class="hljs-type">string</span><br>            Message <span class="hljs-type">string</span><br>            Number  <span class="hljs-type">int</span><br>        &#125;<br>        msg.Name = <span class="hljs-string">&quot;garywang&quot;</span><br>        msg.Message = <span class="hljs-string">&quot;msg&quot;</span><br>        msg.Number = <span class="hljs-number">66</span><br>        ctx.JSON(<span class="hljs-number">200</span>, msg)<br>    &#125;)<br>    <span class="hljs-comment">//3.XML</span><br>    r.GET(<span class="hljs-string">&quot;/xml&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.XML(<span class="hljs-number">200</span>, gin.H&#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-number">666</span>&#125;)<br>    &#125;)<br>    <span class="hljs-comment">//4.yaml</span><br>    r.GET(<span class="hljs-string">&quot;/yaml&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.YAML(<span class="hljs-number">200</span>, gin.H&#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;yaml&quot;</span>&#125;)<br>    &#125;)<br>    <span class="hljs-comment">//5.protobuf格式,谷歌开发的高效存储读取的工具</span><br>    <span class="hljs-comment">//不理解</span><br>    r.GET(<span class="hljs-string">&quot;/protobuf&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        reps := []<span class="hljs-type">int64</span>&#123;<span class="hljs-type">int64</span>(<span class="hljs-number">1</span>), <span class="hljs-type">int64</span>(<span class="hljs-number">2</span>)&#125;<br>        label := <span class="hljs-string">&quot;label&quot;</span><br>        data := &amp;protoexample.Test&#123;<br>            Label: &amp;label,<br>            Reps:  reps,<br>        &#125;<br>        ctx.ProtoBuf(<span class="hljs-number">200</span>, data)<br>    &#125;)<br>    r.Run()<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="HTML模板渲染"><a href="#HTML模板渲染" class="headerlink" title="HTML模板渲染"></a>HTML模板渲染</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    router := gin.Default()<br>    router.LoadHTMLGlob(<span class="hljs-string">&quot;template/*&quot;</span>)<br>    <span class="hljs-comment">//router.LoadHTMLFiles(&quot;template/template1.html&quot;, &quot;template/template2.html&quot;)</span><br>    router.GET(<span class="hljs-string">&quot;/index&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.HTML(http.StatusOK, <span class="hljs-string">&quot;index.html&quot;</span>, gin.H&#123;<br>            <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;website&quot;</span>,<br>        &#125;)<br>    &#125;)<br>    router.Run(<span class="hljs-string">&quot;:8081&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><br>        &#123;&#123; .title &#125;&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h4 id="不同目录下相同模板"><a href="#不同目录下相同模板" class="headerlink" title="不同目录下相同模板"></a>不同目录下相同模板</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    router := gin.Default()<br>    router.LoadHTMLGlob(<span class="hljs-string">&quot;template/**/*&quot;</span>)<br>    router.GET(<span class="hljs-string">&quot;/post/index&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.HTML(http.StatusOK, <span class="hljs-string">&quot;index.html&quot;</span>, gin.H&#123;<br>            <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;Posts&quot;</span>,<br>        &#125;)<br>    &#125;)<br>    router.GET(<span class="hljs-string">&quot;/user/index&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.HTML(http.StatusOK, <span class="hljs-string">&quot;index.html&quot;</span>, gin.H&#123;<br>            <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;users&quot;</span>,<br>        &#125;)<br>    &#125;)<br>    router.Run()<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>两层目录以后发现单层&#x2F;index目录内容是user&#x2F;index的内容,但是参数还是index的参数</strong></p>
<h4 id="引入静态文件目录"><a href="#引入静态文件目录" class="headerlink" title="引入静态文件目录"></a>引入静态文件目录</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">r.Static(<span class="hljs-string">&quot;/assets&quot;</span>, <span class="hljs-string">&quot;./assets&quot;</span>)<br></code></pre></td></tr></table></figure>


<h4 id="自定义模板渲染器"><a href="#自定义模板渲染器" class="headerlink" title="自定义模板渲染器"></a>自定义模板渲染器</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><br></code></pre></td></tr></table></figure>


<h4 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    r := gin.Default()<br>    r.GET(<span class="hljs-string">&quot;/index&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.Redirect(http.StatusMovedPermanently, <span class="hljs-string">&quot;http://www.baidu.com/&quot;</span>)<br>    &#125;)<br>    r.Run()<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="同步异步"><a href="#同步异步" class="headerlink" title="同步异步"></a>同步异步</h4><ul>
<li>goroutine机制</li>
<li>在启动新的goroutine时,不应该使用原始上下文,必须使用它的只读副本</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;time&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    r := gin.Default()<br>    <span class="hljs-comment">//异步执行</span><br>    r.GET(<span class="hljs-string">&quot;/index_async&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        copyContext := ctx.Copy()<br>        <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>            time.Sleep(<span class="hljs-number">3</span> * time.Second)<br>            log.Println(<span class="hljs-string">&quot;异步执行:&quot;</span> + copyContext.Request.URL.Path)<br>            ctx.String(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;异步执行&quot;</span>) <span class="hljs-comment">//不会返回给页面</span><br>        &#125;()<br>    &#125;)<br>    <span class="hljs-comment">//同步执行</span><br>    r.GET(<span class="hljs-string">&quot;/index&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        <span class="hljs-comment">//页面会loading3秒后显示&quot;同步执行66&quot;</span><br>        time.Sleep(<span class="hljs-number">3</span> * time.Second)<br>        log.Println(<span class="hljs-string">&quot;同步执行&quot;</span> + ctx.Request.URL.Path)<br>        ctx.String(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;同步执行66&quot;</span>)<br>    &#125;)<br>    r.Run()<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h4><p>全局中间件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;time&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    router := gin.Default()<br>    <span class="hljs-comment">//注册中间件</span><br>    router.Use(MiddleWare())<br>    <span class="hljs-comment">//&#123;&#125;为了规范使用 可以不加</span><br>    &#123;<br>        router.GET(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>            <span class="hljs-comment">//取值</span><br>            req, _ := ctx.Get(<span class="hljs-string">&quot;request&quot;</span>)<br>            fmt.Println(<span class="hljs-string">&quot;获取中间件传过来的request:&quot;</span>, req)<br>            <span class="hljs-comment">//数据发送到页面</span><br>            ctx.JSON(http.StatusOK, gin.H&#123;<span class="hljs-string">&quot;request&quot;</span>: req&#125;)<br>        &#125;)<br>    &#125;<br>    router.Run()<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">MiddleWare</span><span class="hljs-params">()</span></span> gin.HandlerFunc &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        t := time.Now()<br>        fmt.Println(<span class="hljs-string">&quot;开始执行中间件&quot;</span>)<br>        <span class="hljs-comment">//设置变量到context的key中,可以通过Get()取</span><br>        ctx.Set(<span class="hljs-string">&quot;request&quot;</span>, <span class="hljs-string">&quot;中间件&quot;</span>)<br>        status := ctx.Writer.Status()<br>        fmt.Println(<span class="hljs-string">&quot;中间件执行完成&quot;</span>, status)<br>        t2 := time.Since(t)<br>        fmt.Println(<span class="hljs-string">&quot;中间件执行所用时间:&quot;</span>, t2)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Next()方法<br>可以到Next()位置挂起中间件,执行主程序,等执行完成以后继续执行next()后面的内容</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">MiddleWare</span><span class="hljs-params">()</span></span> gin.HandlerFunc &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        t := time.Now()<br>        fmt.Println(<span class="hljs-string">&quot;开始执行中间件&quot;</span>)<br>        <span class="hljs-comment">//设置变量到context的key中,可以通过Get()取</span><br>        ctx.Set(<span class="hljs-string">&quot;request&quot;</span>, <span class="hljs-string">&quot;中间件&quot;</span>)<br>        ctx.Next()<br>        status := ctx.Writer.Status()<br>        fmt.Println(<span class="hljs-string">&quot;中间件执行完成&quot;</span>, status)<br>        t2 := time.Since(t)<br>        fmt.Println(<span class="hljs-string">&quot;中间件执行所用时间:&quot;</span>, t2)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>局部中间件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go">router.GET(<span class="hljs-string">&quot;/&quot;</span>,MiddleWare(),<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span>&#123;<br>    req,_ :=c.Get(<span class="hljs-string">&quot;request&quot;</span>)<br>    fmt.Println(<span class="hljs-string">&quot;request:&quot;</span>,req)<br>    ctx.JSON(<span class="hljs-number">200</span>,gin.H&#123;<span class="hljs-string">&quot;request&quot;</span>:req&#125;)<br>&#125;)<br></code></pre></td></tr></table></figure>
<p>中间件练习<br>创建两个页面,在同一个路由组内,命令行打印页面访问所用的时间</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;time&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    router := gin.Default()<br>    router.Use(MidGetTime())<br>    routerGroup := router.Group(<span class="hljs-string">&quot;/group&quot;</span>)<br>    &#123;<br>        routerGroup.GET(<span class="hljs-string">&quot;/a&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>            time.Sleep(<span class="hljs-number">5</span> * time.Second)<br>            data, _ := ctx.Get(<span class="hljs-string">&quot;time&quot;</span>)<br>            fmt.Println(data)<br>            ctx.JSON(<span class="hljs-number">200</span>, gin.H&#123;<span class="hljs-string">&quot;time&quot;</span>: data&#125;)<br>        &#125;)<br>        routerGroup.GET(<span class="hljs-string">&quot;/b&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>            time.Sleep(<span class="hljs-number">3</span> * time.Second)<br>            data, _ := ctx.Get(<span class="hljs-string">&quot;time&quot;</span>)<br>            fmt.Println(data)<br>            ctx.JSON(<span class="hljs-number">200</span>, gin.H&#123;<span class="hljs-string">&quot;time&quot;</span>: data&#125;)<br>        &#125;)<br>    &#125;<br>    router.Run()<br>&#125;<br><span class="hljs-comment">//中间件</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">MidGetTime</span><span class="hljs-params">()</span></span> gin.HandlerFunc &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        t := time.Now()<br>        ctx.Set(<span class="hljs-string">&quot;time&quot;</span>, time.Now())<br>        ctx.Next()<br>        t2 := time.Since(t)<br>        fmt.Println(<span class="hljs-string">&quot;中间件执行结束,耗时:&quot;</span>, t2)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="会话控制"><a href="#会话控制" class="headerlink" title="会话控制"></a>会话控制</h4><p>cookie的使用<br>测试服务端发送cookie给客户端,客户端请求时携带cookie</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    router := gin.Default()<br>    <span class="hljs-comment">//设置cookie</span><br>    router.GET(<span class="hljs-string">&quot;cookie&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        cookie, err := ctx.Cookie(<span class="hljs-string">&quot;key_cookie&quot;</span>)<br>        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>            cookie = <span class="hljs-string">&quot;没有设置cookie&quot;</span><br>            <span class="hljs-comment">//给客户端设置cookie maxAge(int)秒 cookie所在目录 domain(string)域名 secure是否智能通过https访问 httponly(bool)是否允许别人通过js获取自己的cookie</span><br>            ctx.SetCookie(<span class="hljs-string">&quot;key_cookie&quot;</span>, <span class="hljs-string">&quot;value_cookie&quot;</span>, <span class="hljs-number">60</span>, <span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>)<br>        &#125;<br>        fmt.Printf(<span class="hljs-string">&quot;cookie的值是:%s\n&quot;</span>, cookie)<br>    &#125;)<br>    router.Run()<br>&#125;<br></code></pre></td></tr></table></figure>
<p>cookie的缺点</p>
<ul>
<li>不安全,明文</li>
<li>增加带宽消耗</li>
<li>可以被禁用</li>
<li>cookie有上限</li>
</ul>
<p>cookie练习<br>模拟权限验证中间件<br>两个页面 login页面可以访问 home页面需要cookie才能访问</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;time&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    router := gin.Default()<br>    router.Use(MiddYanzheng())<br>    router.LoadHTMLFiles(<br>        <span class="hljs-string">&quot;template/user/index.html&quot;</span>,<br>        <span class="hljs-string">&quot;template/public/header.html&quot;</span>,<br>        <span class="hljs-string">&quot;template/public/footer.html&quot;</span>)<br>    router.GET(<span class="hljs-string">&quot;/login&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        status, _ := ctx.Get(<span class="hljs-string">&quot;cookie&quot;</span>)<br>        <span class="hljs-keyword">if</span> status == <span class="hljs-literal">true</span> &#123;<br>            ctx.Redirect(http.StatusMovedPermanently, <span class="hljs-string">&quot;/home&quot;</span>)<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            ctx.HTML(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;index.html&quot;</span>, gin.H&#123;<br>                <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;登录页面&quot;</span>,<br>            &#125;)<br>        &#125;<br>    &#125;)<br>    router.GET(<span class="hljs-string">&quot;/home&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        status, _ := ctx.Get(<span class="hljs-string">&quot;cookie&quot;</span>)<br>        <span class="hljs-keyword">if</span> status == <span class="hljs-literal">false</span> &#123;<br>            ctx.Redirect(http.StatusMovedPermanently, <span class="hljs-string">&quot;/login&quot;</span>)<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            ctx.String(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;home page&quot;</span>)<br>        &#125;<br>    &#125;)<br>    <span class="hljs-comment">//登录验证路由</span><br>    routerGroup := router.Group(<span class="hljs-string">&quot;/verify&quot;</span>)<br>    &#123;<br>        routerGroup.POST(<span class="hljs-string">&quot;/login&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>            name := ctx.PostForm(<span class="hljs-string">&quot;name&quot;</span>)<br>            pwd := ctx.PostForm(<span class="hljs-string">&quot;pwd&quot;</span>)<br>            <span class="hljs-keyword">if</span> name != <span class="hljs-string">&quot;admin&quot;</span> || pwd != <span class="hljs-string">&quot;123&quot;</span> &#123;<br>                ctx.String(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;用户名或密码错误&quot;</span>)<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                ctx.SetCookie(<span class="hljs-string">&quot;cookie&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-number">6000</span>, <span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>)<br>                ctx.Redirect(http.StatusMovedPermanently, <span class="hljs-string">&quot;/home&quot;</span>)<br>            &#125;<br>        &#125;)<br>    &#125;<br>    router.Run()<br>&#125;<br><span class="hljs-comment">// 权限验证中间件</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">MiddYanzheng</span><span class="hljs-params">()</span></span> gin.HandlerFunc &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        t := time.Now()<br>        cookie, err := ctx.Cookie(<span class="hljs-string">&quot;cookie&quot;</span>)<br>        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>            fmt.Println(err.Error())<br>            ctx.Set(<span class="hljs-string">&quot;cookie&quot;</span>, <span class="hljs-literal">false</span>)<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            ctx.Set(<span class="hljs-string">&quot;cookie&quot;</span>, <span class="hljs-literal">true</span>)<br>        &#125;<br>        t2 := time.Since(t)<br>        fmt.Println(<span class="hljs-string">&quot;cookie的状态:&quot;</span>, cookie, <span class="hljs-string">&quot;中间件耗时:&quot;</span>, t2)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>session的使用<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/shuiche/p/16548964.html">原文</a><br>注意要点:</p>
<ol>
<li>session仓库其实是一个map[interface]interface对象,所有session可以存储任意数据</li>
<li>session使用的编码器是自带gob,所以存储类似:struct&#x2F;map这些对象时需要先注册对象,不然会报错<code>gob:type not registered for ...</code></li>
<li>session存储引擎支持:cookie、内存、mongodb、redis、postgres、memstore、memcached记忆gom支持的各类数据库（mysql、sqlite）</li>
<li>session在创建时有一个配置项,可以配置session过期时间,cookie、domain、secure、path等参数</li>
<li>调用session方法：Set()、Delete()、Clear()、方法后,必须调用一次Save()方法.否则session数据不会更新</li>
</ol>
<p>有专门的session中间件可以直接使用<br>中间件： <code>github.com/gin-contrib/sessions</code><br>安装依赖：<code>go get github.com/gin-contrib/sessions</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-contrib/sessions&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-contrib/sessions/cookie&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    router := gin.Default()<br>    <span class="hljs-comment">//创建基于cookie的存储引擎,秘钥可以随便填写</span><br>    store := cookie.NewStore([]<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;自定义秘钥&quot;</span>))<br>    <span class="hljs-comment">//设置session中间件,参数mysession,指的是session的名字,也是cookie的名字</span><br>    <span class="hljs-comment">//store是前面创建的存储引擎</span><br>    router.Use(sessions.Sessions(<span class="hljs-string">&quot;mysession&quot;</span>, store))<br>    router.GET(<span class="hljs-string">&quot;session&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        <span class="hljs-comment">//初始化session对象</span><br>        session := sessions.Default(ctx)<br>        <span class="hljs-comment">//通过session.Get读取session的值</span><br>        <span class="hljs-comment">//session是键值对格式数据,因此需要通过key查询数据</span><br>        <span class="hljs-keyword">if</span> session.Get(<span class="hljs-string">&quot;hello&quot;</span>) != <span class="hljs-string">&quot;world&quot;</span> &#123;<br>            <span class="hljs-comment">//设置</span><br>            session.Set(<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>)<br>            <span class="hljs-comment">//删除</span><br>            <span class="hljs-comment">//session.Delete(&quot;tizi123&quot;)</span><br>            <span class="hljs-comment">//保存</span><br>            session.Save()<br>            <span class="hljs-comment">//删除所有session</span><br>            <span class="hljs-comment">//session.Clear()</span><br>        &#125;<br>        ctx.JSON(http.StatusOK, gin.H&#123;<span class="hljs-string">&quot;hello&quot;</span>: session.Get(<span class="hljs-string">&quot;hello&quot;</span>)&#125;)<br>    &#125;)<br>    router.Run()<br>&#125;<br></code></pre></td></tr></table></figure>

<p>gob注册案例</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span>&#123;<br>    Name <span class="hljs-type">string</span><br>&#125;<br>gob.Register(User&#123;&#125;)<br></code></pre></td></tr></table></figure>
<p>session配置项案例</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//store是前面创建的存储引擎</span><br>store.Options(sessions.Options&#123;<br>    Secure:<span class="hljs-literal">true</span>,<br>    SameSite:<span class="hljs-number">4</span>,<br>    Path:<span class="hljs-string">&quot;/&quot;</span>,<br>    MaxAge:m.MaxAge<br>&#125;)<br></code></pre></td></tr></table></figure>
<p>axios设置携带cookie (chrome&lt;80)<br>axios请求默认是不带cookie的,如果需要携带需要配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 全局配置</span><br>axios.<span class="hljs-property">defaults</span>.<span class="hljs-property">withCredentials</span> = <span class="hljs-literal">true</span><br><span class="hljs-comment">// 实例配置</span><br><span class="hljs-keyword">const</span> service = axios.<span class="hljs-title function_">create</span>(&#123;<br>    <span class="hljs-attr">baseURL</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">BASE_API</span>,<br>    <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>,<br>    <span class="hljs-attr">withCredentials</span>: <span class="hljs-literal">true</span>  <span class="hljs-comment">//  配置项</span><br>&#125;)<br><span class="hljs-comment">// 单个路由配置</span><br>axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/test&#x27;</span>, &#123;<br>  <span class="hljs-attr">withCredentials</span>: <span class="hljs-literal">true</span><br>&#125;)<br></code></pre></td></tr></table></figure>
<p>axios在跨域请求中携带cookie (chrome&lt;80)<br>需要给服务器开启CORS跨域,给gin添加CORS中间件<br>跨域配置中间件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>        method := c.Request.Method<br>        origin := c.GetHeader(<span class="hljs-string">&quot;Origin&quot;</span>)<br>        c.Header(<span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>, origin) <span class="hljs-comment">// 注意这一行，不能配置为通配符“*”号</span><br>        c.Header(<span class="hljs-string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>) <span class="hljs-comment">// 注意这一行，必须设定为 true</span><br>        c.Header(<span class="hljs-string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="hljs-string">&quot;Access-Control-Allow-Headers,Cookie, Origin, X-Requested-With, Content-Type, Accept, Authorization, Token, Timestamp, UserId&quot;</span>) <span class="hljs-comment">// 我们自定义的header字段都需要在这里声明</span><br>        c.Header(<span class="hljs-string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="hljs-string">&quot;POST, GET, OPTIONS,DELETE,PUT&quot;</span>)<br>        c.Header(<span class="hljs-string">&quot;Access-Control-Expose-Headers&quot;</span>, <span class="hljs-string">&quot;Content-Length, Access-Control-Allow-Origin, Access-Control-Allow-Headers, Content-Type,cache-control&quot;</span>)<br>        <span class="hljs-comment">// 放行所有OPTIONS方法</span><br>        <span class="hljs-keyword">if</span> method == <span class="hljs-string">&quot;OPTIONS&quot;</span> &#123;<br>            <span class="hljs-comment">//c.AbortWithStatus(http.StatusNoContent)</span><br>            c.AbortWithStatus(http.StatusOK)<br>        &#125;<br>        <span class="hljs-comment">// 处理请求</span><br>        c.Next()<br>    &#125;<br></code></pre></td></tr></table></figure>
<p>如果是chrome版本&gt;80,上面方法不生效,因为chrome增加了安全性修改了携带cookie的方式.<br>分两种情况:</p>
<ol>
<li>线上情况<ul>
<li>设置:samesite:name,也就是session的store在设定options时设定的字段配置为:SameSite:4,(这里4就代表none)</li>
<li>secure配置为true</li>
<li>服务端开启https(必须)</li>
</ul>
</li>
<li>配置案例查看上面的session配置项案例<br>优化方案<br>可以利用cookie机制发送sessionid.使用自定义header字段携带sessionid<br>基本逻辑:<br>前端:请求返回后,判断是否有我们命名的session名称的cookie,(就是创建session时的自定义名称:mysession),如果有将值存储到内存.发送请求时,将存储的session值添加到http请求的header中.<br>服务端:将校验session的中间件中的获取session修改为header中获取.<br>chrome&gt;80是发不出cookie不是收不到cookie.</li>
</ol>
<p>session基本配置</p>
<p>过期时间:<br><code>store.Options(sessions.Options&#123;MaxAge: 86400*30&#125;)</code><br>刷新超时时间基本思路:<br>每次获取到请求后,将该用户的session重新赋值,并返回给客户端,客户端下次请求时携带新的session请求.<br>当前session的用户数量<br>有时候我们需要统计当前在线人数,这里就不能用cookie或者内存存储session了.需要用数据库存储.<br>把session存储到数据库后,通过查询当前没过期session数量就可以确定在线人数<br>注销<br>调用session的Delete()方法,然后调用Save()方法保存</p>
<p>vue3浏览器在关闭时发送退出登录请求<br>在app.vue文件中添加这样的代码,其中:<code>gapTime &lt;=12</code>中的12是经验值.vue文件使用setup语法糖模式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;beforeunload&#x27;</span>, beforeunloadHandler)<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;unload&#x27;</span>, unloadHandler)<br>&#125;)<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">beforeunloadHandler</span> (<span class="hljs-params">e</span>) &#123;<br>    beforeUnloadTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>()<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">unloadHandler</span> (<span class="hljs-params">e</span>) &#123;<br>    gapTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>() - beforeUnloadTime<br>    <span class="hljs-comment">// 判断是窗口关闭还是刷新</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;====gapTime=======&#x27;</span>, gapTime)<br>    <span class="hljs-keyword">if</span> (gapTime &lt;= <span class="hljs-number">12</span>) &#123;<br>        <span class="hljs-comment">// 如果是登录状态，关闭窗口前，移除用户</span><br>        navigator.<span class="hljs-title function_">sendBeacon</span>(<span class="hljs-string">`/user/logout`</span>, data) <span class="hljs-comment">// 这里data是请求的参数。一个字符串，具体查看navigator.sendBeacon 使用方法</span><br>    &#125;<br>    <span class="hljs-keyword">debugger</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>session的Flashes讲解</p>
<ul>
<li>Flashes()</li>
<li>AddFlash()</li>
</ul>
<p>flash主要是存储一下临时数据</p>
<ol>
<li>我们调用AddFlash时,会往flash里存储一个键值对.</li>
<li>当我们调用Flashs读取了闪存内容后,这个闪存数据就会被删除.(调用Save()方法生效)</li>
</ol>
<p>结构体验证<br>用gin框架进行数据验证,可以不用解析数据减少if使用</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;time&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> &#123;<br>    Name     <span class="hljs-type">string</span>    <span class="hljs-string">`form:&quot;name&quot; binding:&quot;required&quot;`</span><br>    Age      <span class="hljs-type">int</span>       <span class="hljs-string">`form:&quot;age&quot; binding:&quot;required&quot;`</span><br>    Birthday time.Time <span class="hljs-string">`form:&quot;birthady&quot; time_format:&quot;2006-01-02&quot; time_utc:&quot;1&quot;`</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    router := gin.Default()<br>    router.GET(<span class="hljs-string">&quot;/verify&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        <span class="hljs-keyword">var</span> person Person<br>        <span class="hljs-keyword">if</span> err := ctx.ShouldBind(&amp;person); err != <span class="hljs-literal">nil</span> &#123;<br>            ctx.String(<span class="hljs-number">500</span>, fmt.Sprint(err))<br>            <span class="hljs-keyword">return</span><br>        &#125;<br>        ctx.String(<span class="hljs-number">200</span>, fmt.Sprintf(<span class="hljs-string">&quot;%#v&quot;</span>, person))<br>    &#125;)<br>    router.Run()<br>&#125;<br></code></pre></td></tr></table></figure>
<p>自定义验证</p>
<p><strong>没看懂</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;github.com/go-playground/validator/v10&quot;</span><br>)<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">例如name不能为空和不能等于admin不能同时满足</span><br><span class="hljs-comment">需要自己验证</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>    FirstName <span class="hljs-type">string</span>     <span class="hljs-string">`validate:&quot;required&quot;`</span><br>    Age       <span class="hljs-type">uint8</span>      <span class="hljs-string">`validate:&quot;required,gte=0,lte=130&quot;`</span><br>    Email     <span class="hljs-type">string</span>     <span class="hljs-string">`validate:&quot;required,email&quot;`</span><br>    Color     <span class="hljs-type">string</span>     <span class="hljs-string">`validate:&quot;iscolor&quot;`</span>                <span class="hljs-comment">//&#x27;hexcolor|rgb|rgba|hsl|hsla&#x27;</span><br>    Addresses []*Address <span class="hljs-string">`validate:&quot;required,dive,required&quot;`</span> <span class="hljs-comment">//人可以有多个房子</span><br>&#125;<br><span class="hljs-keyword">type</span> Address <span class="hljs-keyword">struct</span> &#123;<br>    Street <span class="hljs-type">string</span> <span class="hljs-string">`validate:&quot;required&quot;`</span><br>    City   <span class="hljs-type">string</span> <span class="hljs-string">`validate:&quot;required&quot;`</span><br>&#125;<br><span class="hljs-keyword">var</span> validate *validator.Validate<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    validate = validator.New()<br>    validateStruct()<br>    validateVariable()<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">validateStruct</span><span class="hljs-params">()</span></span> &#123;<br>    address := &amp;Address&#123;<br>        Street: <span class="hljs-string">&quot;昆仑山南路&quot;</span>,<br>        City:   <span class="hljs-string">&quot;青岛市&quot;</span>,<br>    &#125;<br>    user := &amp;User&#123;<br>        FirstName: <span class="hljs-string">&quot;Gary&quot;</span>,<br>        Age:       <span class="hljs-number">33</span>,<br>        Email:     <span class="hljs-string">&quot;6666@qq.com&quot;</span>,<br>        Color:     <span class="hljs-string">&quot;rgba(0,0,0,0)&quot;</span>,<br>        Addresses: []*Address&#123;address&#125;,<br>    &#125;<br>    err := validate.Struct(user)<br>    <span class="hljs-comment">//判断是否出错</span><br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-comment">//很少会用到的方法</span><br>        <span class="hljs-keyword">if</span> _, ok := err.(*validator.InvalidValidationError); ok &#123;<br>            fmt.Println(err)<br>            <span class="hljs-keyword">return</span><br>        &#125;<br>        <span class="hljs-comment">//循环输出报错信息</span><br>        <span class="hljs-keyword">for</span> _, err := <span class="hljs-keyword">range</span> err.(validator.ValidationErrors) &#123;<br>            fmt.Println(err.Namespace())<br>            fmt.Println(err.Field())<br>            fmt.Println(err.StructNamespace())<br>            fmt.Println(err.StructField())<br>            fmt.Println(err.Tag())<br>            fmt.Println(err.ActualTag())<br>            fmt.Println(err.Kind())<br>            fmt.Println(err.Type())<br>            fmt.Println(err.Value())<br>            fmt.Println(err.Param())<br>        &#125;<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <span class="hljs-comment">//保存user内容到数据库</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">validateVariable</span><span class="hljs-params">()</span></span> &#123;<br>    myEmail := <span class="hljs-string">&quot;6666@qq.com&quot;</span><br>    errs := validate.Var(myEmail, <span class="hljs-string">&quot;required,email&quot;</span>)<br>    <span class="hljs-keyword">if</span> errs != <span class="hljs-literal">nil</span> &#123;<br>        fmt.Println(errs)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>多语言翻译验证<br>没看懂</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>    <span class="hljs-string">&quot;github.com/go-playground/locales/en&quot;</span><br>    <span class="hljs-string">&quot;github.com/go-playground/locales/zh&quot;</span><br>    <span class="hljs-string">&quot;github.com/go-playground/locales/zh_Hant_TW&quot;</span><br>    <span class="hljs-comment">//i18n国际化插件</span><br>    ut <span class="hljs-string">&quot;github.com/go-playground/universal-translator&quot;</span><br>    <span class="hljs-comment">//验证插件  包验证器</span><br>    <span class="hljs-string">&quot;github.com/go-playground/validator/v10&quot;</span><br>    <span class="hljs-comment">//语言验证</span><br>    en_translations <span class="hljs-string">&quot;github.com/go-playground/validator/v10/translations/en&quot;</span><br>    zh_translations <span class="hljs-string">&quot;github.com/go-playground/validator/v10/translations/zh&quot;</span><br>    zh_tw_translations <span class="hljs-string">&quot;github.com/go-playground/validator/v10/translations/zh_tw&quot;</span><br>)<br><span class="hljs-keyword">var</span> (<br>    <span class="hljs-comment">//国际化包实例化</span><br>    Uni *ut.UniversalTranslator<br>    <span class="hljs-comment">//包验证器实例化</span><br>    Validate *validator.Validate<br>)<br><span class="hljs-comment">// 需要验证的结构体</span><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>    Username <span class="hljs-type">string</span> <span class="hljs-string">`form:&quot;user_name&quot; validate:&quot;required&quot;`</span><br>    Tagline  <span class="hljs-type">string</span> <span class="hljs-string">`form:&quot;tag_line&quot; validate:&quot;required,lt=10&quot;`</span><br>    Tagline2 <span class="hljs-type">string</span> <span class="hljs-string">`form:&quot;tag_line2&quot; validate:&quot;required,gt=1&quot;`</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    en := en.New()<br>    zh := zh.New()<br>    zh_tw := zh_Hant_TW.New()<br>    Uni = ut.New(en, zh, zh_tw)<br>    Validate = validator.New()<br>    router := gin.Default()<br>    router.GET(<span class="hljs-string">&quot;/yy&quot;</span>, startPage)<br>    router.POST(<span class="hljs-string">&quot;/yy&quot;</span>, startPage)<br>    router.Run()<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">startPage</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>    <span class="hljs-comment">//这部分放到中间件中</span><br>    local := ctx.DefaultQuery(<span class="hljs-string">&quot;locale&quot;</span>, <span class="hljs-string">&quot;zh&quot;</span>)<br>    trans, _ := Uni.GetTranslator(local)<br>    <span class="hljs-keyword">switch</span> local &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;zh&quot;</span>:<br>        zh_translations.RegisterDefaultTranslations(Validate, trans)<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;en&quot;</span>:<br>        en_translations.RegisterDefaultTranslations(Validate, trans)<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;zh_tw&quot;</span>:<br>        zh_tw_translations.RegisterDefaultTranslations(Validate, trans)<br>    <span class="hljs-keyword">default</span>:<br>        zh_translations.RegisterDefaultTranslations(Validate, trans)<br>    &#125;<br>    <span class="hljs-comment">//自定义错误内容</span><br>    Validate.RegisterTranslation(<span class="hljs-string">&quot;required&quot;</span>, trans, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ut ut.Translator)</span></span> <span class="hljs-type">error</span> &#123;<br>        <span class="hljs-keyword">return</span> ut.Add(<span class="hljs-string">&quot;required&quot;</span>, <span class="hljs-string">&quot;&#123;0&#125; 必须有一个值!&quot;</span>, <span class="hljs-literal">true</span>)<br>    &#125;, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ut ut.Translator, fe validator.FieldError)</span></span> <span class="hljs-type">string</span> &#123;<br>        t, _ := ut.T(<span class="hljs-string">&quot;required&quot;</span>, fe.Field())<br>        <span class="hljs-keyword">return</span> t<br>    &#125;)<br>    <span class="hljs-comment">//这块应该放到公共验证方法中</span><br>    user := User&#123;&#125;<br>    ctx.ShouldBind(&amp;user)<br>    fmt.Println(user)<br>    err := Validate.Struct(user)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        errs := err.(validator.ValidationErrors)<br>        sliceErrs := []<span class="hljs-type">string</span>&#123;&#125;<br>        <span class="hljs-keyword">for</span> _, e := <span class="hljs-keyword">range</span> errs &#123;<br>            sliceErrs = <span class="hljs-built_in">append</span>(sliceErrs, e.Translate(trans))<br>        &#125;<br>        ctx.String(<span class="hljs-number">500</span>, fmt.Sprintf(<span class="hljs-string">&quot;%#v&quot;</span>, sliceErrs))<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    ctx.String(<span class="hljs-number">200</span>, fmt.Sprintf(<span class="hljs-string">&quot;%#v&quot;</span>, <span class="hljs-string">&quot;user&quot;</span>))<br>&#125;<br></code></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/yy?user_name=garywang&tag_line=11&tag_line2=10">http://localhost:8080/yy?user_name=garywang&amp;tag_line=11&amp;tag_line2=10</a></p>
<p>日志文件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;io&quot;</span><br>    <span class="hljs-string">&quot;os&quot;</span><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    gin.DisableConsoleColor()<br>    <span class="hljs-comment">//log路径</span><br>    f, _ := os.Create(<span class="hljs-string">&quot;./log/gin.log&quot;</span>)<br>    <span class="hljs-comment">//存入文件 控制台不打印</span><br>    gin.DefaultWriter = io.MultiWriter(f)<br>    <span class="hljs-comment">//如果需要同时将日志写入文件和控制台,请使用以下代码</span><br>    <span class="hljs-comment">//gin.DefaultWriter = io.MultiWriter(f, os.Stdout)</span><br>    r := gin.Default()<br>    r.GET(<span class="hljs-string">&quot;/ping&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *gin.Context)</span></span> &#123;<br>        ctx.String(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;pong&quot;</span>)<br>    &#125;)<br>    r.Run()<br>&#125;<br></code></pre></td></tr></table></figure>
<p>gin验证码<br><code>github.com/dchest/captcha</code>库</p>
<p>web端实现原理</p>
<ul>
<li>提供一个路由，先在session里写入键值对（k-&gt;v），把值写在图片上，然后生成图片，显示在浏览器上面</li>
<li>前端将图片中的内容发送给后后端，后端根据session中的k取得v，比对校验。如果通过继续下一步的逻辑，失败给出错误提示<br>api端实现<br>API接口验证码实现方式类似，可以把键值对存储在起来，验证的时候把键值对传输过来一起校验。这里我只给出了web端的方法，爱动手的小伙伴可以自己尝试一下。</li>
</ul>
<p>后端</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><br></code></pre></td></tr></table></figure>



        </div>
    </article>
    <div class="w300 m-l-15 fixed-item-right">
        <div class="hot-list">
    <div class="f14 hot-list-title">推荐阅读</div>
    <ul>
        
            <li>
                <a href="/2023/05/25/canvas-%E6%94%BE%E7%83%9F%E8%8A%B1.html">canvas放烟花</a>
                <p>2023-05-25</p>
            </li>
        
            <li>
                <a href="/2023/06/21/node%E6%A3%80%E6%B5%8B%E6%96%87%E6%A1%A3%E7%BC%96%E7%A0%81%E6%96%B9%E5%BC%8F%E5%B9%B6%E8%BD%AC%E6%8D%A2%E7%BC%96%E7%A0%81.html">node检测文档编码方式并转换编码</a>
                <p>2023-06-21</p>
            </li>
        
            <li>
                <a href="/2023/06/21/koa2%E8%AF%B7%E6%B1%82%E9%85%8D%E7%BD%AE.html">koa2请求配置</a>
                <p>2023-06-21</p>
            </li>
        
            <li>
                <a href="/2024/03/23/ffmpeg-%E6%89%B9%E9%87%8Fm4a%E8%BD%ACmp3.html">ffmpeg批量m4a转mp3</a>
                <p>2024-03-23</p>
            </li>
        
            <li>
                <a href="/2023/02/10/%E5%90%8C%E8%8A%B1%E9%A1%BA%E7%8A%B6%E6%80%81%E8%AF%B4%E6%98%8E.html">同花顺状态说明</a>
                <p>2023-02-10</p>
            </li>
        
    </ul>
    <!-- <ul>
        
            <li>
                <a href="/2023/05/25/canvas-%E6%94%BE%E7%83%9F%E8%8A%B1.html">canvas放烟花</a>
                <p>2023-05-25</p>
            </li>
        
            <li>
                <a href="/2023/06/21/node%E6%A3%80%E6%B5%8B%E6%96%87%E6%A1%A3%E7%BC%96%E7%A0%81%E6%96%B9%E5%BC%8F%E5%B9%B6%E8%BD%AC%E6%8D%A2%E7%BC%96%E7%A0%81.html">node检测文档编码方式并转换编码</a>
                <p>2023-06-21</p>
            </li>
        
            <li>
                <a href="/2023/06/21/koa2%E8%AF%B7%E6%B1%82%E9%85%8D%E7%BD%AE.html">koa2请求配置</a>
                <p>2023-06-21</p>
            </li>
        
            <li>
                <a href="/2024/03/23/ffmpeg-%E6%89%B9%E9%87%8Fm4a%E8%BD%ACmp3.html">ffmpeg批量m4a转mp3</a>
                <p>2024-03-23</p>
            </li>
        
            <li>
                <a href="/2023/02/10/%E5%90%8C%E8%8A%B1%E9%A1%BA%E7%8A%B6%E6%80%81%E8%AF%B4%E6%98%8E.html">同花顺状态说明</a>
                <p>2023-02-10</p>
            </li>
        
    </ul> -->
</div>
        <div class="m-t-15"></div>
        <div class="tag-list">
    <div class="f14 tag-list-title">标签列表</div>
    <div class="flex flex-wrap flex-jus-start flex-item-start tag-list-content">
        
            <a href="/tag/%E7%8E%84%E5%AD%A6/">玄学(2)</a>
        
            <a href="/tag/%E7%BD%91%E8%B5%9A/">网赚(7)</a>
        
            <a href="/tag/ai/">AI(7)</a>
        
            <a href="/tag/chatgpt/">chatgpt(2)</a>
        
            <a href="/tag/js/">js(184)</a>
        
            <a href="/tag/ffmpeg/">ffmpeg(11)</a>
        
            <a href="/tag/hexo/">Hexo(5)</a>
        
            <a href="/tag/canvas/">canvas(5)</a>
        
            <a href="/tag/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库(12)</a>
        
            <a href="/tag/paddledetection/">PaddleDetection(4)</a>
        
            <a href="/tag/stablediffusion/">StableDiffusion(6)</a>
        
            <a href="/tag/linux/">linux(24)</a>
        
            <a href="/tag/ajax/">ajax(1)</a>
        
            <a href="/tag/astro/">astro(3)</a>
        
            <a href="/tag/axios/">axios(2)</a>
        
            <a href="/tag/bat/">bat(9)</a>
        
            <a href="/tag/%E6%BF%80%E6%B4%BB%E7%A0%81/">激活码(2)</a>
        
            <a href="/tag/node/">node(59)</a>
        
            <a href="/tag/css/">css(19)</a>
        
            <a href="/tag/dns/">dns(7)</a>
        
            <a href="/tag/go/">go(59)</a>
        
            <a href="/tag/docker/">docker(1)</a>
        
            <a href="/tag/echarts/">echarts(2)</a>
        
            <a href="/tag/charts/">charts(1)</a>
        
            <a href="/tag/electron/">electron(1)</a>
        
            <a href="/tag/git/">git(2)</a>
        
            <a href="/tag/vps/">vps(9)</a>
        
            <a href="/tag/html/">html(7)</a>
        
            <a href="/tag/%E7%A7%BB%E5%8A%A8%E7%AB%AF/">移动端(11)</a>
        
            <a href="/tag/vue/">vue(40)</a>
        
            <a href="/tag/jquery/">jquery(7)</a>
        
            <a href="/tag/video/">video(2)</a>
        
            <a href="/tag/typescript/">typescript(4)</a>
        
            <a href="/tag/websocket/">websocket(5)</a>
        
            <a href="/tag/%E5%BE%AE%E4%BF%A1/">微信(5)</a>
        
            <a href="/tag/php/">php(14)</a>
        
            <a href="/tag/ios/">ios(2)</a>
        
            <a href="/tag/koa2/">koa2(14)</a>
        
            <a href="/tag/%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86/">视频处理(4)</a>
        
            <a href="/tag/%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83/">测试环境(1)</a>
        
            <a href="/tag/%E7%BC%96%E8%BE%91%E5%99%A8/">编辑器(1)</a>
        
            <a href="/tag/markdown/">markdown(1)</a>
        
            <a href="/tag/sql/">sql(1)</a>
        
            <a href="/tag/nginx/">nginx(2)</a>
        
            <a href="/tag/vue3/">vue3(1)</a>
        
            <a href="/tag/express/">express(2)</a>
        
            <a href="/tag/mysql/">mysql(2)</a>
        
            <a href="/tag/npm/">npm(2)</a>
        
            <a href="/tag/ocr/">ocr(1)</a>
        
            <a href="/tag/%E7%88%AC%E8%99%AB/">爬虫(20)</a>
        
            <a href="/tag/%E5%9B%BD%E5%AD%A6/">国学(9)</a>
        
            <a href="/tag/cmd/">cmd(1)</a>
        
            <a href="/tag/nuxt/">nuxt(3)</a>
        
            <a href="/tag/ai/">ai(1)</a>
        
            <a href="/tag/ps/">PS(2)</a>
        
            <a href="/tag/python/">python(17)</a>
        
            <a href="/tag/pm2/">pm2(1)</a>
        
            <a href="/tag/react/">react(4)</a>
        
            <a href="/tag/svg/">svg(2)</a>
        
            <a href="/tag/threejs/">threejs(2)</a>
        
            <a href="/tag/tvbox/">tvbox(1)</a>
        
            <a href="/tag/unity/">unity(1)</a>
        
            <a href="/tag/demo/">Demo(1)</a>
        
            <a href="/tag/%E5%AE%B9%E5%99%A8/">容器(2)</a>
        
            <a href="/tag/vscode/">vscode(1)</a>
        
            <a href="/tag/pinia/">pinia(1)</a>
        
            <a href="/tag/vue-router/">vue-router(1)</a>
        
            <a href="/tag/vuex/">vuex(1)</a>
        
            <a href="/tag/webpack/">webpack(2)</a>
        
            <a href="/tag/%E4%B8%AD%E5%8C%BB/">中医(15)</a>
        
            <a href="/tag/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1/">企业微信(1)</a>
        
            <a href="/tag/%E5%85%B6%E4%BB%96/">其他(7)</a>
        
            <a href="/tag/emoji/">emoji(4)</a>
        
            <a href="/tag/%E7%BE%8E%E9%A3%9F/">美食(6)</a>
        
            <a href="/tag/%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86/">加密解密(2)</a>
        
            <a href="/tag/%E5%89%8D%E7%AB%AF/">前端(2)</a>
        
            <a href="/tag/%E5%85%B5%E6%B3%95/">兵法(3)</a>
        
            <a href="/tag/%E6%B1%89%E5%AD%97/">汉字(3)</a>
        
            <a href="/tag/%E6%91%A9%E6%89%98%E8%BD%A6/">摩托车(1)</a>
        
            <a href="/tag/%E5%B0%8F%E7%9A%AE/">小皮(1)</a>
        
            <a href="/tag/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/">微信小程序(1)</a>
        
            <a href="/tag/date/">Date(1)</a>
        
            <a href="/tag/cookie/">cookie(1)</a>
        
            <a href="/tag/localstorage/">localStorage(1)</a>
        
            <a href="/tag/indexdb/">indexDB(1)</a>
        
            <a href="/tag/json/">json(1)</a>
        
            <a href="/tag/%E6%A8%A1%E6%9D%BF/">模板(1)</a>
        
            <a href="/tag/%E5%87%8F%E8%82%A5/">减肥(1)</a>
        
            <a href="/tag/%E8%AF%BB%E4%B9%A6%E4%BC%9A/">读书会(1)</a>
        
            <a href="/tag/%E5%B0%8F%E5%90%83/">小吃(1)</a>
        
    </div>
</div>


    </div>
</div>
<script>
    function addCopyButtons() {
        // 获取所有代码块
        const codeBlocks = document.querySelectorAll('pre code');
        
        codeBlocks.forEach((codeBlock) => {
            // 创建复制按钮
            const copyButton = document.createElement('i');
            copyButton.className = 'copy-button fa fa-copy';
            
            // 查找最近的 .highlight 父元素
            const highlightBlock = codeBlock.closest('.highlight');
            if (highlightBlock) {
                highlightBlock.insertBefore(copyButton, highlightBlock.firstChild);
            }
            
            // 添加点击事件
            copyButton.addEventListener('click', () => {
                // 获取格式化的代码内容
                const code = codeBlock.innerText || codeBlock.textContent;
                
                // 使用 textarea 来保持文本格式
                const textarea = document.createElement('textarea');
                textarea.value = code;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    // 尝试使用新的 API
                    navigator.clipboard.writeText(code).then(() => {
                        copyButton.className = 'copy-button fa fa-check';
                        setTimeout(() => {
                            copyButton.className = 'copy-button fa fa-copy';
                        }, 2000);
                    });
                } catch (err) {
                    // 降级方案：使用 document.execCommand
                    document.execCommand('copy');
                    copyButton.className = 'copy-button fa fa-check';
                    setTimeout(() => {
                        copyButton.className = 'copy-button fa fa-copy';
                    }, 2000);
                }
                
                // 清理临时元素
                document.body.removeChild(textarea);
            });
        });
    }
    // 页面加载完成后添加复制按钮
document.addEventListener('DOMContentLoaded', addCopyButtons);

</script>
    </div>
    <footer>
    <div>
        copyright © 2024 Gary Wang 
    </div>
</footer>
    <div class="search-page animated">
    <div class="search-page-content">
        <i class="fa fa-times search-close"></i>
        <h1>内容搜索</h1>
        <form onsubmit="formSubmit(event)" class="search-page-form re">
            <input type="text" placeholder="查找" name="keyword" id="search-input" autocomplete="off">
            <button>
                <i class="fa fa-search"></i>
            </button>
        </form>
        <div class="search-page-result" id="search-result">
        </div>
    </div>
    <div class="search-page-bg"></div>
</div>
<script>
    //所有搜索数据
    let searchData = [];
    
    // 加载搜索数据
    fetch('/search.xml')
        .then(response => response.text())
        .then(str => new window.DOMParser().parseFromString(str, "text/xml"))
        .then(data => {
            searchData = Array.from(data.getElementsByTagName('entry')).map(entry => ({
                title: entry.getElementsByTagName('title')[0].textContent,
                content: entry.getElementsByTagName('content')[0].textContent,
                url: entry.getElementsByTagName('url')[0].textContent
            }));
        });

    // 搜索功能实现
    function formSubmit(event) {
        event.preventDefault();
        // 搜索关键词
        const keyword = document.getElementById('search-input').value.toLowerCase();
        // 搜索结果
        const results = searchData.filter(item => 
            item.title.toLowerCase().includes(keyword) || item.content.toLowerCase().includes(keyword)
        );
        const resultDiv = document.getElementById('search-result');
        if(results.length === 0 || keyword === ''){
            resultDiv.innerHTML = '<div class="search-page-result-item t-c f13">没有找到相关内容</div>';
        }else{
            resultDiv.innerHTML = results.map(item => `
                <div class="search-page-result-item">
                    <a href="${item.url}">
                        <h5>${item.title}</h5>
                    </a>
                </div>
            `).join('');
        }
    }
    document.querySelector('.search-close').addEventListener('click',function(){
        hideSearchPage()
    })
</script>
    <!-- <div class="gotopage" id="gotopage">
        <i class="far fa-arrow-alt-circle-up"></i>
    </div> -->
    <script src="/assets/js/common.js"></script>
    <script src="/assets/js/func.js"></script>
    <script src="/assets/live2dw/lib/L2Dwidget.js"></script>
    <script>
        // 加载动画
        window.addEventListener('DOMContentLoaded',function(){
            setTimeout(function() {
                document.querySelector('.loading').style.display = 'none';
            },800)
        },false)
        
        /* 看板娘 */
        L2Dwidget.init({
            "pluginRootPath"  : "/assets/live2dw/",
            "pluginJsPath"	  : "/assets/live2dw/lib/",
            "pluginModelPath" : "/assets/live2dw/assets/",
            "tagMode"		  : false,
            "debug"			  : false,
            "model"			  : {
                "jsonPath" : "/assets/live2dw/assets/kesshouban.model.json"
            },
            "display" : {
                "position" : "right",
                "width"	   : 250,
                "height"   : 250,
                "hOffset"  : -70,
                "vOffset"  : 60
            },
            "dialog"	: {
                "enable" : true
            },
            "mobile"	: {
                "show" : true
            },
            "react"		: {
                "opacity" : 1
            },
            "log" : false
        });
        const addEvent = function(){
            const live2dWidget = document.getElementById('live2d-widget')
            setTimeout(function(){
                if(live2dWidget){
                    live2dWidget.addEventListener('click',function(e){
                        document.querySelector('.main').scrollTo({
                            top: 0,
                            behavior: 'smooth'
                        });
                    })
                }else{
                    addEvent()
                }
            },1000)
        }
        addEvent()
    </script>
    <!-- Cloudflare Web Analytics -->
    <!-- <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "5bd3afcce7474fcdbf639fab1999e804"}'></script> -->
    <!-- End Cloudflare Web Analytics -->
    <!-- <script src='//unpkg.com/@waline/client/dist/waline.js'></script>
    <link href='//unpkg.com/@waline/client/dist/waline.css' rel='stylesheet'/> -->
</body>
</html>